var Pl=Object.defineProperty;var Hl=(t,e,n)=>e in t?Pl(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Nn=(t,e,n)=>(Hl(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();function xt(){}const Ul=t=>t;function Bl(t,e){for(const n in e)t[n]=e[n];return t}function za(t){return t()}function Oi(){return Object.create(null)}function me(t){t.forEach(za)}function Rr(t){return typeof t=="function"}function ce(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function Vl(t){return Object.keys(t).length===0}function Qe(t,...e){if(t==null)return xt;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function Wl(t){let e;return Qe(t,n=>e=n)(),e}function vt(t,e,n){t.$$.on_destroy.push(Qe(e,n))}function Ma(t,e,n,r){if(t){const i=Aa(t,e,n,r);return t[0](i)}}function Aa(t,e,n,r){return t[1]&&r?Bl(n.ctx.slice(),t[1](r(e))):n.ctx}function Sa(t,e,n,r){if(t[2]&&r){const i=t[2](r(n));if(e.dirty===void 0)return i;if(typeof i=="object"){const o=[],a=Math.max(e.dirty.length,i.length);for(let l=0;l<a;l+=1)o[l]=e.dirty[l]|i[l];return o}return e.dirty|i}return e.dirty}function Da(t,e,n,r,i,o){if(i){const a=Aa(e,n,r,o);t.p(a,i)}}function La(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let r=0;r<n;r++)e[r]=-1;return e}return-1}function Yi(t){return t??""}const Ia=typeof window<"u";let Ol=Ia?()=>window.performance.now():()=>Date.now(),ki=Ia?t=>requestAnimationFrame(t):xt;const yn=new Set;function Ea(t){yn.forEach(e=>{e.c(t)||(yn.delete(e),e.f())}),yn.size!==0&&ki(Ea)}function Yl(t){let e;return yn.size===0&&ki(Ea),{promise:new Promise(n=>{yn.add(e={c:t,f:n})}),abort(){yn.delete(e)}}}const ql=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function b(t,e){t.appendChild(e)}function Na(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function Kl(t){const e=R("style");return Xl(Na(t),e),e.sheet}function Xl(t,e){return b(t.head||t,e),e.sheet}function ut(t,e,n){t.insertBefore(e,n||null)}function ct(t){t.parentNode&&t.parentNode.removeChild(t)}function xn(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function R(t){return document.createElement(t)}function Xt(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function j(t){return document.createTextNode(t)}function bt(){return j(" ")}function Gl(){return j("")}function Zt(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function y(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Zl(t){return Array.from(t.childNodes)}function ht(t,e){e=""+e,t.data!==e&&(t.data=e)}function hn(t,e,n,r){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}function qe(t,e,n){for(let r=0;r<t.options.length;r+=1){const i=t.options[r];if(i.__value===e){i.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function qi(t){const e=t.querySelector(":checked");return e&&e.__value}function Ki(t,e,n){t.classList[n?"add":"remove"](e)}function Fa(t,e,{bubbles:n=!1,cancelable:r=!1}={}){const i=document.createEvent("CustomEvent");return i.initCustomEvent(t,n,r,e),i}const vr=new Map;let _r=0;function Jl(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}function Ql(t,e){const n={stylesheet:Kl(e),rules:{}};return vr.set(t,n),n}function Xi(t,e,n,r,i,o,a,l=0){const c=16.666/r;let s=`{
`;for(let p=0;p<=1;p+=c){const v=e+(n-e)*o(p);s+=p*100+`%{${a(v,1-v)}}
`}const f=s+`100% {${a(n,1-n)}}
}`,u=`__svelte_${Jl(f)}_${l}`,d=Na(t),{stylesheet:h,rules:m}=vr.get(d)||Ql(d,t);m[u]||(m[u]=!0,h.insertRule(`@keyframes ${u} ${f}`,h.cssRules.length));const g=t.style.animation||"";return t.style.animation=`${g?`${g}, `:""}${u} ${r}ms linear ${i}ms 1 both`,_r+=1,u}function jl(t,e){const n=(t.style.animation||"").split(", "),r=n.filter(e?o=>o.indexOf(e)<0:o=>o.indexOf("__svelte")===-1),i=n.length-r.length;i&&(t.style.animation=r.join(", "),_r-=i,_r||ts())}function ts(){ki(()=>{_r||(vr.forEach(t=>{const{ownerNode:e}=t.stylesheet;e&&ct(e)}),vr.clear())})}let Xn;function Kn(t){Xn=t}function Dn(){if(!Xn)throw new Error("Function called outside component initialization");return Xn}function es(t){Dn().$$.before_update.push(t)}function xe(t){Dn().$$.on_mount.push(t)}function ns(t){Dn().$$.after_update.push(t)}function Ve(t){Dn().$$.on_destroy.push(t)}function $a(){const t=Dn();return(e,n,{cancelable:r=!1}={})=>{const i=t.$$.callbacks[e];if(i){const o=Fa(e,n,{cancelable:r});return i.slice().forEach(a=>{a.call(t,o)}),!o.defaultPrevented}return!0}}function rs(t,e){return Dn().$$.context.set(t,e),e}const dn=[],le=[];let vn=[];const ai=[],Ra=Promise.resolve();let li=!1;function Pa(){li||(li=!0,Ra.then(Ha))}function Pe(){return Pa(),Ra}function en(t){vn.push(t)}function is(t){ai.push(t)}const Xr=new Set;let cn=0;function Ha(){if(cn!==0)return;const t=Xn;do{try{for(;cn<dn.length;){const e=dn[cn];cn++,Kn(e),os(e.$$)}}catch(e){throw dn.length=0,cn=0,e}for(Kn(null),dn.length=0,cn=0;le.length;)le.pop()();for(let e=0;e<vn.length;e+=1){const n=vn[e];Xr.has(n)||(Xr.add(n),n())}vn.length=0}while(dn.length);for(;ai.length;)ai.pop()();li=!1,Xr.clear(),Kn(t)}function os(t){if(t.fragment!==null){t.update(),me(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(en)}}function as(t){const e=[],n=[];vn.forEach(r=>t.indexOf(r)===-1?e.push(r):n.push(r)),n.forEach(r=>r()),vn=e}let Fn;function ls(){return Fn||(Fn=Promise.resolve(),Fn.then(()=>{Fn=null})),Fn}function Gr(t,e,n){t.dispatchEvent(Fa(`${e?"intro":"outro"}${n}`))}const ur=new Set;let Ne;function Pr(){Ne={r:0,c:[],p:Ne}}function Hr(){Ne.r||me(Ne.c),Ne=Ne.p}function $t(t,e){t&&t.i&&(ur.delete(t),t.i(e))}function Ht(t,e,n,r){if(t&&t.o){if(ur.has(t))return;ur.add(t),Ne.c.push(()=>{ur.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}const ss={duration:0};function Gi(t,e,n,r){const i={direction:"both"};let o=e(t,n,i),a=r?0:1,l=null,c=null,s=null;function f(){s&&jl(t,s)}function u(h,m){const g=h.b-a;return m*=Math.abs(g),{a,b:h.b,d:g,duration:m,start:h.start,end:h.start+m,group:h.group}}function d(h){const{delay:m=0,duration:g=300,easing:p=Ul,tick:v=xt,css:T}=o||ss,M={start:Ol()+m,b:h};h||(M.group=Ne,Ne.r+=1),l||c?c=M:(T&&(f(),s=Xi(t,a,h,g,m,p,T)),h&&v(0,1),l=u(M,g),en(()=>Gr(t,h,"start")),Yl(x=>{if(c&&x>c.start&&(l=u(c,g),c=null,Gr(t,l.b,"start"),T&&(f(),s=Xi(t,a,l.b,l.duration,0,p,o.css))),l){if(x>=l.end)v(a=l.b,1-a),Gr(t,l.b,"end"),c||(l.b?f():--l.group.r||me(l.group.c)),l=null;else if(x>=l.start){const k=x-l.start;a=l.a+l.d*p(k/l.duration),v(a,1-a)}}return!!(l||c)}))}return{run(h){Rr(o)?ls().then(()=>{o=o(i),d(h)}):d(h)},end(){f(),l=c=null}}}function Zi(t,e){t.d(1),e.delete(t.key)}function Ji(t,e,n,r,i,o,a,l,c,s,f,u){let d=t.length,h=o.length,m=d;const g={};for(;m--;)g[t[m].key]=m;const p=[],v=new Map,T=new Map,M=[];for(m=h;m--;){const S=u(i,o,m),N=n(S);let H=a.get(N);H?r&&M.push(()=>H.p(S,e)):(H=s(N,S),H.c()),v.set(N,p[m]=H),N in g&&T.set(N,Math.abs(m-g[N]))}const x=new Set,k=new Set;function w(S){$t(S,1),S.m(l,f),a.set(S.key,S),f=S.first,h--}for(;d&&h;){const S=p[h-1],N=t[d-1],H=S.key,U=N.key;S===N?(f=S.first,d--,h--):v.has(U)?!a.has(H)||x.has(H)?w(S):k.has(U)?d--:T.get(H)>T.get(U)?(k.add(H),w(S)):(x.add(U),d--):(c(N,a),d--)}for(;d--;){const S=t[d];v.has(S.key)||c(S,a)}for(;h;)w(p[h-1]);return me(M),p}function cs(t,e,n){const r=t.$$.props[e];r!==void 0&&(t.$$.bound[r]=n,n(t.$$.ctx[r]))}function te(t){t&&t.c()}function Jt(t,e,n,r){const{fragment:i,after_update:o}=t.$$;i&&i.m(e,n),r||en(()=>{const a=t.$$.on_mount.map(za).filter(Rr);t.$$.on_destroy?t.$$.on_destroy.push(...a):me(a),t.$$.on_mount=[]}),o.forEach(en)}function Qt(t,e){const n=t.$$;n.fragment!==null&&(as(n.after_update),me(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function us(t,e){t.$$.dirty[0]===-1&&(dn.push(t),Pa(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function ge(t,e,n,r,i,o,a,l=[-1]){const c=Xn;Kn(t);const s=t.$$={fragment:null,ctx:[],props:o,update:xt,not_equal:i,bound:Oi(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(c?c.$$.context:[])),callbacks:Oi(),dirty:l,skip_bound:!1,root:e.target||c.$$.root};a&&a(s.root);let f=!1;if(s.ctx=n?n(t,e.props||{},(u,d,...h)=>{const m=h.length?h[0]:d;return s.ctx&&i(s.ctx[u],s.ctx[u]=m)&&(!s.skip_bound&&s.bound[u]&&s.bound[u](m),f&&us(t,u)),d}):[],s.update(),f=!0,me(s.before_update),s.fragment=r?r(s.ctx):!1,e.target){if(e.hydrate){const u=Zl(e.target);s.fragment&&s.fragment.l(u),u.forEach(ct)}else s.fragment&&s.fragment.c();e.intro&&$t(t.$$.fragment),Jt(t,e.target,e.anchor,e.customElement),Ha()}Kn(c)}class pe{$destroy(){Qt(this,1),this.$destroy=xt}$on(e,n){if(!Rr(n))return xt;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!Vl(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const un=[];function fs(t,e){return{subscribe:Ti(t,e).subscribe}}function Ti(t,e=xt){let n;const r=new Set;function i(l){if(ce(t,l)&&(t=l,n)){const c=!un.length;for(const s of r)s[1](),un.push(s,t);if(c){for(let s=0;s<un.length;s+=2)un[s][0](un[s+1]);un.length=0}}}function o(l){i(l(t))}function a(l,c=xt){const s=[l,c];return r.add(s),r.size===1&&(n=e(i)||xt),l(t),()=>{r.delete(s),r.size===0&&n&&(n(),n=null)}}return{set:i,update:o,subscribe:a}}function ds(t,e,n){const r=!Array.isArray(t),i=r?[t]:t,o=e.length<2;return fs(n,a=>{let l=!1;const c=[];let s=0,f=xt;const u=()=>{if(s)return;f();const h=e(r?c[0]:c,a);o?a(h):f=Rr(h)?h:xt},d=i.map((h,m)=>Qe(h,g=>{c[m]=g,s&=~(1<<m),l&&u()},()=>{s|=1<<m}));return l=!0,u(),function(){me(d),f(),l=!1}})}let $n=null;const{subscribe:hs,set:ms,update:Qi}=Ti({items:[],loading:!1,error:null}),ee={subscribe:hs,loadItems:async()=>$n||(Qi(t=>({...t,loading:!0,error:null})),$n=(async()=>{try{const n=await(await fetch("/IWAC-overview/items.json")).json();return ms({items:n,loading:!1,error:null}),n}catch(t){const e=t instanceof Error?t.message:"Failed to load items";throw Qi(n=>({...n,loading:!1,error:e})),t}finally{$n=null}})(),$n)},Ua={en:{"app.title":"<i>Islam West Africa Collection</i> Overview","tab.countries":"Country distribution","tab.languages":"Languages","tab.timeline":"Collection growth","tab.types":"Type distribution","tab.categories":"Index","tab.words":"Word count","ui.loading":"Loading database...","ui.select_visualization":"Select a visualization from the tabs above","ui.toggle_language":"Français","ui.show_description":"Show description","ui.hide_description":"Hide description","ui.no_visualization_content":"No visualization content available","ui.enter_fullscreen":"Enter fullscreen mode","ui.exit_fullscreen":"Exit fullscreen mode","ui.download_visualization":"Download visualization","viz.summary":"Summary","viz.total_items":"Total items","viz.number_of_categories":"Number of categories","viz.top_categories":"Top Categories","viz.filter_by_country":"Filter by Country","viz.filter_by_type":"Filter by Type","viz.showing_items":"Showing {0} items in {1} languages","viz.all_countries":"All Countries","viz.all_types":"All Types","viz.no_data":"No data available with the current filters","viz.distribution_items":"Distribution of {0} items by country and sub-collection","viz.language_distribution_title":"Language Distribution","viz.language_distribution_items":"Distribution of {0} items by language","viz.language_distribution_description":"This visualization shows the distribution of items by language. You can filter by country and item type to explore the language distribution across different segments of the collection.","viz.chart_type":"Chart Type","viz.pie_chart":"Switch to Pie Chart","viz.donut_chart":"Switch to Donut Chart","viz.growth_since_april_title":"Growth Since April 2024","viz.growth_since_april":"Growth of {0} items since April 2024","viz.growth_since_april_description":"This visualization shows the growth of the database since April 2024. The blue line represents monthly additions, while the green dotted line shows the cumulative total. You can filter by country and item type to explore growth patterns.","viz.time_period":"Time period","viz.avg_monthly_additions":"Average monthly additions","viz.peak_growth_months":"Peak Growth Months","viz.showing_items_over_months":"Showing {0} items over {1} months","viz.months":"months","viz.monthly_additions":"Monthly Additions","viz.month":"Month","viz.new_items":"New Items","viz.percentage":"Percentage","viz.publication_year":"Publication Year","viz.year":"Year","viz.number_of_items":"Number of Items","viz.toggle_types":"Toggle Types","viz.toggle_languages":"Toggle Languages","viz.toggled_type":"Toggled type: {0}","viz.languages":"Languages","viz.country_distribution_title":"Country Distribution","viz.country_distribution_description":"This visualization shows the distribution of items by country and sub-collection. You can click on any country block to zoom in and see its sub-collections. The size of each block represents the number of items in that country or sub-collection.","viz.country.items":"Items","viz.country.percent_parent":"% of Parent","viz.country.percent_total":"% of Total","viz.country.click_zoom_in":"Click to zoom in","viz.country.click_zoom_out":"Click to zoom out","viz.country.unknown":"Unknown","viz.country.no_set":"No Set","viz.countries":"Countries","viz.sub_collections":"Sub-collections","viz.currently_viewing":"Currently viewing","viz.click_back_to_return":'Click the "Back to All" button to return to the full view',"viz.click_zoom_in":"Click on a country block to zoom in","viz.unknown":"Unknown","viz.no_set":"No Set","viz.word_distribution":"Word Distribution","viz.total_words":"Total Words","viz.avg_words_per_item":"Average words per Item","viz.back_to_all":"← Back to All","viz.total_items_with_word_count":"Total items with word count","viz.word_distribution_subtitle":"Word Distribution by Country and Item Set ({0} items, {1} words)","viz.word_distribution_description":"This visualization shows the distribution of words across items by country and collection. The size of each block represents the word count in that country or collection.","viz.words":"words","viz.items":"items","viz.percent_of_country":"% of country","viz.percent_of_total":"% of total","viz.item_set_summary":"Item Set Summary","lang.Français":"French","lang.Anglais":"English","lang.Haoussa":"Hausa","lang.Allemand":"German","lang.Arabe":"Arabic","lang.Italien":"Italian","lang.Dendi":"Dendi","lang.Slovène":"Slovenian","lang.Espagnol":"Spanish","country.all":"All Countries","country.Bénin":"Benin","country.Nigéria":"Nigeria","country.Côte d'Ivoire":"Côte d'Ivoire","country.Burkina Faso":"Burkina Faso","country.Togo":"Togo","country.Niger":"Niger","country.Unknown":"Unknown","type.Article de presse":"Press article","type.Notice d'autorité":"Authority record","type.Périodique islamique":"Islamic periodical","type.Unknown":"Unknown","type.Article de revue":"Journal article","type.Document":"Document","type.Article de blog":"Blog post","type.Chapitre de livre":"Book chapter","type.Livre":"Book","type.Thèse de doctorat":"Doctoral thesis","type.Communication scientifique":"Scientific communication","type.Article d'encyclopédie":"Encyclopedia article","type.Compte rendu de livre":"Book review","type.Enregistrement vidéo":"Video recording","type.Mémoire de licence":"Bachelor's thesis","type.Mémoire de maitrise":"Master's thesis","type.Photographie":"Photograph","type.Rapport":"Report","type.Working paper":"Working paper","type.all":"All types","viz.index_distribution_title":"Index Distribution","viz.index_distribution_items":"Distribution of {0} index items by category","viz.index_distribution_description":"This visualization shows the distribution of index items by category. The size of each bar represents the number of items in that category. Index items are authority records that serve as reference points in the database.","viz.categories":"Categories","viz.uncategorized":"Uncategorized","viz.type_distribution_title":"Type Distribution","viz.type_distribution_items":"Distribution of {0} items by type","viz.type_distribution_description":"This visualization shows the distribution of items by type over time. You can filter by country and year range to explore how different types of items have been published over time.","viz.types":"Types","viz.published_between":"published between {0} and {1}","viz.type":"Type","viz.count":"Count","viz.others":"Others","category.Events":"Events","category.Locations":"Locations","category.Organizations":"Organizations","category.Persons":"Persons","category.Topics":"Topics","category.Authority Files":"Authority files"},fr:{"app.title":"Aperçu de la <i>Collection Islam Afrique de l'Ouest</i>","tab.countries":"Répartition par pays","tab.languages":"Langues","tab.timeline":"Croissance collection","tab.types":"Répartition par type","tab.categories":"Index","tab.words":"Nombre de mots","ui.loading":"Chargement de la base de données...","ui.select_visualization":"Sélectionnez une visualisation dans les onglets ci-dessus","ui.toggle_language":"English","ui.show_description":"Afficher la description","ui.hide_description":"Masquer la description","ui.no_visualization_content":"Aucun contenu de visualisation disponible","ui.enter_fullscreen":"Passer en mode plein écran","ui.exit_fullscreen":"Quitter le mode plein écran","ui.download_visualization":"Télécharger la visualisation","viz.summary":"Résumé","viz.total_items":"Nombre total d'éléments","viz.number_of_categories":"Nombre de catégories","viz.top_categories":"Principales catégories","viz.filter_by_country":"Filtrer par pays","viz.filter_by_type":"Filtrer par type","viz.showing_items":"Affichage de {0} éléments dans {1} langues","viz.all_countries":"Tous les pays","viz.all_types":"Tous les types","viz.no_data":"Aucune donnée disponible avec les filtres actuels","viz.distribution_items":"Répartition de {0} éléments par pays et sous-collection","viz.language_distribution_title":"Répartition par langue","viz.language_distribution_items":"Répartition de {0} éléments par langue","viz.language_distribution_description":"Cette visualisation montre la répartition des éléments par langue. Vous pouvez filtrer par pays et par type d'élément pour explorer la répartition des langues dans différents segments de la collection.","viz.chart_type":"Type de graphique","viz.pie_chart":"Passer au graphique en secteurs","viz.donut_chart":"Passer au graphique en anneau","viz.growth_since_april_title":"Croissance depuis avril 2024","viz.growth_since_april":"Croissance de {0} éléments depuis avril 2024","viz.growth_since_april_description":"Cette visualisation montre la croissance de la base de données depuis avril 2024. La ligne bleue représente les ajouts mensuels, tandis que la ligne pointillée verte montre le total cumulatif. Vous pouvez filtrer par pays et par type d'élément pour explorer les modèles de croissance.","viz.time_period":"Période","viz.avg_monthly_additions":"Ajouts mensuels moyens","viz.peak_growth_months":"Mois de croissance maximale","viz.showing_items_over_months":"Affichage de {0} éléments sur {1} mois","viz.months":"mois","viz.monthly_additions":"Ajouts mensuels","viz.month":"Mois","viz.new_items":"Nouveaux Éléments","viz.percentage":"Pourcentage","viz.publication_year":"Année de publication","viz.year":"Année","viz.number_of_items":"Nombre d'éléments","viz.toggle_types":"Basculer les types","viz.toggle_languages":"Basculer les langues","viz.toggled_type":"Type basculé : {0}","viz.languages":"Langues","viz.country_distribution_title":"Répartition par pays","viz.country_distribution_description":"Cette visualisation montre la répartition des éléments par pays et sous-collection. Vous pouvez cliquer sur n'importe quel bloc pays pour zoomer et voir ses sous-collections. La taille de chaque bloc représente le nombre d'éléments dans ce pays ou cette sous-collection.","viz.country.items":"Éléments","viz.country.percent_parent":"% du parent","viz.country.percent_total":"% du total","viz.country.click_zoom_in":"Cliquer pour zoomer","viz.country.click_zoom_out":"Cliquer pour dézoomer","viz.country.unknown":"Inconnu","viz.country.no_set":"Sans ensemble","viz.countries":"Pays","viz.sub_collections":"Sous-collections","viz.currently_viewing":"Affichage actuel","viz.click_back_to_return":'Cliquez sur le bouton "Retour à tous" pour revenir à la vue complète',"viz.click_zoom_in":"Cliquez sur un bloc pays pour zoomer","viz.unknown":"Inconnu","viz.no_set":"Sans ensemble","viz.word_distribution":"Répartition des mots","viz.total_words":"Nombre total de mots","viz.avg_words_per_item":"Moyenne de mots par élément","viz.back_to_all":"← Retour à tous","viz.total_items_with_word_count":"Total des éléments avec nombre de mots","viz.word_distribution_subtitle":"Répartition des mots par pays et ensemble d'éléments ({0} éléments, {1} mots)","viz.word_distribution_description":"Cette visualisation montre la répartition des mots dans les éléments par pays et collection. La taille de chaque bloc représente le nombre de mots dans ce pays ou cette collection.","viz.words":"mots","viz.items":"éléments","viz.percent_of_country":"% du pays","viz.percent_of_total":"% du total","viz.item_set_summary":"Résumé de l'ensemble d'éléments","lang.Français":"Français","lang.Anglais":"Anglais","lang.Haoussa":"Haoussa","lang.Allemand":"Allemand","lang.Arabe":"Arabe","lang.Italien":"Italien","lang.Dendi":"Dendi","lang.Slovène":"Slovène","lang.Espagnol":"Espagnol","country.all":"Tous les pays","country.Bénin":"Bénin","country.Nigéria":"Nigéria","country.Côte d'Ivoire":"Côte d'Ivoire","country.Burkina Faso":"Burkina Faso","country.Togo":"Togo","country.Niger":"Niger","country.Unknown":"Inconnu","type.Article de presse":"Article de presse","type.Notice d'autorité":"Notice d'autorité","type.Périodique islamique":"Périodique islamique","type.Unknown":"Inconnu","type.Article de revue":"Article de revue","type.Document":"Document","type.Article de blog":"Article de blog","type.Chapitre de livre":"Chapitre de livre","type.Livre":"Livre","type.Thèse de doctorat":"Thèse de doctorat","type.Communication scientifique":"Communication scientifique","type.Article d'encyclopédie":"Article d'encyclopédie","type.Compte rendu de livre":"Compte rendu de livre","type.Enregistrement vidéo":"Enregistrement vidéo","type.Mémoire de licence":"Mémoire de licence","type.Mémoire de maitrise":"Mémoire de maitrise","type.Photographie":"Photographie","type.Rapport":"Rapport","type.Working paper":"Working paper","type.all":"Tous les types","viz.index_distribution_title":"Répartition des index","viz.index_distribution_items":"Répartition de {0} éléments d'index par catégorie","viz.index_distribution_description":"Cette visualisation montre la répartition des éléments d'index par catégorie. La taille de chaque barre représente le nombre d'éléments dans cette catégorie. Les éléments d'index sont des notices d'autorité qui servent de points de référence dans la base de données.","viz.categories":"Catégories","viz.uncategorized":"Non catégorisé","viz.type_distribution_title":"Répartition par type","viz.type_distribution_items":"Répartition de {0} éléments par type","viz.type_distribution_description":"Cette visualisation montre la répartition des éléments par type au fil du temps. Vous pouvez filtrer par pays et par plage d'années pour explorer comment différents types d'éléments ont été publiés au fil du temps.","viz.types":"Types","viz.published_between":"publiés entre {0} et {1}","viz.type":"Type","viz.count":"Nombre","viz.others":"Autres","category.Events":"Événements","category.Locations":"Lieux","category.Organizations":"Organisations","category.Persons":"Personnes","category.Topics":"Sujets","category.Authority Files":"Notices d'autorité"}};function gs(){const{subscribe:t,set:e,update:n}=Ti("en"),r=typeof window<"u"&&window.location.hostname==="localhost";return{subscribe:t,setLanguage:i=>{r&&console.log("[Translation] Language changed to:",i),e(i)},toggleLanguage:()=>n(i=>i==="en"?"fr":"en")}}const ie=gs();function Ba(t,e){return e?t.replace(/{(\d+)}/g,(n,r)=>{const i=parseInt(r);return i<Object.keys(e).length?e[i].toString():n}):t}const at=(t,e)=>{var i;const n=Wl(ie),r=((i=Ua[n])==null?void 0:i[t])||t;return Ba(r,e)},ft=(t,e)=>ds(ie,n=>{var i;const r=((i=Ua[n])==null?void 0:i[t])||t;return Ba(r,e)});function ps(t){let e,n,r,i;return{c(){e=R("button"),n=j(t[0]),y(e,"class","btn btn-primary text-sm")},m(o,a){ut(o,e,a),b(e,n),r||(i=Zt(e,"click",t[2]),r=!0)},p(o,[a]){a&1&&ht(n,o[0])},i:xt,o:xt,d(o){o&&ct(e),r=!1,i()}}}function ys(t,e,n){let r;const i=ft("ui.toggle_language");vt(t,i,a=>n(0,r=a));function o(){ie.toggleLanguage()}return[r,i,o]}class vs extends pe{constructor(e){super(),ge(this,e,ys,ps,ce,{})}}function _s(t){let e,n,r,i,o;return{c(){e=Xt("svg"),n=Xt("path"),r=Xt("path"),i=Xt("path"),o=Xt("path"),y(n,"d","M8 3H5a2 2 0 0 0-2 2v3"),y(r,"d","M21 8V5a2 2 0 0 0-2-2h-3"),y(i,"d","M3 16v3a2 2 0 0 0 2 2h3"),y(o,"d","M16 21h3a2 2 0 0 0 2-2v-3"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"width","18"),y(e,"height","18"),y(e,"viewBox","0 0 24 24"),y(e,"fill","none"),y(e,"stroke","currentColor"),y(e,"stroke-width","2"),y(e,"stroke-linecap","round"),y(e,"stroke-linejoin","round"),y(e,"class","svelte-1laafbv")},m(a,l){ut(a,e,l),b(e,n),b(e,r),b(e,i),b(e,o)},d(a){a&&ct(e)}}}function bs(t){let e,n,r,i,o;return{c(){e=Xt("svg"),n=Xt("path"),r=Xt("path"),i=Xt("path"),o=Xt("path"),y(n,"d","M8 3v3a2 2 0 0 1-2 2H3"),y(r,"d","M21 8h-3a2 2 0 0 1-2-2V3"),y(i,"d","M3 16h3a2 2 0 0 1 2 2v3"),y(o,"d","M16 21v-3a2 2 0 0 1 2-2h3"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"width","18"),y(e,"height","18"),y(e,"viewBox","0 0 24 24"),y(e,"fill","none"),y(e,"stroke","currentColor"),y(e,"stroke-width","2"),y(e,"stroke-linecap","round"),y(e,"stroke-linejoin","round"),y(e,"class","svelte-1laafbv")},m(a,l){ut(a,e,l),b(e,n),b(e,r),b(e,i),b(e,o)},d(a){a&&ct(e)}}}function ws(t){let e,n,r,i,o;function a(s,f){return s[0]?bs:_s}let l=a(t),c=l(t);return{c(){e=R("button"),c.c(),y(e,"class","btn btn-primary btn-icon"),y(e,"title",n=t[0]?at("ui.exit_fullscreen"):at("ui.enter_fullscreen")),y(e,"aria-label",r=t[0]?at("ui.exit_fullscreen"):at("ui.enter_fullscreen"))},m(s,f){ut(s,e,f),c.m(e,null),i||(o=Zt(e,"click",xs),i=!0)},p(s,[f]){l!==(l=a(s))&&(c.d(1),c=l(s),c&&(c.c(),c.m(e,null))),f&1&&n!==(n=s[0]?at("ui.exit_fullscreen"):at("ui.enter_fullscreen"))&&y(e,"title",n),f&1&&r!==(r=s[0]?at("ui.exit_fullscreen"):at("ui.enter_fullscreen"))&&y(e,"aria-label",r)},i:xt,o:xt,d(s){s&&ct(e),c.d(),i=!1,o()}}}function xs(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen().catch(t=>{console.error(`Error attempting to enable fullscreen: ${t.message}`),ks()&&console.warn('This application is in an iframe. Make sure the iframe has the "allowfullscreen" attribute.')})}function ks(){try{return window.self!==window.top}catch{return!0}}function Ts(t,e,n){let r=!1;function i(){n(0,r=!!document.fullscreenElement)}return xe(()=>(document.addEventListener("fullscreenchange",i),()=>{document.removeEventListener("fullscreenchange",i)})),[r]}class Cs extends pe{constructor(e){super(),ge(this,e,Ts,ws,ce,{})}}function zs(t){let e,n,r,i,o,a,l;return{c(){e=R("button"),n=Xt("svg"),r=Xt("path"),i=Xt("polyline"),o=Xt("line"),y(r,"d","M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"),y(i,"points","7 10 12 15 17 10"),y(o,"x1","12"),y(o,"y1","15"),y(o,"x2","12"),y(o,"y2","3"),y(n,"xmlns","http://www.w3.org/2000/svg"),y(n,"width","18"),y(n,"height","18"),y(n,"viewBox","0 0 24 24"),y(n,"fill","none"),y(n,"stroke","currentColor"),y(n,"stroke-width","2"),y(n,"stroke-linecap","round"),y(n,"stroke-linejoin","round"),y(n,"class","svelte-1laafbv"),y(e,"class","btn btn-primary btn-icon"),y(e,"title",at("ui.download_visualization")),y(e,"aria-label",at("ui.download_visualization"))},m(c,s){ut(c,e,s),b(e,n),b(n,r),b(n,i),b(n,o),a||(l=Zt(e,"click",Ms),a=!0)},p:xt,i:xt,o:xt,d(c){c&&ct(e),a=!1,l()}}}function Ms(){var e,n,r,i;const t=document.querySelector(".visualization-content svg");if(!t){console.error("No SVG found to download");return}try{const o=t.cloneNode(!0),a=document.querySelector(".visualization-header h2");let l="";if(a&&(l=((e=a.textContent)==null?void 0:e.trim())||"",l||(l=((n=a.innerText)==null?void 0:n.trim())||""),l.includes("<")&&l.includes(">"))){const v=document.createElement("div");v.innerHTML=a.innerHTML,l=((r=v.textContent)==null?void 0:r.trim())||""}As(o),l&&Ds(o,l),Is(o),Es(o);const s=new XMLSerializer().serializeToString(o),f=new Blob([s],{type:"image/svg+xml;charset=utf-8"}),u=URL.createObjectURL(f),d=document.createElement("a");d.href=u;const h=document.querySelector(".tab-item.active"),m=h?(i=h.textContent)==null?void 0:i.trim():"visualization",p=`iwac-${Ls(l||m||"visualization")}`;d.download=`${p}.svg`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(u)}catch(o){console.error("Error downloading visualization:",o)}}function As(t){const e=Array.from(document.styleSheets),n=document.createElement("style");let r="";const i=getComputedStyle(document.documentElement),o=i.getPropertyValue("--font-family-base")||i.fontFamily||"'Arial', sans-serif";r+=`
            svg {
                font-family: ${o};
                font-size: ${i.fontSize||"14px"};
                line-height: ${i.lineHeight||"1.5"};
            }
        `;let a="";e.forEach(u=>{var d;try{const h=u.cssRules||u.rules;if(h)for(let m=0;m<h.length;m++){const g=h[m];if(g instanceof CSSStyleRule){const p=g.selectorText;p&&(p.includes("svg")||p.includes("g")||p.includes("path")||p.includes("rect")||p.includes("circle")||p.includes("text")||p.includes("line")||p.includes("polyline")||p.includes("polygon")||p.includes("axis")||p.includes("tick")||p.includes("label")||p.includes("legend")||p.includes("chart")||p.includes("bar")||p.includes("plot")||p.includes("point")||p.includes("marker")||p.includes("grid")||p.includes("visualization")||p.includes(".graph")||p.includes(".data")||p.includes(".series")||p.includes(".node")||p.includes(".link")||p.includes(".arc")||p.includes(".slice")||p.includes(".area")||p.includes(".line")||p.includes(".dot")||p.includes(".bubble")||p.includes(".tooltip")||p.includes(".domain")||p.includes(".tick")||/\b(vis|chart|graph|plot|axis|legend|tooltip)\b/i.test(p))&&(r+=g.cssText+`
`)}else if(g instanceof CSSFontFaceRule)a+=g.cssText+`
`;else if(g instanceof CSSImportRule)try{const p=(d=g.styleSheet)==null?void 0:d.cssRules;if(p)for(let v=0;v<p.length;v++)if(p[v]instanceof CSSStyleRule){const T=p[v].selectorText;T&&/\b(svg|g|path|rect|circle|text|line|axis|chart|graph|vis)\b/i.test(T)&&(r+=p[v].cssText+`
`)}else p[v]instanceof CSSFontFaceRule&&(a+=p[v].cssText+`
`)}catch(p){console.warn("Could not process imported stylesheet",p)}}}catch(h){console.warn("Could not access stylesheet rules",h)}});let l=`:root {
`;const c=getComputedStyle(document.documentElement);["--color-primary","--color-primary-dark","--color-primary-300","--color-text-light","--color-text-dark","--color-bg-page","--font-family-base","--font-size-base","--font-size-sm","--font-size-lg","--font-weight-normal","--font-weight-bold","--spacing-sm","--spacing-md","--spacing-lg","--color-text-primary","--color-border","--color-border-light"].forEach(u=>{const d=c.getPropertyValue(u);d&&(l+=`    ${u}: ${d};
`)}),e.forEach(u=>{try{const d=u.cssRules||u.rules;if(d){for(let h=0;h<d.length;h++)if(d[h]instanceof CSSStyleRule){const g=d[h].cssText.match(/var\(--[a-zA-Z0-9_-]+/g);g&&g.forEach(p=>{const v=p.substring(4);if(!l.includes(v)){const T=c.getPropertyValue(v);T&&(l+=`    ${v}: ${T};
`)}})}}}catch{}}),l+=`}
`;const f=a+l+r;if(n.textContent=f,t.firstChild?t.insertBefore(n,t.firstChild):t.appendChild(n),t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("version","1.1"),t.setAttribute("width",t.getAttribute("width")||"800"),t.setAttribute("height",t.getAttribute("height")||"600"),t.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),!t.style.backgroundColor){const u=i.getPropertyValue("--color-bg-page")||"#ffffff";t.style.backgroundColor=u}Ss(t)}function Ss(t){try{const e=t.querySelectorAll("text"),n=new Set;if(e.forEach(r=>{const i=r.getAttribute("font-family")||window.getComputedStyle(r).fontFamily;i&&i.split(",").forEach(o=>{const a=o.trim().replace(/['"]/g,"");a&&!a.includes("serif")&&!a.includes("sans")&&!a.includes("mono")&&!a.includes("Arial")&&!a.includes("Helvetica")&&n.add(a)})}),n.size>0){const r=Array.from(document.querySelectorAll("link")).filter(i=>i.href&&(i.href.includes("fonts.googleapis.com")||i.href.includes("fonts.gstatic.com")));if(r.length>0){const i=document.createComment(` Embedded fonts: ${Array.from(n).join(", ")} `);t.insertBefore(i,t.firstChild),r.forEach(o=>{const a=document.createElementNS("http://www.w3.org/2000/svg","style");a.textContent=`@import url('${o.href}');`,t.insertBefore(a,t.firstChild)})}}}catch(e){console.warn("Could not embed web fonts:",e)}}function Ds(t,e){const n=document.createElementNS("http://www.w3.org/2000/svg","title");n.textContent=e,t.firstChild?t.insertBefore(n,t.firstChild):t.appendChild(n);const r=parseInt(t.getAttribute("width")||"800");parseInt(t.getAttribute("height")||"600");const i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttribute("x",(r/2).toString()),i.setAttribute("y","24"),i.setAttribute("text-anchor","middle"),i.setAttribute("font-family","Arial, sans-serif"),i.setAttribute("font-size","16px"),i.setAttribute("font-weight","bold"),i.setAttribute("fill","var(--color-primary, #333)"),i.textContent=e,t.appendChild(i)}function Ls(t){let e=t.toLowerCase().replace(/[<>:"/\\|?*\x00-\x1F]/g,"-").replace(/\s+/g,"-").replace(/&/g,"and").replace(/--+/g,"-").replace(/^-+|-+$/g,"");return e.length>50&&(e=e.substring(0,50)),e.replace(/-+$/g,"")}function Is(t){t.querySelectorAll("*");const e=getComputedStyle(document.documentElement),n=e.getPropertyValue("--font-family-base")||e.fontFamily||"'Arial', sans-serif";if(t.querySelectorAll("text").forEach(i=>{i.hasAttribute("font-family")||i.setAttribute("font-family",n.replace(/['"]/g,""));const o=i.getAttribute("fill");(!o||o==="none"||o==="transparent")&&i.setAttribute("fill",e.getPropertyValue("--color-text-primary")||"#333333"),i.hasAttribute("font-size")||i.setAttribute("font-size",e.getPropertyValue("--font-size-base")||"14px")}),t.querySelectorAll(".axis path, .axis line, .domain").forEach(i=>{i instanceof SVGElement&&(i.hasAttribute("stroke")||i.setAttribute("stroke",e.getPropertyValue("--color-border")||"#cccccc"))}),t.querySelectorAll(".grid line, .grid path, .tick line").forEach(i=>{i instanceof SVGElement&&(i.hasAttribute("stroke")||i.setAttribute("stroke",e.getPropertyValue("--color-border-light")||"#e5e5e5"))}),t.querySelectorAll(".bar, .line, .area, .point, .mark").forEach(i=>{i instanceof SVGElement&&!i.hasAttribute("fill")&&i.tagName.toLowerCase()!=="line"&&i.setAttribute("fill",e.getPropertyValue("--color-primary")||"#4299e1")}),!t.hasAttribute("viewBox")&&t.hasAttribute("width")&&t.hasAttribute("height")){const i=t.getAttribute("width")||"800",o=t.getAttribute("height")||"600";t.setAttribute("viewBox",`0 0 ${i} ${o}`)}t.style.backgroundColor||(t.style.backgroundColor=e.getPropertyValue("--color-bg-page")||"#ffffff")}function Es(t){const e=parseInt(t.getAttribute("width")||"800"),n=parseInt(t.getAttribute("height")||"600"),r=getComputedStyle(document.documentElement),i=r.getPropertyValue("--color-bg-page")||r.getPropertyValue("--color-bg-primary")||"#ffffff",o=document.createElementNS("http://www.w3.org/2000/svg","rect");o.setAttribute("width",e.toString()),o.setAttribute("height",n.toString()),o.setAttribute("x","0"),o.setAttribute("y","0"),o.setAttribute("fill",i);const a=t.firstChild;a?t.insertBefore(o,a):t.appendChild(o),t.style.backgroundColor=i;const l=document.createComment(" Background rectangle added for proper rendering ");t.insertBefore(l,o)}class Ns extends pe{constructor(e){super(),ge(this,e,null,zs,ce,{})}}function Fs(t){let e;const n=t[1].default,r=Ma(n,t,t[0],null);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),e=!0},p(i,[o]){r&&r.p&&(!e||o&1)&&Da(r,n,i,i[0],e?Sa(n,i[0],o,null):La(i[0]),null)},i(i){e||($t(r,i),e=!0)},o(i){Ht(r,i),e=!1},d(i){r&&r.d(i)}}}const $s="TranslationContext";function Rs(t,e,n){let r;vt(t,ie,f=>n(5,r=f));let{$$slots:i={},$$scope:o}=e,a=!1,l=()=>{},c=r;rs("translationContext",{componentId:$s,getLanguage:()=>c,languageStore:ie});function s(f){a&&(c=f)}return xe(()=>{a=!0,l=ie.subscribe(f=>{s(f)})}),Ve(()=>{l&&l(),a=!1}),t.$$set=f=>{"$$scope"in f&&n(0,o=f.$$scope)},[o,i]}class Ps extends pe{constructor(e){super(),ge(this,e,Rs,Fs,ce,{})}}function fr(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Hs(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Ci(t){let e,n,r;t.length!==2?(e=fr,n=(l,c)=>fr(t(l),c),r=(l,c)=>t(l)-c):(e=t===fr||t===Hs?t:Us,n=t,r=t);function i(l,c,s=0,f=l.length){if(s<f){if(e(c,c)!==0)return f;do{const u=s+f>>>1;n(l[u],c)<0?s=u+1:f=u}while(s<f)}return s}function o(l,c,s=0,f=l.length){if(s<f){if(e(c,c)!==0)return f;do{const u=s+f>>>1;n(l[u],c)<=0?s=u+1:f=u}while(s<f)}return s}function a(l,c,s=0,f=l.length){const u=i(l,c,s,f-1);return u>s&&r(l[u-1],c)>-r(l[u],c)?u-1:u}return{left:i,center:a,right:o}}function Us(){return 0}function Bs(t){return t===null?NaN:+t}const Vs=Ci(fr),Ws=Vs.right;Ci(Bs).center;const Os=Ws;function Ys(t,e){let n,r;if(e===void 0)for(const i of t)i!=null&&(n===void 0?i>=i&&(n=r=i):(n>i&&(n=i),r<i&&(r=i)));else{let i=-1;for(let o of t)(o=e(o,++i,t))!=null&&(n===void 0?o>=o&&(n=r=o):(n>o&&(n=o),r<o&&(r=o)))}return[n,r]}class _n extends Map{constructor(e,n=Xs){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),e!=null)for(const[r,i]of e)this.set(r,i)}get(e){return super.get(ji(this,e))}has(e){return super.has(ji(this,e))}set(e,n){return super.set(qs(this,e),n)}delete(e){return super.delete(Ks(this,e))}}function ji({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):n}function qs({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):(t.set(r,n),n)}function Ks({_intern:t,_key:e},n){const r=e(n);return t.has(r)&&(n=t.get(r),t.delete(r)),n}function Xs(t){return t!==null&&typeof t=="object"?t.valueOf():t}function si(t){return t}function zi(t,...e){return Va(t,si,si,e)}function to(t,e,...n){return Va(t,si,e,n)}function Va(t,e,n,r){return function i(o,a){if(a>=r.length)return n(o);const l=new _n,c=r[a++];let s=-1;for(const f of o){const u=c(f,++s,o),d=l.get(u);d?d.push(f):l.set(u,[f])}for(const[f,u]of l)l.set(f,i(u,a));return e(l)}(t,0)}const Gs=Math.sqrt(50),Zs=Math.sqrt(10),Js=Math.sqrt(2);function br(t,e,n){const r=(e-t)/Math.max(0,n),i=Math.floor(Math.log10(r)),o=r/Math.pow(10,i),a=o>=Gs?10:o>=Zs?5:o>=Js?2:1;let l,c,s;return i<0?(s=Math.pow(10,-i)/a,l=Math.round(t*s),c=Math.round(e*s),l/s<t&&++l,c/s>e&&--c,s=-s):(s=Math.pow(10,i)*a,l=Math.round(t/s),c=Math.round(e/s),l*s<t&&++l,c*s>e&&--c),c<l&&.5<=n&&n<2?br(t,e,n*2):[l,c,s]}function ci(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const r=e<t,[i,o,a]=r?br(e,t,n):br(t,e,n);if(!(o>=i))return[];const l=o-i+1,c=new Array(l);if(r)if(a<0)for(let s=0;s<l;++s)c[s]=(o-s)/-a;else for(let s=0;s<l;++s)c[s]=(o-s)*a;else if(a<0)for(let s=0;s<l;++s)c[s]=(i+s)/-a;else for(let s=0;s<l;++s)c[s]=(i+s)*a;return c}function ui(t,e,n){return e=+e,t=+t,n=+n,br(t,e,n)[2]}function fi(t,e,n){e=+e,t=+t,n=+n;const r=e<t,i=r?ui(e,t,n):ui(t,e,n);return(r?-1:1)*(i<0?1/-i:i)}function kn(t,e){let n;if(e===void 0)for(const r of t)r!=null&&(n<r||n===void 0&&r>=r)&&(n=r);else{let r=-1;for(let i of t)(i=e(i,++r,t))!=null&&(n<i||n===void 0&&i>=i)&&(n=i)}return n}function Qs(t,e,n){t=+t,e=+e,n=(i=arguments.length)<2?(e=t,t=0,1):i<3?1:+n;for(var r=-1,i=Math.max(0,Math.ceil((e-t)/n))|0,o=new Array(i);++r<i;)o[r]=t+r*n;return o}function js(t){return t}var dr=1,hr=2,di=3,Wn=4,eo=1e-6;function tc(t){return"translate("+t+",0)"}function ec(t){return"translate(0,"+t+")"}function nc(t){return e=>+t(e)}function rc(t,e){return e=Math.max(0,t.bandwidth()-e*2)/2,t.round()&&(e=Math.round(e)),n=>+t(n)+e}function ic(){return!this.__axis}function Ur(t,e){var n=[],r=null,i=null,o=6,a=6,l=3,c=typeof window<"u"&&window.devicePixelRatio>1?0:.5,s=t===dr||t===Wn?-1:1,f=t===Wn||t===hr?"x":"y",u=t===dr||t===di?tc:ec;function d(h){var m=r??(e.ticks?e.ticks.apply(e,n):e.domain()),g=i??(e.tickFormat?e.tickFormat.apply(e,n):js),p=Math.max(o,0)+l,v=e.range(),T=+v[0]+c,M=+v[v.length-1]+c,x=(e.bandwidth?rc:nc)(e.copy(),c),k=h.selection?h.selection():h,w=k.selectAll(".domain").data([null]),S=k.selectAll(".tick").data(m,e).order(),N=S.exit(),H=S.enter().append("g").attr("class","tick"),U=S.select("line"),_=S.select("text");w=w.merge(w.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),S=S.merge(H),U=U.merge(H.append("line").attr("stroke","currentColor").attr(f+"2",s*o)),_=_.merge(H.append("text").attr("fill","currentColor").attr(f,s*p).attr("dy",t===dr?"0em":t===di?"0.71em":"0.32em")),h!==k&&(w=w.transition(h),S=S.transition(h),U=U.transition(h),_=_.transition(h),N=N.transition(h).attr("opacity",eo).attr("transform",function(X){return isFinite(X=x(X))?u(X+c):this.getAttribute("transform")}),H.attr("opacity",eo).attr("transform",function(X){var A=this.parentNode.__axis;return u((A&&isFinite(A=A(X))?A:x(X))+c)})),N.remove(),w.attr("d",t===Wn||t===hr?a?"M"+s*a+","+T+"H"+c+"V"+M+"H"+s*a:"M"+c+","+T+"V"+M:a?"M"+T+","+s*a+"V"+c+"H"+M+"V"+s*a:"M"+T+","+c+"H"+M),S.attr("opacity",1).attr("transform",function(X){return u(x(X)+c)}),U.attr(f+"2",s*o),_.attr(f,s*p).text(g),k.filter(ic).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===hr?"start":t===Wn?"end":"middle"),k.each(function(){this.__axis=x})}return d.scale=function(h){return arguments.length?(e=h,d):e},d.ticks=function(){return n=Array.from(arguments),d},d.tickArguments=function(h){return arguments.length?(n=h==null?[]:Array.from(h),d):n.slice()},d.tickValues=function(h){return arguments.length?(r=h==null?null:Array.from(h),d):r&&r.slice()},d.tickFormat=function(h){return arguments.length?(i=h,d):i},d.tickSize=function(h){return arguments.length?(o=a=+h,d):o},d.tickSizeInner=function(h){return arguments.length?(o=+h,d):o},d.tickSizeOuter=function(h){return arguments.length?(a=+h,d):a},d.tickPadding=function(h){return arguments.length?(l=+h,d):l},d.offset=function(h){return arguments.length?(c=+h,d):c},d}function oc(t){return Ur(dr,t)}function ac(t){return Ur(hr,t)}function wr(t){return Ur(di,t)}function xr(t){return Ur(Wn,t)}var lc={value:()=>{}};function Wa(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new mr(n)}function mr(t){this._=t}function sc(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}mr.prototype=Wa.prototype={constructor:mr,on:function(t,e){var n=this._,r=sc(t+"",n),i,o=-1,a=r.length;if(arguments.length<2){for(;++o<a;)if((i=(t=r[o]).type)&&(i=cc(n[i],t.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++o<a;)if(i=(t=r[o]).type)n[i]=no(n[i],t.name,e);else if(e==null)for(i in n)n[i]=no(n[i],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new mr(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,o;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=this._[t],r=0,i=o.length;r<i;++r)o[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(e,n)}};function cc(t,e){for(var n=0,r=t.length,i;n<r;++n)if((i=t[n]).name===e)return i.value}function no(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=lc,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var hi="http://www.w3.org/1999/xhtml";const ro={svg:"http://www.w3.org/2000/svg",xhtml:hi,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Br(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),ro.hasOwnProperty(e)?{space:ro[e],local:t}:t}function uc(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===hi&&e.documentElement.namespaceURI===hi?e.createElement(t):e.createElementNS(n,t)}}function fc(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Oa(t){var e=Br(t);return(e.local?fc:uc)(e)}function dc(){}function Mi(t){return t==null?dc:function(){return this.querySelector(t)}}function hc(t){typeof t!="function"&&(t=Mi(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o=e[i],a=o.length,l=r[i]=new Array(a),c,s,f=0;f<a;++f)(c=o[f])&&(s=t.call(c,c.__data__,f,o))&&("__data__"in c&&(s.__data__=c.__data__),l[f]=s);return new _e(r,this._parents)}function mc(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function gc(){return[]}function Ya(t){return t==null?gc:function(){return this.querySelectorAll(t)}}function pc(t){return function(){return mc(t.apply(this,arguments))}}function yc(t){typeof t=="function"?t=pc(t):t=Ya(t);for(var e=this._groups,n=e.length,r=[],i=[],o=0;o<n;++o)for(var a=e[o],l=a.length,c,s=0;s<l;++s)(c=a[s])&&(r.push(t.call(c,c.__data__,s,a)),i.push(c));return new _e(r,i)}function qa(t){return function(){return this.matches(t)}}function Ka(t){return function(e){return e.matches(t)}}var vc=Array.prototype.find;function _c(t){return function(){return vc.call(this.children,t)}}function bc(){return this.firstElementChild}function wc(t){return this.select(t==null?bc:_c(typeof t=="function"?t:Ka(t)))}var xc=Array.prototype.filter;function kc(){return Array.from(this.children)}function Tc(t){return function(){return xc.call(this.children,t)}}function Cc(t){return this.selectAll(t==null?kc:Tc(typeof t=="function"?t:Ka(t)))}function zc(t){typeof t!="function"&&(t=qa(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o=e[i],a=o.length,l=r[i]=[],c,s=0;s<a;++s)(c=o[s])&&t.call(c,c.__data__,s,o)&&l.push(c);return new _e(r,this._parents)}function Xa(t){return new Array(t.length)}function Mc(){return new _e(this._enter||this._groups.map(Xa),this._parents)}function kr(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}kr.prototype={constructor:kr,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function Ac(t){return function(){return t}}function Sc(t,e,n,r,i,o){for(var a=0,l,c=e.length,s=o.length;a<s;++a)(l=e[a])?(l.__data__=o[a],r[a]=l):n[a]=new kr(t,o[a]);for(;a<c;++a)(l=e[a])&&(i[a]=l)}function Dc(t,e,n,r,i,o,a){var l,c,s=new Map,f=e.length,u=o.length,d=new Array(f),h;for(l=0;l<f;++l)(c=e[l])&&(d[l]=h=a.call(c,c.__data__,l,e)+"",s.has(h)?i[l]=c:s.set(h,c));for(l=0;l<u;++l)h=a.call(t,o[l],l,o)+"",(c=s.get(h))?(r[l]=c,c.__data__=o[l],s.delete(h)):n[l]=new kr(t,o[l]);for(l=0;l<f;++l)(c=e[l])&&s.get(d[l])===c&&(i[l]=c)}function Lc(t){return t.__data__}function Ic(t,e){if(!arguments.length)return Array.from(this,Lc);var n=e?Dc:Sc,r=this._parents,i=this._groups;typeof t!="function"&&(t=Ac(t));for(var o=i.length,a=new Array(o),l=new Array(o),c=new Array(o),s=0;s<o;++s){var f=r[s],u=i[s],d=u.length,h=Ec(t.call(f,f&&f.__data__,s,r)),m=h.length,g=l[s]=new Array(m),p=a[s]=new Array(m),v=c[s]=new Array(d);n(f,u,g,p,v,h,e);for(var T=0,M=0,x,k;T<m;++T)if(x=g[T]){for(T>=M&&(M=T+1);!(k=p[M])&&++M<m;);x._next=k||null}}return a=new _e(a,r),a._enter=l,a._exit=c,a}function Ec(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Nc(){return new _e(this._exit||this._groups.map(Xa),this._parents)}function Fc(t,e,n){var r=this.enter(),i=this,o=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(i=e(i),i&&(i=i.selection())),n==null?o.remove():n(o),r&&i?r.merge(i).order():i}function $c(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,o=r.length,a=Math.min(i,o),l=new Array(i),c=0;c<a;++c)for(var s=n[c],f=r[c],u=s.length,d=l[c]=new Array(u),h,m=0;m<u;++m)(h=s[m]||f[m])&&(d[m]=h);for(;c<i;++c)l[c]=n[c];return new _e(l,this._parents)}function Rc(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],i=r.length-1,o=r[i],a;--i>=0;)(a=r[i])&&(o&&a.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(a,o),o=a);return this}function Pc(t){t||(t=Hc);function e(u,d){return u&&d?t(u.__data__,d.__data__):!u-!d}for(var n=this._groups,r=n.length,i=new Array(r),o=0;o<r;++o){for(var a=n[o],l=a.length,c=i[o]=new Array(l),s,f=0;f<l;++f)(s=a[f])&&(c[f]=s);c.sort(e)}return new _e(i,this._parents).order()}function Hc(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Uc(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function Bc(){return Array.from(this)}function Vc(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length;i<o;++i){var a=r[i];if(a)return a}return null}function Wc(){let t=0;for(const e of this)++t;return t}function Oc(){return!this.node()}function Yc(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i=e[n],o=0,a=i.length,l;o<a;++o)(l=i[o])&&t.call(l,l.__data__,o,i);return this}function qc(t){return function(){this.removeAttribute(t)}}function Kc(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Xc(t,e){return function(){this.setAttribute(t,e)}}function Gc(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Zc(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function Jc(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function Qc(t,e){var n=Br(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?Kc:qc:typeof e=="function"?n.local?Jc:Zc:n.local?Gc:Xc)(n,e))}function Ga(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function jc(t){return function(){this.style.removeProperty(t)}}function tu(t,e,n){return function(){this.style.setProperty(t,e,n)}}function eu(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function nu(t,e,n){return arguments.length>1?this.each((e==null?jc:typeof e=="function"?eu:tu)(t,e,n??"")):Tn(this.node(),t)}function Tn(t,e){return t.style.getPropertyValue(e)||Ga(t).getComputedStyle(t,null).getPropertyValue(e)}function ru(t){return function(){delete this[t]}}function iu(t,e){return function(){this[t]=e}}function ou(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function au(t,e){return arguments.length>1?this.each((e==null?ru:typeof e=="function"?ou:iu)(t,e)):this.node()[t]}function Za(t){return t.trim().split(/^|\s+/)}function Ai(t){return t.classList||new Ja(t)}function Ja(t){this._node=t,this._names=Za(t.getAttribute("class")||"")}Ja.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Qa(t,e){for(var n=Ai(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function ja(t,e){for(var n=Ai(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function lu(t){return function(){Qa(this,t)}}function su(t){return function(){ja(this,t)}}function cu(t,e){return function(){(e.apply(this,arguments)?Qa:ja)(this,t)}}function uu(t,e){var n=Za(t+"");if(arguments.length<2){for(var r=Ai(this.node()),i=-1,o=n.length;++i<o;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof e=="function"?cu:e?lu:su)(n,e))}function fu(){this.textContent=""}function du(t){return function(){this.textContent=t}}function hu(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function mu(t){return arguments.length?this.each(t==null?fu:(typeof t=="function"?hu:du)(t)):this.node().textContent}function gu(){this.innerHTML=""}function pu(t){return function(){this.innerHTML=t}}function yu(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function vu(t){return arguments.length?this.each(t==null?gu:(typeof t=="function"?yu:pu)(t)):this.node().innerHTML}function _u(){this.nextSibling&&this.parentNode.appendChild(this)}function bu(){return this.each(_u)}function wu(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function xu(){return this.each(wu)}function ku(t){var e=typeof t=="function"?t:Oa(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Tu(){return null}function Cu(t,e){var n=typeof t=="function"?t:Oa(t),r=e==null?Tu:typeof e=="function"?e:Mi(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function zu(){var t=this.parentNode;t&&t.removeChild(this)}function Mu(){return this.each(zu)}function Au(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Su(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Du(t){return this.select(t?Su:Au)}function Lu(t){return arguments.length?this.property("__data__",t):this.node().__data__}function Iu(t){return function(e){t.call(this,e,this.__data__)}}function Eu(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function Nu(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,i=e.length,o;n<i;++n)o=e[n],(!t.type||o.type===t.type)&&o.name===t.name?this.removeEventListener(o.type,o.listener,o.options):e[++r]=o;++r?e.length=r:delete this.__on}}}function Fu(t,e,n){return function(){var r=this.__on,i,o=Iu(e);if(r){for(var a=0,l=r.length;a<l;++a)if((i=r[a]).type===t.type&&i.name===t.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=n),i.value=e;return}}this.addEventListener(t.type,o,n),i={type:t.type,name:t.name,value:e,listener:o,options:n},r?r.push(i):this.__on=[i]}}function $u(t,e,n){var r=Eu(t+""),i,o=r.length,a;if(arguments.length<2){var l=this.node().__on;if(l){for(var c=0,s=l.length,f;c<s;++c)for(i=0,f=l[c];i<o;++i)if((a=r[i]).type===f.type&&a.name===f.name)return f.value}return}for(l=e?Fu:Nu,i=0;i<o;++i)this.each(l(r[i],e,n));return this}function tl(t,e,n){var r=Ga(t),i=r.CustomEvent;typeof i=="function"?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function Ru(t,e){return function(){return tl(this,t,e)}}function Pu(t,e){return function(){return tl(this,t,e.apply(this,arguments))}}function Hu(t,e){return this.each((typeof e=="function"?Pu:Ru)(t,e))}function*Uu(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length,a;i<o;++i)(a=r[i])&&(yield a)}var el=[null];function _e(t,e){this._groups=t,this._parents=e}function Ln(){return new _e([[document.documentElement]],el)}function Bu(){return this}_e.prototype=Ln.prototype={constructor:_e,select:hc,selectAll:yc,selectChild:wc,selectChildren:Cc,filter:zc,data:Ic,enter:Mc,exit:Nc,join:Fc,merge:$c,selection:Bu,order:Rc,sort:Pc,call:Uc,nodes:Bc,node:Vc,size:Wc,empty:Oc,each:Yc,attr:Qc,style:nu,property:au,classed:uu,text:mu,html:vu,raise:bu,lower:xu,append:ku,insert:Cu,remove:Mu,clone:Du,datum:Lu,on:$u,dispatch:Hu,[Symbol.iterator]:Uu};function mt(t){return typeof t=="string"?new _e([[document.querySelector(t)]],[document.documentElement]):new _e([[t]],el)}function Si(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function nl(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function er(){}var Gn=.7,Tr=1/Gn,bn="\\s*([+-]?\\d+)\\s*",Zn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Le="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Vu=/^#([0-9a-f]{3,8})$/,Wu=new RegExp(`^rgb\\(${bn},${bn},${bn}\\)$`),Ou=new RegExp(`^rgb\\(${Le},${Le},${Le}\\)$`),Yu=new RegExp(`^rgba\\(${bn},${bn},${bn},${Zn}\\)$`),qu=new RegExp(`^rgba\\(${Le},${Le},${Le},${Zn}\\)$`),Ku=new RegExp(`^hsl\\(${Zn},${Le},${Le}\\)$`),Xu=new RegExp(`^hsla\\(${Zn},${Le},${Le},${Zn}\\)$`),io={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Si(er,nn,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:oo,formatHex:oo,formatHex8:Gu,formatHsl:Zu,formatRgb:ao,toString:ao});function oo(){return this.rgb().formatHex()}function Gu(){return this.rgb().formatHex8()}function Zu(){return rl(this).formatHsl()}function ao(){return this.rgb().formatRgb()}function nn(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Vu.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?lo(e):n===3?new he(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?ir(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?ir(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Wu.exec(t))?new he(e[1],e[2],e[3],1):(e=Ou.exec(t))?new he(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Yu.exec(t))?ir(e[1],e[2],e[3],e[4]):(e=qu.exec(t))?ir(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Ku.exec(t))?uo(e[1],e[2]/100,e[3]/100,1):(e=Xu.exec(t))?uo(e[1],e[2]/100,e[3]/100,e[4]):io.hasOwnProperty(t)?lo(io[t]):t==="transparent"?new he(NaN,NaN,NaN,0):null}function lo(t){return new he(t>>16&255,t>>8&255,t&255,1)}function ir(t,e,n,r){return r<=0&&(t=e=n=NaN),new he(t,e,n,r)}function Ju(t){return t instanceof er||(t=nn(t)),t?(t=t.rgb(),new he(t.r,t.g,t.b,t.opacity)):new he}function de(t,e,n,r){return arguments.length===1?Ju(t):new he(t,e,n,r??1)}function he(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}Si(he,de,nl(er,{brighter(t){return t=t==null?Tr:Math.pow(Tr,t),new he(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Gn:Math.pow(Gn,t),new he(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new he(tn(this.r),tn(this.g),tn(this.b),Cr(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:so,formatHex:so,formatHex8:Qu,formatRgb:co,toString:co}));function so(){return`#${je(this.r)}${je(this.g)}${je(this.b)}`}function Qu(){return`#${je(this.r)}${je(this.g)}${je(this.b)}${je((isNaN(this.opacity)?1:this.opacity)*255)}`}function co(){const t=Cr(this.opacity);return`${t===1?"rgb(":"rgba("}${tn(this.r)}, ${tn(this.g)}, ${tn(this.b)}${t===1?")":`, ${t})`}`}function Cr(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function tn(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function je(t){return t=tn(t),(t<16?"0":"")+t.toString(16)}function uo(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Te(t,e,n,r)}function rl(t){if(t instanceof Te)return new Te(t.h,t.s,t.l,t.opacity);if(t instanceof er||(t=nn(t)),!t)return new Te;if(t instanceof Te)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),o=Math.max(e,n,r),a=NaN,l=o-i,c=(o+i)/2;return l?(e===o?a=(n-r)/l+(n<r)*6:n===o?a=(r-e)/l+2:a=(e-n)/l+4,l/=c<.5?o+i:2-o-i,a*=60):l=c>0&&c<1?0:a,new Te(a,l,c,t.opacity)}function ju(t,e,n,r){return arguments.length===1?rl(t):new Te(t,e,n,r??1)}function Te(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}Si(Te,ju,nl(er,{brighter(t){return t=t==null?Tr:Math.pow(Tr,t),new Te(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Gn:Math.pow(Gn,t),new Te(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new he(Zr(t>=240?t-240:t+120,i,r),Zr(t,i,r),Zr(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new Te(fo(this.h),or(this.s),or(this.l),Cr(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Cr(this.opacity);return`${t===1?"hsl(":"hsla("}${fo(this.h)}, ${or(this.s)*100}%, ${or(this.l)*100}%${t===1?")":`, ${t})`}`}}));function fo(t){return t=(t||0)%360,t<0?t+360:t}function or(t){return Math.max(0,Math.min(1,t||0))}function Zr(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}function tf(t,e,n,r,i){var o=t*t,a=o*t;return((1-3*t+3*o-a)*e+(4-6*o+3*a)*n+(1+3*t+3*o-3*a)*r+a*i)/6}function ef(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),i=t[r],o=t[r+1],a=r>0?t[r-1]:2*i-o,l=r<e-1?t[r+2]:2*o-i;return tf((n-r/e)*e,a,i,o,l)}}const Di=t=>()=>t;function nf(t,e){return function(n){return t+n*e}}function rf(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function of(t){return(t=+t)==1?il:function(e,n){return n-e?rf(e,n,t):Di(isNaN(e)?n:e)}}function il(t,e){var n=e-t;return n?nf(t,n):Di(isNaN(t)?e:t)}const zr=function t(e){var n=of(e);function r(i,o){var a=n((i=de(i)).r,(o=de(o)).r),l=n(i.g,o.g),c=n(i.b,o.b),s=il(i.opacity,o.opacity);return function(f){return i.r=a(f),i.g=l(f),i.b=c(f),i.opacity=s(f),i+""}}return r.gamma=t,r}(1);function af(t){return function(e){var n=e.length,r=new Array(n),i=new Array(n),o=new Array(n),a,l;for(a=0;a<n;++a)l=de(e[a]),r[a]=l.r||0,i[a]=l.g||0,o[a]=l.b||0;return r=t(r),i=t(i),o=t(o),l.opacity=1,function(c){return l.r=r(c),l.g=i(c),l.b=o(c),l+""}}}var lf=af(ef);function sf(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),i;return function(o){for(i=0;i<n;++i)r[i]=t[i]*(1-o)+e[i]*o;return r}}function cf(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function uf(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,i=new Array(r),o=new Array(n),a;for(a=0;a<r;++a)i[a]=Cn(t[a],e[a]);for(;a<n;++a)o[a]=e[a];return function(l){for(a=0;a<r;++a)o[a]=i[a](l);return o}}function ff(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function ke(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function df(t,e){var n={},r={},i;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in t?n[i]=Cn(t[i],e[i]):r[i]=e[i];return function(o){for(i in n)r[i]=n[i](o);return r}}var mi=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Jr=new RegExp(mi.source,"g");function hf(t){return function(){return t}}function mf(t){return function(e){return t(e)+""}}function ol(t,e){var n=mi.lastIndex=Jr.lastIndex=0,r,i,o,a=-1,l=[],c=[];for(t=t+"",e=e+"";(r=mi.exec(t))&&(i=Jr.exec(e));)(o=i.index)>n&&(o=e.slice(n,o),l[a]?l[a]+=o:l[++a]=o),(r=r[0])===(i=i[0])?l[a]?l[a]+=i:l[++a]=i:(l[++a]=null,c.push({i:a,x:ke(r,i)})),n=Jr.lastIndex;return n<e.length&&(o=e.slice(n),l[a]?l[a]+=o:l[++a]=o),l.length<2?c[0]?mf(c[0].x):hf(e):(e=c.length,function(s){for(var f=0,u;f<e;++f)l[(u=c[f]).i]=u.x(s);return l.join("")})}function Cn(t,e){var n=typeof e,r;return e==null||n==="boolean"?Di(e):(n==="number"?ke:n==="string"?(r=nn(e))?(e=r,zr):ol:e instanceof nn?zr:e instanceof Date?ff:cf(e)?sf:Array.isArray(e)?uf:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?df:ke)(t,e)}function al(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var ho=180/Math.PI,gi={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function ll(t,e,n,r,i,o){var a,l,c;return(a=Math.sqrt(t*t+e*e))&&(t/=a,e/=a),(c=t*n+e*r)&&(n-=t*c,r-=e*c),(l=Math.sqrt(n*n+r*r))&&(n/=l,r/=l,c/=l),t*r<e*n&&(t=-t,e=-e,c=-c,a=-a),{translateX:i,translateY:o,rotate:Math.atan2(e,t)*ho,skewX:Math.atan(c)*ho,scaleX:a,scaleY:l}}var ar;function gf(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?gi:ll(e.a,e.b,e.c,e.d,e.e,e.f)}function pf(t){return t==null||(ar||(ar=document.createElementNS("http://www.w3.org/2000/svg","g")),ar.setAttribute("transform",t),!(t=ar.transform.baseVal.consolidate()))?gi:(t=t.matrix,ll(t.a,t.b,t.c,t.d,t.e,t.f))}function sl(t,e,n,r){function i(s){return s.length?s.pop()+" ":""}function o(s,f,u,d,h,m){if(s!==u||f!==d){var g=h.push("translate(",null,e,null,n);m.push({i:g-4,x:ke(s,u)},{i:g-2,x:ke(f,d)})}else(u||d)&&h.push("translate("+u+e+d+n)}function a(s,f,u,d){s!==f?(s-f>180?f+=360:f-s>180&&(s+=360),d.push({i:u.push(i(u)+"rotate(",null,r)-2,x:ke(s,f)})):f&&u.push(i(u)+"rotate("+f+r)}function l(s,f,u,d){s!==f?d.push({i:u.push(i(u)+"skewX(",null,r)-2,x:ke(s,f)}):f&&u.push(i(u)+"skewX("+f+r)}function c(s,f,u,d,h,m){if(s!==u||f!==d){var g=h.push(i(h)+"scale(",null,",",null,")");m.push({i:g-4,x:ke(s,u)},{i:g-2,x:ke(f,d)})}else(u!==1||d!==1)&&h.push(i(h)+"scale("+u+","+d+")")}return function(s,f){var u=[],d=[];return s=t(s),f=t(f),o(s.translateX,s.translateY,f.translateX,f.translateY,u,d),a(s.rotate,f.rotate,u,d),l(s.skewX,f.skewX,u,d),c(s.scaleX,s.scaleY,f.scaleX,f.scaleY,u,d),s=f=null,function(h){for(var m=-1,g=d.length,p;++m<g;)u[(p=d[m]).i]=p.x(h);return u.join("")}}}var yf=sl(gf,"px, ","px)","deg)"),vf=sl(pf,", ",")",")"),zn=0,On=0,Rn=0,cl=1e3,Mr,Yn,Ar=0,rn=0,Vr=0,Jn=typeof performance=="object"&&performance.now?performance:Date,ul=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Li(){return rn||(ul(_f),rn=Jn.now()+Vr)}function _f(){rn=0}function Sr(){this._call=this._time=this._next=null}Sr.prototype=fl.prototype={constructor:Sr,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?Li():+n)+(e==null?0:+e),!this._next&&Yn!==this&&(Yn?Yn._next=this:Mr=this,Yn=this),this._call=t,this._time=n,pi()},stop:function(){this._call&&(this._call=null,this._time=1/0,pi())}};function fl(t,e,n){var r=new Sr;return r.restart(t,e,n),r}function bf(){Li(),++zn;for(var t=Mr,e;t;)(e=rn-t._time)>=0&&t._call.call(void 0,e),t=t._next;--zn}function mo(){rn=(Ar=Jn.now())+Vr,zn=On=0;try{bf()}finally{zn=0,xf(),rn=0}}function wf(){var t=Jn.now(),e=t-Ar;e>cl&&(Vr-=e,Ar=t)}function xf(){for(var t,e=Mr,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:Mr=n);Yn=t,pi(r)}function pi(t){if(!zn){On&&(On=clearTimeout(On));var e=t-rn;e>24?(t<1/0&&(On=setTimeout(mo,t-Jn.now()-Vr)),Rn&&(Rn=clearInterval(Rn))):(Rn||(Ar=Jn.now(),Rn=setInterval(wf,cl)),zn=1,ul(mo))}}function go(t,e,n){var r=new Sr;return e=e==null?0:+e,r.restart(i=>{r.stop(),t(i+e)},e,n),r}var kf=Wa("start","end","cancel","interrupt"),Tf=[],dl=0,po=1,yi=2,gr=3,yo=4,vi=5,pr=6;function Wr(t,e,n,r,i,o){var a=t.__transition;if(!a)t.__transition={};else if(n in a)return;Cf(t,n,{name:e,index:r,group:i,on:kf,tween:Tf,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:dl})}function Ii(t,e){var n=ze(t,e);if(n.state>dl)throw new Error("too late; already scheduled");return n}function Ie(t,e){var n=ze(t,e);if(n.state>gr)throw new Error("too late; already running");return n}function ze(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function Cf(t,e,n){var r=t.__transition,i;r[e]=n,n.timer=fl(o,0,n.time);function o(s){n.state=po,n.timer.restart(a,n.delay,n.time),n.delay<=s&&a(s-n.delay)}function a(s){var f,u,d,h;if(n.state!==po)return c();for(f in r)if(h=r[f],h.name===n.name){if(h.state===gr)return go(a);h.state===yo?(h.state=pr,h.timer.stop(),h.on.call("interrupt",t,t.__data__,h.index,h.group),delete r[f]):+f<e&&(h.state=pr,h.timer.stop(),h.on.call("cancel",t,t.__data__,h.index,h.group),delete r[f])}if(go(function(){n.state===gr&&(n.state=yo,n.timer.restart(l,n.delay,n.time),l(s))}),n.state=yi,n.on.call("start",t,t.__data__,n.index,n.group),n.state===yi){for(n.state=gr,i=new Array(d=n.tween.length),f=0,u=-1;f<d;++f)(h=n.tween[f].value.call(t,t.__data__,n.index,n.group))&&(i[++u]=h);i.length=u+1}}function l(s){for(var f=s<n.duration?n.ease.call(null,s/n.duration):(n.timer.restart(c),n.state=vi,1),u=-1,d=i.length;++u<d;)i[u].call(t,f);n.state===vi&&(n.on.call("end",t,t.__data__,n.index,n.group),c())}function c(){n.state=pr,n.timer.stop(),delete r[e];for(var s in r)return;delete t.__transition}}function zf(t,e){var n=t.__transition,r,i,o=!0,a;if(n){e=e==null?null:e+"";for(a in n){if((r=n[a]).name!==e){o=!1;continue}i=r.state>yi&&r.state<vi,r.state=pr,r.timer.stop(),r.on.call(i?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[a]}o&&delete t.__transition}}function Mf(t){return this.each(function(){zf(this,t)})}function Af(t,e){var n,r;return function(){var i=Ie(this,t),o=i.tween;if(o!==n){r=n=o;for(var a=0,l=r.length;a<l;++a)if(r[a].name===e){r=r.slice(),r.splice(a,1);break}}i.tween=r}}function Sf(t,e,n){var r,i;if(typeof n!="function")throw new Error;return function(){var o=Ie(this,t),a=o.tween;if(a!==r){i=(r=a).slice();for(var l={name:e,value:n},c=0,s=i.length;c<s;++c)if(i[c].name===e){i[c]=l;break}c===s&&i.push(l)}o.tween=i}}function Df(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=ze(this.node(),n).tween,i=0,o=r.length,a;i<o;++i)if((a=r[i]).name===t)return a.value;return null}return this.each((e==null?Af:Sf)(n,t,e))}function Ei(t,e,n){var r=t._id;return t.each(function(){var i=Ie(this,r);(i.value||(i.value={}))[e]=n.apply(this,arguments)}),function(i){return ze(i,r).value[e]}}function hl(t,e){var n;return(typeof e=="number"?ke:e instanceof nn?zr:(n=nn(e))?(e=n,zr):ol)(t,e)}function Lf(t){return function(){this.removeAttribute(t)}}function If(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Ef(t,e,n){var r,i=n+"",o;return function(){var a=this.getAttribute(t);return a===i?null:a===r?o:o=e(r=a,n)}}function Nf(t,e,n){var r,i=n+"",o;return function(){var a=this.getAttributeNS(t.space,t.local);return a===i?null:a===r?o:o=e(r=a,n)}}function Ff(t,e,n){var r,i,o;return function(){var a,l=n(this),c;return l==null?void this.removeAttribute(t):(a=this.getAttribute(t),c=l+"",a===c?null:a===r&&c===i?o:(i=c,o=e(r=a,l)))}}function $f(t,e,n){var r,i,o;return function(){var a,l=n(this),c;return l==null?void this.removeAttributeNS(t.space,t.local):(a=this.getAttributeNS(t.space,t.local),c=l+"",a===c?null:a===r&&c===i?o:(i=c,o=e(r=a,l)))}}function Rf(t,e){var n=Br(t),r=n==="transform"?vf:hl;return this.attrTween(t,typeof e=="function"?(n.local?$f:Ff)(n,r,Ei(this,"attr."+t,e)):e==null?(n.local?If:Lf)(n):(n.local?Nf:Ef)(n,r,e))}function Pf(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function Hf(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function Uf(t,e){var n,r;function i(){var o=e.apply(this,arguments);return o!==r&&(n=(r=o)&&Hf(t,o)),n}return i._value=e,i}function Bf(t,e){var n,r;function i(){var o=e.apply(this,arguments);return o!==r&&(n=(r=o)&&Pf(t,o)),n}return i._value=e,i}function Vf(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=Br(t);return this.tween(n,(r.local?Uf:Bf)(r,e))}function Wf(t,e){return function(){Ii(this,t).delay=+e.apply(this,arguments)}}function Of(t,e){return e=+e,function(){Ii(this,t).delay=e}}function Yf(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Wf:Of)(e,t)):ze(this.node(),e).delay}function qf(t,e){return function(){Ie(this,t).duration=+e.apply(this,arguments)}}function Kf(t,e){return e=+e,function(){Ie(this,t).duration=e}}function Xf(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?qf:Kf)(e,t)):ze(this.node(),e).duration}function Gf(t,e){if(typeof e!="function")throw new Error;return function(){Ie(this,t).ease=e}}function Zf(t){var e=this._id;return arguments.length?this.each(Gf(e,t)):ze(this.node(),e).ease}function Jf(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;Ie(this,t).ease=n}}function Qf(t){if(typeof t!="function")throw new Error;return this.each(Jf(this._id,t))}function jf(t){typeof t!="function"&&(t=qa(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o=e[i],a=o.length,l=r[i]=[],c,s=0;s<a;++s)(c=o[s])&&t.call(c,c.__data__,s,o)&&l.push(c);return new He(r,this._parents,this._name,this._id)}function td(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,o=Math.min(r,i),a=new Array(r),l=0;l<o;++l)for(var c=e[l],s=n[l],f=c.length,u=a[l]=new Array(f),d,h=0;h<f;++h)(d=c[h]||s[h])&&(u[h]=d);for(;l<r;++l)a[l]=e[l];return new He(a,this._parents,this._name,this._id)}function ed(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function nd(t,e,n){var r,i,o=ed(e)?Ii:Ie;return function(){var a=o(this,t),l=a.on;l!==r&&(i=(r=l).copy()).on(e,n),a.on=i}}function rd(t,e){var n=this._id;return arguments.length<2?ze(this.node(),n).on.on(t):this.each(nd(n,t,e))}function id(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function od(){return this.on("end.remove",id(this._id))}function ad(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Mi(t));for(var r=this._groups,i=r.length,o=new Array(i),a=0;a<i;++a)for(var l=r[a],c=l.length,s=o[a]=new Array(c),f,u,d=0;d<c;++d)(f=l[d])&&(u=t.call(f,f.__data__,d,l))&&("__data__"in f&&(u.__data__=f.__data__),s[d]=u,Wr(s[d],e,n,d,s,ze(f,n)));return new He(o,this._parents,e,n)}function ld(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Ya(t));for(var r=this._groups,i=r.length,o=[],a=[],l=0;l<i;++l)for(var c=r[l],s=c.length,f,u=0;u<s;++u)if(f=c[u]){for(var d=t.call(f,f.__data__,u,c),h,m=ze(f,n),g=0,p=d.length;g<p;++g)(h=d[g])&&Wr(h,e,n,g,d,m);o.push(d),a.push(f)}return new He(o,a,e,n)}var sd=Ln.prototype.constructor;function cd(){return new sd(this._groups,this._parents)}function ud(t,e){var n,r,i;return function(){var o=Tn(this,t),a=(this.style.removeProperty(t),Tn(this,t));return o===a?null:o===n&&a===r?i:i=e(n=o,r=a)}}function ml(t){return function(){this.style.removeProperty(t)}}function fd(t,e,n){var r,i=n+"",o;return function(){var a=Tn(this,t);return a===i?null:a===r?o:o=e(r=a,n)}}function dd(t,e,n){var r,i,o;return function(){var a=Tn(this,t),l=n(this),c=l+"";return l==null&&(c=l=(this.style.removeProperty(t),Tn(this,t))),a===c?null:a===r&&c===i?o:(i=c,o=e(r=a,l))}}function hd(t,e){var n,r,i,o="style."+e,a="end."+o,l;return function(){var c=Ie(this,t),s=c.on,f=c.value[o]==null?l||(l=ml(e)):void 0;(s!==n||i!==f)&&(r=(n=s).copy()).on(a,i=f),c.on=r}}function md(t,e,n){var r=(t+="")=="transform"?yf:hl;return e==null?this.styleTween(t,ud(t,r)).on("end.style."+t,ml(t)):typeof e=="function"?this.styleTween(t,dd(t,r,Ei(this,"style."+t,e))).each(hd(this._id,t)):this.styleTween(t,fd(t,r,e),n).on("end.style."+t,null)}function gd(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function pd(t,e,n){var r,i;function o(){var a=e.apply(this,arguments);return a!==i&&(r=(i=a)&&gd(t,a,n)),r}return o._value=e,o}function yd(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,pd(t,e,n??""))}function vd(t){return function(){this.textContent=t}}function _d(t){return function(){var e=t(this);this.textContent=e??""}}function bd(t){return this.tween("text",typeof t=="function"?_d(Ei(this,"text",t)):vd(t==null?"":t+""))}function wd(t){return function(e){this.textContent=t.call(this,e)}}function xd(t){var e,n;function r(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&wd(i)),e}return r._value=t,r}function kd(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,xd(t))}function Td(){for(var t=this._name,e=this._id,n=pl(),r=this._groups,i=r.length,o=0;o<i;++o)for(var a=r[o],l=a.length,c,s=0;s<l;++s)if(c=a[s]){var f=ze(c,e);Wr(c,t,n,s,a,{time:f.time+f.delay+f.duration,delay:0,duration:f.duration,ease:f.ease})}return new He(r,this._parents,t,n)}function Cd(){var t,e,n=this,r=n._id,i=n.size();return new Promise(function(o,a){var l={value:a},c={value:function(){--i===0&&o()}};n.each(function(){var s=Ie(this,r),f=s.on;f!==t&&(e=(t=f).copy(),e._.cancel.push(l),e._.interrupt.push(l),e._.end.push(c)),s.on=e}),i===0&&o()})}var zd=0;function He(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function gl(t){return Ln().transition(t)}function pl(){return++zd}var Ee=Ln.prototype;He.prototype=gl.prototype={constructor:He,select:ad,selectAll:ld,selectChild:Ee.selectChild,selectChildren:Ee.selectChildren,filter:jf,merge:td,selection:cd,transition:Td,call:Ee.call,nodes:Ee.nodes,node:Ee.node,size:Ee.size,empty:Ee.empty,each:Ee.each,on:rd,attr:Rf,attrTween:Vf,style:md,styleTween:yd,text:bd,textTween:kd,remove:od,tween:Df,delay:Yf,duration:Xf,ease:Zf,easeVarying:Qf,end:Cd,[Symbol.iterator]:Ee[Symbol.iterator]};function yl(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var Md={time:null,delay:0,duration:250,ease:yl};function Ad(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function Sd(t){var e,n;t instanceof He?(e=t._id,t=t._name):(e=pl(),(n=Md).time=Li(),t=t==null?null:t+"");for(var r=this._groups,i=r.length,o=0;o<i;++o)for(var a=r[o],l=a.length,c,s=0;s<l;++s)(c=a[s])&&Wr(c,t,e,s,a,n||Ad(c,e));return new He(r,this._parents,t,e)}Ln.prototype.interrupt=Mf;Ln.prototype.transition=Sd;const _i=Math.PI,bi=2*_i,Je=1e-6,Dd=bi-Je;function vl(t){this._+=t[0];for(let e=1,n=t.length;e<n;++e)this._+=arguments[e]+t[e]}function Ld(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return vl;const n=10**e;return function(r){this._+=r[0];for(let i=1,o=r.length;i<o;++i)this._+=Math.round(arguments[i]*n)/n+r[i]}}class Id{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=e==null?vl:Ld(e)}moveTo(e,n){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,n){this._append`L${this._x1=+e},${this._y1=+n}`}quadraticCurveTo(e,n,r,i){this._append`Q${+e},${+n},${this._x1=+r},${this._y1=+i}`}bezierCurveTo(e,n,r,i,o,a){this._append`C${+e},${+n},${+r},${+i},${this._x1=+o},${this._y1=+a}`}arcTo(e,n,r,i,o){if(e=+e,n=+n,r=+r,i=+i,o=+o,o<0)throw new Error(`negative radius: ${o}`);let a=this._x1,l=this._y1,c=r-e,s=i-n,f=a-e,u=l-n,d=f*f+u*u;if(this._x1===null)this._append`M${this._x1=e},${this._y1=n}`;else if(d>Je)if(!(Math.abs(u*c-s*f)>Je)||!o)this._append`L${this._x1=e},${this._y1=n}`;else{let h=r-a,m=i-l,g=c*c+s*s,p=h*h+m*m,v=Math.sqrt(g),T=Math.sqrt(d),M=o*Math.tan((_i-Math.acos((g+d-p)/(2*v*T)))/2),x=M/T,k=M/v;Math.abs(x-1)>Je&&this._append`L${e+x*f},${n+x*u}`,this._append`A${o},${o},0,0,${+(u*h>f*m)},${this._x1=e+k*c},${this._y1=n+k*s}`}}arc(e,n,r,i,o,a){if(e=+e,n=+n,r=+r,a=!!a,r<0)throw new Error(`negative radius: ${r}`);let l=r*Math.cos(i),c=r*Math.sin(i),s=e+l,f=n+c,u=1^a,d=a?i-o:o-i;this._x1===null?this._append`M${s},${f}`:(Math.abs(this._x1-s)>Je||Math.abs(this._y1-f)>Je)&&this._append`L${s},${f}`,r&&(d<0&&(d=d%bi+bi),d>Dd?this._append`A${r},${r},0,1,${u},${e-l},${n-c}A${r},${r},0,1,${u},${this._x1=s},${this._y1=f}`:d>Je&&this._append`A${r},${r},0,${+(d>=_i)},${u},${this._x1=e+r*Math.cos(o)},${this._y1=n+r*Math.sin(o)}`)}rect(e,n,r,i){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}h${r=+r}v${+i}h${-r}Z`}toString(){return this._}}function Ed(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function Dr(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function Mn(t){return t=Dr(Math.abs(t)),t?t[1]:NaN}function Nd(t,e){return function(n,r){for(var i=n.length,o=[],a=0,l=t[0],c=0;i>0&&l>0&&(c+l+1>r&&(l=Math.max(1,r-c)),o.push(n.substring(i-=l,i+l)),!((c+=l+1)>r));)l=t[a=(a+1)%t.length];return o.reverse().join(e)}}function Fd(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var $d=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Qn(t){if(!(e=$d.exec(t)))throw new Error("invalid format: "+t);var e;return new Ni({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Qn.prototype=Ni.prototype;function Ni(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}Ni.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Rd(t){t:for(var e=t.length,n=1,r=-1,i;n<e;++n)switch(t[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+t[n])break t;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(i+1):t}var _l;function Pd(t,e){var n=Dr(t,e);if(!n)return t+"";var r=n[0],i=n[1],o=i-(_l=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+Dr(t,Math.max(0,e+o-1))[0]}function vo(t,e){var n=Dr(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const _o={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:Ed,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>vo(t*100,e),r:vo,s:Pd,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function bo(t){return t}var wo=Array.prototype.map,xo=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Hd(t){var e=t.grouping===void 0||t.thousands===void 0?bo:Nd(wo.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",i=t.decimal===void 0?".":t.decimal+"",o=t.numerals===void 0?bo:Fd(wo.call(t.numerals,String)),a=t.percent===void 0?"%":t.percent+"",l=t.minus===void 0?"−":t.minus+"",c=t.nan===void 0?"NaN":t.nan+"";function s(u){u=Qn(u);var d=u.fill,h=u.align,m=u.sign,g=u.symbol,p=u.zero,v=u.width,T=u.comma,M=u.precision,x=u.trim,k=u.type;k==="n"?(T=!0,k="g"):_o[k]||(M===void 0&&(M=12),x=!0,k="g"),(p||d==="0"&&h==="=")&&(p=!0,d="0",h="=");var w=g==="$"?n:g==="#"&&/[boxX]/.test(k)?"0"+k.toLowerCase():"",S=g==="$"?r:/[%p]/.test(k)?a:"",N=_o[k],H=/[defgprs%]/.test(k);M=M===void 0?6:/[gprs]/.test(k)?Math.max(1,Math.min(21,M)):Math.max(0,Math.min(20,M));function U(_){var X=w,A=S,C,E,z;if(k==="c")A=N(_)+A,_="";else{_=+_;var B=_<0||1/_<0;if(_=isNaN(_)?c:N(Math.abs(_),M),x&&(_=Rd(_)),B&&+_==0&&m!=="+"&&(B=!1),X=(B?m==="("?m:l:m==="-"||m==="("?"":m)+X,A=(k==="s"?xo[8+_l/3]:"")+A+(B&&m==="("?")":""),H){for(C=-1,E=_.length;++C<E;)if(z=_.charCodeAt(C),48>z||z>57){A=(z===46?i+_.slice(C+1):_.slice(C))+A,_=_.slice(0,C);break}}}T&&!p&&(_=e(_,1/0));var $=X.length+_.length+A.length,V=$<v?new Array(v-$+1).join(d):"";switch(T&&p&&(_=e(V+_,V.length?v-A.length:1/0),V=""),h){case"<":_=X+_+A+V;break;case"=":_=X+V+_+A;break;case"^":_=V.slice(0,$=V.length>>1)+X+_+A+V.slice($);break;default:_=V+X+_+A;break}return o(_)}return U.toString=function(){return u+""},U}function f(u,d){var h=s((u=Qn(u),u.type="f",u)),m=Math.max(-8,Math.min(8,Math.floor(Mn(d)/3)))*3,g=Math.pow(10,-m),p=xo[8+m/3];return function(v){return h(g*v)+p}}return{format:s,formatPrefix:f}}var lr,Fi,bl;Ud({thousands:",",grouping:[3],currency:["$",""]});function Ud(t){return lr=Hd(t),Fi=lr.format,bl=lr.formatPrefix,lr}function Bd(t){return Math.max(0,-Mn(Math.abs(t)))}function Vd(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Mn(e)/3)))*3-Mn(Math.abs(t)))}function Wd(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Mn(e)-Mn(t))+1}function Od(t){var e=0,n=t.children,r=n&&n.length;if(!r)e=1;else for(;--r>=0;)e+=n[r].value;t.value=e}function Yd(){return this.eachAfter(Od)}function qd(t,e){let n=-1;for(const r of this)t.call(e,r,++n,this);return this}function Kd(t,e){for(var n=this,r=[n],i,o,a=-1;n=r.pop();)if(t.call(e,n,++a,this),i=n.children)for(o=i.length-1;o>=0;--o)r.push(i[o]);return this}function Xd(t,e){for(var n=this,r=[n],i=[],o,a,l,c=-1;n=r.pop();)if(i.push(n),o=n.children)for(a=0,l=o.length;a<l;++a)r.push(o[a]);for(;n=i.pop();)t.call(e,n,++c,this);return this}function Gd(t,e){let n=-1;for(const r of this)if(t.call(e,r,++n,this))return r}function Zd(t){return this.eachAfter(function(e){for(var n=+t(e.data)||0,r=e.children,i=r&&r.length;--i>=0;)n+=r[i].value;e.value=n})}function Jd(t){return this.eachBefore(function(e){e.children&&e.children.sort(t)})}function Qd(t){for(var e=this,n=jd(e,t),r=[e];e!==n;)e=e.parent,r.push(e);for(var i=r.length;t!==n;)r.splice(i,0,t),t=t.parent;return r}function jd(t,e){if(t===e)return t;var n=t.ancestors(),r=e.ancestors(),i=null;for(t=n.pop(),e=r.pop();t===e;)i=t,t=n.pop(),e=r.pop();return i}function th(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e}function eh(){return Array.from(this)}function nh(){var t=[];return this.eachBefore(function(e){e.children||t.push(e)}),t}function rh(){var t=this,e=[];return t.each(function(n){n!==t&&e.push({source:n.parent,target:n})}),e}function*ih(){var t=this,e,n=[t],r,i,o;do for(e=n.reverse(),n=[];t=e.pop();)if(yield t,r=t.children)for(i=0,o=r.length;i<o;++i)n.push(r[i]);while(n.length)}function De(t,e){t instanceof Map?(t=[void 0,t],e===void 0&&(e=lh)):e===void 0&&(e=ah);for(var n=new Lr(t),r,i=[n],o,a,l,c;r=i.pop();)if((a=e(r.data))&&(c=(a=Array.from(a)).length))for(r.children=a,l=c-1;l>=0;--l)i.push(o=a[l]=new Lr(a[l])),o.parent=r,o.depth=r.depth+1;return n.eachBefore(ch)}function oh(){return De(this).eachBefore(sh)}function ah(t){return t.children}function lh(t){return Array.isArray(t)?t[1]:null}function sh(t){t.data.value!==void 0&&(t.value=t.data.value),t.data=t.data.data}function ch(t){var e=0;do t.height=e;while((t=t.parent)&&t.height<++e)}function Lr(t){this.data=t,this.depth=this.height=0,this.parent=null}Lr.prototype=De.prototype={constructor:Lr,count:Yd,each:qd,eachAfter:Xd,eachBefore:Kd,find:Gd,sum:Zd,sort:Jd,path:Qd,ancestors:th,descendants:eh,leaves:nh,links:rh,copy:oh,[Symbol.iterator]:ih};function uh(t){if(typeof t!="function")throw new Error;return t}function Pn(){return 0}function Hn(t){return function(){return t}}function fh(t){t.x0=Math.round(t.x0),t.y0=Math.round(t.y0),t.x1=Math.round(t.x1),t.y1=Math.round(t.y1)}function dh(t,e,n,r,i){for(var o=t.children,a,l=-1,c=o.length,s=t.value&&(r-e)/t.value;++l<c;)a=o[l],a.y0=n,a.y1=i,a.x0=e,a.x1=e+=a.value*s}function hh(t,e,n,r,i){for(var o=t.children,a,l=-1,c=o.length,s=t.value&&(i-n)/t.value;++l<c;)a=o[l],a.x0=e,a.x1=r,a.y0=n,a.y1=n+=a.value*s}var mh=(1+Math.sqrt(5))/2;function gh(t,e,n,r,i,o){for(var a=[],l=e.children,c,s,f=0,u=0,d=l.length,h,m,g=e.value,p,v,T,M,x,k,w;f<d;){h=i-n,m=o-r;do p=l[u++].value;while(!p&&u<d);for(v=T=p,k=Math.max(m/h,h/m)/(g*t),w=p*p*k,x=Math.max(T/w,w/v);u<d;++u){if(p+=s=l[u].value,s<v&&(v=s),s>T&&(T=s),w=p*p*k,M=Math.max(T/w,w/v),M>x){p-=s;break}x=M}a.push(c={value:p,dice:h<m,children:l.slice(f,u)}),c.dice?dh(c,n,r,i,g?r+=m*p/g:o):hh(c,n,r,g?n+=h*p/g:i,o),g-=p,f=u}return a}const ph=function t(e){function n(r,i,o,a,l){gh(e,r,i,o,a,l)}return n.ratio=function(r){return t((r=+r)>1?r:1)},n}(mh);function wl(){var t=ph,e=!1,n=1,r=1,i=[0],o=Pn,a=Pn,l=Pn,c=Pn,s=Pn;function f(d){return d.x0=d.y0=0,d.x1=n,d.y1=r,d.eachBefore(u),i=[0],e&&d.eachBefore(fh),d}function u(d){var h=i[d.depth],m=d.x0+h,g=d.y0+h,p=d.x1-h,v=d.y1-h;p<m&&(m=p=(m+p)/2),v<g&&(g=v=(g+v)/2),d.x0=m,d.y0=g,d.x1=p,d.y1=v,d.children&&(h=i[d.depth+1]=o(d)/2,m+=s(d)-h,g+=a(d)-h,p-=l(d)-h,v-=c(d)-h,p<m&&(m=p=(m+p)/2),v<g&&(g=v=(g+v)/2),t(d,m,g,p,v))}return f.round=function(d){return arguments.length?(e=!!d,f):e},f.size=function(d){return arguments.length?(n=+d[0],r=+d[1],f):[n,r]},f.tile=function(d){return arguments.length?(t=uh(d),f):t},f.padding=function(d){return arguments.length?f.paddingInner(d).paddingOuter(d):f.paddingInner()},f.paddingInner=function(d){return arguments.length?(o=typeof d=="function"?d:Hn(+d),f):o},f.paddingOuter=function(d){return arguments.length?f.paddingTop(d).paddingRight(d).paddingBottom(d).paddingLeft(d):f.paddingTop()},f.paddingTop=function(d){return arguments.length?(a=typeof d=="function"?d:Hn(+d),f):a},f.paddingRight=function(d){return arguments.length?(l=typeof d=="function"?d:Hn(+d),f):l},f.paddingBottom=function(d){return arguments.length?(c=typeof d=="function"?d:Hn(+d),f):c},f.paddingLeft=function(d){return arguments.length?(s=typeof d=="function"?d:Hn(+d),f):s},f}function nr(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function yh(t,e){switch(arguments.length){case 0:break;case 1:{typeof t=="function"?this.interpolator(t):this.range(t);break}default:{this.domain(t),typeof e=="function"?this.interpolator(e):this.range(e);break}}return this}const ko=Symbol("implicit");function se(){var t=new _n,e=[],n=[],r=ko;function i(o){let a=t.get(o);if(a===void 0){if(r!==ko)return r;t.set(o,a=e.push(o)-1)}return n[a%n.length]}return i.domain=function(o){if(!arguments.length)return e.slice();e=[],t=new _n;for(const a of o)t.has(a)||t.set(a,e.push(a)-1);return i},i.range=function(o){return arguments.length?(n=Array.from(o),i):n.slice()},i.unknown=function(o){return arguments.length?(r=o,i):r},i.copy=function(){return se(e,n).unknown(r)},nr.apply(i,arguments),i}function $i(){var t=se().unknown(void 0),e=t.domain,n=t.range,r=0,i=1,o,a,l=!1,c=0,s=0,f=.5;delete t.unknown;function u(){var d=e().length,h=i<r,m=h?i:r,g=h?r:i;o=(g-m)/Math.max(1,d-c+s*2),l&&(o=Math.floor(o)),m+=(g-m-o*(d-c))*f,a=o*(1-c),l&&(m=Math.round(m),a=Math.round(a));var p=Qs(d).map(function(v){return m+o*v});return n(h?p.reverse():p)}return t.domain=function(d){return arguments.length?(e(d),u()):e()},t.range=function(d){return arguments.length?([r,i]=d,r=+r,i=+i,u()):[r,i]},t.rangeRound=function(d){return[r,i]=d,r=+r,i=+i,l=!0,u()},t.bandwidth=function(){return a},t.step=function(){return o},t.round=function(d){return arguments.length?(l=!!d,u()):l},t.padding=function(d){return arguments.length?(c=Math.min(1,s=+d),u()):c},t.paddingInner=function(d){return arguments.length?(c=Math.min(1,d),u()):c},t.paddingOuter=function(d){return arguments.length?(s=+d,u()):s},t.align=function(d){return arguments.length?(f=Math.max(0,Math.min(1,d)),u()):f},t.copy=function(){return $i(e(),[r,i]).round(l).paddingInner(c).paddingOuter(s).align(f)},nr.apply(u(),arguments)}function vh(t){return function(){return t}}function _h(t){return+t}var To=[0,1];function Ke(t){return t}function wi(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:vh(isNaN(e)?NaN:.5)}function bh(t,e){var n;return t>e&&(n=t,t=e,e=n),function(r){return Math.max(t,Math.min(e,r))}}function wh(t,e,n){var r=t[0],i=t[1],o=e[0],a=e[1];return i<r?(r=wi(i,r),o=n(a,o)):(r=wi(r,i),o=n(o,a)),function(l){return o(r(l))}}function xh(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),o=new Array(r),a=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++a<r;)i[a]=wi(t[a],t[a+1]),o[a]=n(e[a],e[a+1]);return function(l){var c=Os(t,l,1,r)-1;return o[c](i[c](l))}}function Ri(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function xl(){var t=To,e=To,n=Cn,r,i,o,a=Ke,l,c,s;function f(){var d=Math.min(t.length,e.length);return a!==Ke&&(a=bh(t[0],t[d-1])),l=d>2?xh:wh,c=s=null,u}function u(d){return d==null||isNaN(d=+d)?o:(c||(c=l(t.map(r),e,n)))(r(a(d)))}return u.invert=function(d){return a(i((s||(s=l(e,t.map(r),ke)))(d)))},u.domain=function(d){return arguments.length?(t=Array.from(d,_h),f()):t.slice()},u.range=function(d){return arguments.length?(e=Array.from(d),f()):e.slice()},u.rangeRound=function(d){return e=Array.from(d),n=al,f()},u.clamp=function(d){return arguments.length?(a=d?!0:Ke,f()):a!==Ke},u.interpolate=function(d){return arguments.length?(n=d,f()):n},u.unknown=function(d){return arguments.length?(o=d,u):o},function(d,h){return r=d,i=h,f()}}function kl(){return xl()(Ke,Ke)}function kh(t,e,n,r){var i=fi(t,e,n),o;switch(r=Qn(r??",f"),r.type){case"s":{var a=Math.max(Math.abs(t),Math.abs(e));return r.precision==null&&!isNaN(o=Vd(i,a))&&(r.precision=o),bl(r,a)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(o=Wd(i,Math.max(Math.abs(t),Math.abs(e))))&&(r.precision=o-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(o=Bd(i))&&(r.precision=o-(r.type==="%")*2);break}}return Fi(r)}function Tl(t){var e=t.domain;return t.ticks=function(n){var r=e();return ci(r[0],r[r.length-1],n??10)},t.tickFormat=function(n,r){var i=e();return kh(i[0],i[i.length-1],n??10,r)},t.nice=function(n){n==null&&(n=10);var r=e(),i=0,o=r.length-1,a=r[i],l=r[o],c,s,f=10;for(l<a&&(s=a,a=l,l=s,s=i,i=o,o=s);f-- >0;){if(s=ui(a,l,n),s===c)return r[i]=a,r[o]=l,e(r);if(s>0)a=Math.floor(a/s)*s,l=Math.ceil(l/s)*s;else if(s<0)a=Math.ceil(a*s)/s,l=Math.floor(l*s)/s;else break;c=s}return t},t}function jn(){var t=kl();return t.copy=function(){return Ri(t,jn())},nr.apply(t,arguments),Tl(t)}function Cl(t,e){t=t.slice();var n=0,r=t.length-1,i=t[n],o=t[r],a;return o<i&&(a=n,n=r,r=a,a=i,i=o,o=a),t[n]=e.floor(i),t[r]=e.ceil(o),t}function Co(t){return Math.log(t)}function zo(t){return Math.exp(t)}function Th(t){return-Math.log(-t)}function Ch(t){return-Math.exp(-t)}function zh(t){return isFinite(t)?+("1e"+t):t<0?0:t}function Mh(t){return t===10?zh:t===Math.E?Math.exp:e=>Math.pow(t,e)}function Ah(t){return t===Math.E?Math.log:t===10&&Math.log10||t===2&&Math.log2||(t=Math.log(t),e=>Math.log(e)/t)}function Mo(t){return(e,n)=>-t(-e,n)}function Sh(t){const e=t(Co,zo),n=e.domain;let r=10,i,o;function a(){return i=Ah(r),o=Mh(r),n()[0]<0?(i=Mo(i),o=Mo(o),t(Th,Ch)):t(Co,zo),e}return e.base=function(l){return arguments.length?(r=+l,a()):r},e.domain=function(l){return arguments.length?(n(l),a()):n()},e.ticks=l=>{const c=n();let s=c[0],f=c[c.length-1];const u=f<s;u&&([s,f]=[f,s]);let d=i(s),h=i(f),m,g;const p=l==null?10:+l;let v=[];if(!(r%1)&&h-d<p){if(d=Math.floor(d),h=Math.ceil(h),s>0){for(;d<=h;++d)for(m=1;m<r;++m)if(g=d<0?m/o(-d):m*o(d),!(g<s)){if(g>f)break;v.push(g)}}else for(;d<=h;++d)for(m=r-1;m>=1;--m)if(g=d>0?m/o(-d):m*o(d),!(g<s)){if(g>f)break;v.push(g)}v.length*2<p&&(v=ci(s,f,p))}else v=ci(d,h,Math.min(h-d,p)).map(o);return u?v.reverse():v},e.tickFormat=(l,c)=>{if(l==null&&(l=10),c==null&&(c=r===10?"s":","),typeof c!="function"&&(!(r%1)&&(c=Qn(c)).precision==null&&(c.trim=!0),c=Fi(c)),l===1/0)return c;const s=Math.max(1,r*l/e.ticks().length);return f=>{let u=f/o(Math.round(i(f)));return u*r<r-.5&&(u*=r),u<=s?c(f):""}},e.nice=()=>n(Cl(n(),{floor:l=>o(Math.floor(i(l))),ceil:l=>o(Math.ceil(i(l)))})),e}function zl(){const t=Sh(xl()).domain([1,10]);return t.copy=()=>Ri(t,zl()).base(t.base()),nr.apply(t,arguments),t}const Qr=new Date,jr=new Date;function jt(t,e,n,r){function i(o){return t(o=arguments.length===0?new Date:new Date(+o)),o}return i.floor=o=>(t(o=new Date(+o)),o),i.ceil=o=>(t(o=new Date(o-1)),e(o,1),t(o),o),i.round=o=>{const a=i(o),l=i.ceil(o);return o-a<l-o?a:l},i.offset=(o,a)=>(e(o=new Date(+o),a==null?1:Math.floor(a)),o),i.range=(o,a,l)=>{const c=[];if(o=i.ceil(o),l=l==null?1:Math.floor(l),!(o<a)||!(l>0))return c;let s;do c.push(s=new Date(+o)),e(o,l),t(o);while(s<o&&o<a);return c},i.filter=o=>jt(a=>{if(a>=a)for(;t(a),!o(a);)a.setTime(a-1)},(a,l)=>{if(a>=a)if(l<0)for(;++l<=0;)for(;e(a,-1),!o(a););else for(;--l>=0;)for(;e(a,1),!o(a););}),n&&(i.count=(o,a)=>(Qr.setTime(+o),jr.setTime(+a),t(Qr),t(jr),Math.floor(n(Qr,jr))),i.every=o=>(o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?i.filter(r?a=>r(a)%o===0:a=>i.count(0,a)%o===0):i)),i}const Ir=jt(()=>{},(t,e)=>{t.setTime(+t+e)},(t,e)=>e-t);Ir.every=t=>(t=Math.floor(t),!isFinite(t)||!(t>0)?null:t>1?jt(e=>{e.setTime(Math.floor(e/t)*t)},(e,n)=>{e.setTime(+e+n*t)},(e,n)=>(n-e)/t):Ir);Ir.range;const Fe=1e3,we=Fe*60,$e=we*60,Ue=$e*24,Pi=Ue*7,Ao=Ue*30,ti=Ue*365,mn=jt(t=>{t.setTime(t-t.getMilliseconds())},(t,e)=>{t.setTime(+t+e*Fe)},(t,e)=>(e-t)/Fe,t=>t.getUTCSeconds());mn.range;const Hi=jt(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*Fe)},(t,e)=>{t.setTime(+t+e*we)},(t,e)=>(e-t)/we,t=>t.getMinutes());Hi.range;const Dh=jt(t=>{t.setUTCSeconds(0,0)},(t,e)=>{t.setTime(+t+e*we)},(t,e)=>(e-t)/we,t=>t.getUTCMinutes());Dh.range;const Ui=jt(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*Fe-t.getMinutes()*we)},(t,e)=>{t.setTime(+t+e*$e)},(t,e)=>(e-t)/$e,t=>t.getHours());Ui.range;const Lh=jt(t=>{t.setUTCMinutes(0,0,0)},(t,e)=>{t.setTime(+t+e*$e)},(t,e)=>(e-t)/$e,t=>t.getUTCHours());Lh.range;const rr=jt(t=>t.setHours(0,0,0,0),(t,e)=>t.setDate(t.getDate()+e),(t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*we)/Ue,t=>t.getDate()-1);rr.range;const Bi=jt(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/Ue,t=>t.getUTCDate()-1);Bi.range;const Ih=jt(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/Ue,t=>Math.floor(t/Ue));Ih.range;function an(t){return jt(e=>{e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)},(e,n)=>{e.setDate(e.getDate()+n*7)},(e,n)=>(n-e-(n.getTimezoneOffset()-e.getTimezoneOffset())*we)/Pi)}const Or=an(0),Er=an(1),Eh=an(2),Nh=an(3),An=an(4),Fh=an(5),$h=an(6);Or.range;Er.range;Eh.range;Nh.range;An.range;Fh.range;$h.range;function ln(t){return jt(e=>{e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCDate(e.getUTCDate()+n*7)},(e,n)=>(n-e)/Pi)}const Ml=ln(0),Nr=ln(1),Rh=ln(2),Ph=ln(3),Sn=ln(4),Hh=ln(5),Uh=ln(6);Ml.range;Nr.range;Rh.range;Ph.range;Sn.range;Hh.range;Uh.range;const Vi=jt(t=>{t.setDate(1),t.setHours(0,0,0,0)},(t,e)=>{t.setMonth(t.getMonth()+e)},(t,e)=>e.getMonth()-t.getMonth()+(e.getFullYear()-t.getFullYear())*12,t=>t.getMonth());Vi.range;const Bh=jt(t=>{t.setUTCDate(1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCMonth(t.getUTCMonth()+e)},(t,e)=>e.getUTCMonth()-t.getUTCMonth()+(e.getUTCFullYear()-t.getUTCFullYear())*12,t=>t.getUTCMonth());Bh.range;const Be=jt(t=>{t.setMonth(0,1),t.setHours(0,0,0,0)},(t,e)=>{t.setFullYear(t.getFullYear()+e)},(t,e)=>e.getFullYear()-t.getFullYear(),t=>t.getFullYear());Be.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:jt(e=>{e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)},(e,n)=>{e.setFullYear(e.getFullYear()+n*t)});Be.range;const on=jt(t=>{t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCFullYear(t.getUTCFullYear()+e)},(t,e)=>e.getUTCFullYear()-t.getUTCFullYear(),t=>t.getUTCFullYear());on.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:jt(e=>{e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCFullYear(e.getUTCFullYear()+n*t)});on.range;function Vh(t,e,n,r,i,o){const a=[[mn,1,Fe],[mn,5,5*Fe],[mn,15,15*Fe],[mn,30,30*Fe],[o,1,we],[o,5,5*we],[o,15,15*we],[o,30,30*we],[i,1,$e],[i,3,3*$e],[i,6,6*$e],[i,12,12*$e],[r,1,Ue],[r,2,2*Ue],[n,1,Pi],[e,1,Ao],[e,3,3*Ao],[t,1,ti]];function l(s,f,u){const d=f<s;d&&([s,f]=[f,s]);const h=u&&typeof u.range=="function"?u:c(s,f,u),m=h?h.range(s,+f+1):[];return d?m.reverse():m}function c(s,f,u){const d=Math.abs(f-s)/u,h=Ci(([,,p])=>p).right(a,d);if(h===a.length)return t.every(fi(s/ti,f/ti,u));if(h===0)return Ir.every(Math.max(fi(s,f,u),1));const[m,g]=a[d/a[h-1][2]<a[h][2]/d?h-1:h];return m.every(g)}return[l,c]}const[Wh,Oh]=Vh(Be,Vi,Or,rr,Ui,Hi);function ei(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function ni(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function Un(t,e,n){return{y:t,m:e,d:n,H:0,M:0,S:0,L:0}}function Yh(t){var e=t.dateTime,n=t.date,r=t.time,i=t.periods,o=t.days,a=t.shortDays,l=t.months,c=t.shortMonths,s=Bn(i),f=Vn(i),u=Bn(o),d=Vn(o),h=Bn(a),m=Vn(a),g=Bn(l),p=Vn(l),v=Bn(c),T=Vn(c),M={a:B,A:$,b:V,B:D,c:null,d:No,e:No,f:mm,g:Tm,G:zm,H:fm,I:dm,j:hm,L:Al,m:gm,M:pm,p:G,q:L,Q:Ro,s:Po,S:ym,u:vm,U:_m,V:bm,w:wm,W:xm,x:null,X:null,y:km,Y:Cm,Z:Mm,"%":$o},x={a:O,A:I,b:P,B:Y,c:null,d:Fo,e:Fo,f:Lm,g:Bm,G:Wm,H:Am,I:Sm,j:Dm,L:Dl,m:Im,M:Em,p:K,q:J,Q:Ro,s:Po,S:Nm,u:Fm,U:$m,V:Rm,w:Pm,W:Hm,x:null,X:null,y:Um,Y:Vm,Z:Om,"%":$o},k={a:U,A:_,b:X,B:A,c:C,d:Io,e:Io,f:lm,g:Lo,G:Do,H:Eo,I:Eo,j:rm,L:am,m:nm,M:im,p:H,q:em,Q:cm,s:um,S:om,u:Zh,U:Jh,V:Qh,w:Gh,W:jh,x:E,X:z,y:Lo,Y:Do,Z:tm,"%":sm};M.x=w(n,M),M.X=w(r,M),M.c=w(e,M),x.x=w(n,x),x.X=w(r,x),x.c=w(e,x);function w(W,it){return function(lt){var F=[],q=-1,tt=0,Z=W.length,dt,pt,Et;for(lt instanceof Date||(lt=new Date(+lt));++q<Z;)W.charCodeAt(q)===37&&(F.push(W.slice(tt,q)),(pt=So[dt=W.charAt(++q)])!=null?dt=W.charAt(++q):pt=dt==="e"?" ":"0",(Et=it[dt])&&(dt=Et(lt,pt)),F.push(dt),tt=q+1);return F.push(W.slice(tt,q)),F.join("")}}function S(W,it){return function(lt){var F=Un(1900,void 0,1),q=N(F,W,lt+="",0),tt,Z;if(q!=lt.length)return null;if("Q"in F)return new Date(F.Q);if("s"in F)return new Date(F.s*1e3+("L"in F?F.L:0));if(it&&!("Z"in F)&&(F.Z=0),"p"in F&&(F.H=F.H%12+F.p*12),F.m===void 0&&(F.m="q"in F?F.q:0),"V"in F){if(F.V<1||F.V>53)return null;"w"in F||(F.w=1),"Z"in F?(tt=ni(Un(F.y,0,1)),Z=tt.getUTCDay(),tt=Z>4||Z===0?Nr.ceil(tt):Nr(tt),tt=Bi.offset(tt,(F.V-1)*7),F.y=tt.getUTCFullYear(),F.m=tt.getUTCMonth(),F.d=tt.getUTCDate()+(F.w+6)%7):(tt=ei(Un(F.y,0,1)),Z=tt.getDay(),tt=Z>4||Z===0?Er.ceil(tt):Er(tt),tt=rr.offset(tt,(F.V-1)*7),F.y=tt.getFullYear(),F.m=tt.getMonth(),F.d=tt.getDate()+(F.w+6)%7)}else("W"in F||"U"in F)&&("w"in F||(F.w="u"in F?F.u%7:"W"in F?1:0),Z="Z"in F?ni(Un(F.y,0,1)).getUTCDay():ei(Un(F.y,0,1)).getDay(),F.m=0,F.d="W"in F?(F.w+6)%7+F.W*7-(Z+5)%7:F.w+F.U*7-(Z+6)%7);return"Z"in F?(F.H+=F.Z/100|0,F.M+=F.Z%100,ni(F)):ei(F)}}function N(W,it,lt,F){for(var q=0,tt=it.length,Z=lt.length,dt,pt;q<tt;){if(F>=Z)return-1;if(dt=it.charCodeAt(q++),dt===37){if(dt=it.charAt(q++),pt=k[dt in So?it.charAt(q++):dt],!pt||(F=pt(W,lt,F))<0)return-1}else if(dt!=lt.charCodeAt(F++))return-1}return F}function H(W,it,lt){var F=s.exec(it.slice(lt));return F?(W.p=f.get(F[0].toLowerCase()),lt+F[0].length):-1}function U(W,it,lt){var F=h.exec(it.slice(lt));return F?(W.w=m.get(F[0].toLowerCase()),lt+F[0].length):-1}function _(W,it,lt){var F=u.exec(it.slice(lt));return F?(W.w=d.get(F[0].toLowerCase()),lt+F[0].length):-1}function X(W,it,lt){var F=v.exec(it.slice(lt));return F?(W.m=T.get(F[0].toLowerCase()),lt+F[0].length):-1}function A(W,it,lt){var F=g.exec(it.slice(lt));return F?(W.m=p.get(F[0].toLowerCase()),lt+F[0].length):-1}function C(W,it,lt){return N(W,e,it,lt)}function E(W,it,lt){return N(W,n,it,lt)}function z(W,it,lt){return N(W,r,it,lt)}function B(W){return a[W.getDay()]}function $(W){return o[W.getDay()]}function V(W){return c[W.getMonth()]}function D(W){return l[W.getMonth()]}function G(W){return i[+(W.getHours()>=12)]}function L(W){return 1+~~(W.getMonth()/3)}function O(W){return a[W.getUTCDay()]}function I(W){return o[W.getUTCDay()]}function P(W){return c[W.getUTCMonth()]}function Y(W){return l[W.getUTCMonth()]}function K(W){return i[+(W.getUTCHours()>=12)]}function J(W){return 1+~~(W.getUTCMonth()/3)}return{format:function(W){var it=w(W+="",M);return it.toString=function(){return W},it},parse:function(W){var it=S(W+="",!1);return it.toString=function(){return W},it},utcFormat:function(W){var it=w(W+="",x);return it.toString=function(){return W},it},utcParse:function(W){var it=S(W+="",!0);return it.toString=function(){return W},it}}}var So={"-":"",_:" ",0:"0"},ne=/^\s*\d+/,qh=/^%/,Kh=/[\\^$*+?|[\]().{}]/g;function Rt(t,e,n){var r=t<0?"-":"",i=(r?-t:t)+"",o=i.length;return r+(o<n?new Array(n-o+1).join(e)+i:i)}function Xh(t){return t.replace(Kh,"\\$&")}function Bn(t){return new RegExp("^(?:"+t.map(Xh).join("|")+")","i")}function Vn(t){return new Map(t.map((e,n)=>[e.toLowerCase(),n]))}function Gh(t,e,n){var r=ne.exec(e.slice(n,n+1));return r?(t.w=+r[0],n+r[0].length):-1}function Zh(t,e,n){var r=ne.exec(e.slice(n,n+1));return r?(t.u=+r[0],n+r[0].length):-1}function Jh(t,e,n){var r=ne.exec(e.slice(n,n+2));return r?(t.U=+r[0],n+r[0].length):-1}function Qh(t,e,n){var r=ne.exec(e.slice(n,n+2));return r?(t.V=+r[0],n+r[0].length):-1}function jh(t,e,n){var r=ne.exec(e.slice(n,n+2));return r?(t.W=+r[0],n+r[0].length):-1}function Do(t,e,n){var r=ne.exec(e.slice(n,n+4));return r?(t.y=+r[0],n+r[0].length):-1}function Lo(t,e,n){var r=ne.exec(e.slice(n,n+2));return r?(t.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function tm(t,e,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(n,n+6));return r?(t.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function em(t,e,n){var r=ne.exec(e.slice(n,n+1));return r?(t.q=r[0]*3-3,n+r[0].length):-1}function nm(t,e,n){var r=ne.exec(e.slice(n,n+2));return r?(t.m=r[0]-1,n+r[0].length):-1}function Io(t,e,n){var r=ne.exec(e.slice(n,n+2));return r?(t.d=+r[0],n+r[0].length):-1}function rm(t,e,n){var r=ne.exec(e.slice(n,n+3));return r?(t.m=0,t.d=+r[0],n+r[0].length):-1}function Eo(t,e,n){var r=ne.exec(e.slice(n,n+2));return r?(t.H=+r[0],n+r[0].length):-1}function im(t,e,n){var r=ne.exec(e.slice(n,n+2));return r?(t.M=+r[0],n+r[0].length):-1}function om(t,e,n){var r=ne.exec(e.slice(n,n+2));return r?(t.S=+r[0],n+r[0].length):-1}function am(t,e,n){var r=ne.exec(e.slice(n,n+3));return r?(t.L=+r[0],n+r[0].length):-1}function lm(t,e,n){var r=ne.exec(e.slice(n,n+6));return r?(t.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function sm(t,e,n){var r=qh.exec(e.slice(n,n+1));return r?n+r[0].length:-1}function cm(t,e,n){var r=ne.exec(e.slice(n));return r?(t.Q=+r[0],n+r[0].length):-1}function um(t,e,n){var r=ne.exec(e.slice(n));return r?(t.s=+r[0],n+r[0].length):-1}function No(t,e){return Rt(t.getDate(),e,2)}function fm(t,e){return Rt(t.getHours(),e,2)}function dm(t,e){return Rt(t.getHours()%12||12,e,2)}function hm(t,e){return Rt(1+rr.count(Be(t),t),e,3)}function Al(t,e){return Rt(t.getMilliseconds(),e,3)}function mm(t,e){return Al(t,e)+"000"}function gm(t,e){return Rt(t.getMonth()+1,e,2)}function pm(t,e){return Rt(t.getMinutes(),e,2)}function ym(t,e){return Rt(t.getSeconds(),e,2)}function vm(t){var e=t.getDay();return e===0?7:e}function _m(t,e){return Rt(Or.count(Be(t)-1,t),e,2)}function Sl(t){var e=t.getDay();return e>=4||e===0?An(t):An.ceil(t)}function bm(t,e){return t=Sl(t),Rt(An.count(Be(t),t)+(Be(t).getDay()===4),e,2)}function wm(t){return t.getDay()}function xm(t,e){return Rt(Er.count(Be(t)-1,t),e,2)}function km(t,e){return Rt(t.getFullYear()%100,e,2)}function Tm(t,e){return t=Sl(t),Rt(t.getFullYear()%100,e,2)}function Cm(t,e){return Rt(t.getFullYear()%1e4,e,4)}function zm(t,e){var n=t.getDay();return t=n>=4||n===0?An(t):An.ceil(t),Rt(t.getFullYear()%1e4,e,4)}function Mm(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+Rt(e/60|0,"0",2)+Rt(e%60,"0",2)}function Fo(t,e){return Rt(t.getUTCDate(),e,2)}function Am(t,e){return Rt(t.getUTCHours(),e,2)}function Sm(t,e){return Rt(t.getUTCHours()%12||12,e,2)}function Dm(t,e){return Rt(1+Bi.count(on(t),t),e,3)}function Dl(t,e){return Rt(t.getUTCMilliseconds(),e,3)}function Lm(t,e){return Dl(t,e)+"000"}function Im(t,e){return Rt(t.getUTCMonth()+1,e,2)}function Em(t,e){return Rt(t.getUTCMinutes(),e,2)}function Nm(t,e){return Rt(t.getUTCSeconds(),e,2)}function Fm(t){var e=t.getUTCDay();return e===0?7:e}function $m(t,e){return Rt(Ml.count(on(t)-1,t),e,2)}function Ll(t){var e=t.getUTCDay();return e>=4||e===0?Sn(t):Sn.ceil(t)}function Rm(t,e){return t=Ll(t),Rt(Sn.count(on(t),t)+(on(t).getUTCDay()===4),e,2)}function Pm(t){return t.getUTCDay()}function Hm(t,e){return Rt(Nr.count(on(t)-1,t),e,2)}function Um(t,e){return Rt(t.getUTCFullYear()%100,e,2)}function Bm(t,e){return t=Ll(t),Rt(t.getUTCFullYear()%100,e,2)}function Vm(t,e){return Rt(t.getUTCFullYear()%1e4,e,4)}function Wm(t,e){var n=t.getUTCDay();return t=n>=4||n===0?Sn(t):Sn.ceil(t),Rt(t.getUTCFullYear()%1e4,e,4)}function Om(){return"+0000"}function $o(){return"%"}function Ro(t){return+t}function Po(t){return Math.floor(+t/1e3)}var fn,Xe;Ym({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Ym(t){return fn=Yh(t),Xe=fn.format,fn.parse,fn.utcFormat,fn.utcParse,fn}function qm(t){return new Date(t)}function Km(t){return t instanceof Date?+t:+new Date(+t)}function Il(t,e,n,r,i,o,a,l,c,s){var f=kl(),u=f.invert,d=f.domain,h=s(".%L"),m=s(":%S"),g=s("%I:%M"),p=s("%I %p"),v=s("%a %d"),T=s("%b %d"),M=s("%B"),x=s("%Y");function k(w){return(c(w)<w?h:l(w)<w?m:a(w)<w?g:o(w)<w?p:r(w)<w?i(w)<w?v:T:n(w)<w?M:x)(w)}return f.invert=function(w){return new Date(u(w))},f.domain=function(w){return arguments.length?d(Array.from(w,Km)):d().map(qm)},f.ticks=function(w){var S=d();return t(S[0],S[S.length-1],w??10)},f.tickFormat=function(w,S){return S==null?k:s(S)},f.nice=function(w){var S=d();return(!w||typeof w.range!="function")&&(w=e(S[0],S[S.length-1],w??10)),w?d(Cl(S,w)):f},f.copy=function(){return Ri(f,Il(t,e,n,r,i,o,a,l,c,s))},f}function El(){return nr.apply(Il(Wh,Oh,Be,Vi,Or,rr,Ui,Hi,mn,Xe).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function Xm(){var t=0,e=1,n,r,i,o,a=Ke,l=!1,c;function s(u){return u==null||isNaN(u=+u)?c:a(i===0?.5:(u=(o(u)-n)*i,l?Math.max(0,Math.min(1,u)):u))}s.domain=function(u){return arguments.length?([t,e]=u,n=o(t=+t),r=o(e=+e),i=n===r?0:1/(r-n),s):[t,e]},s.clamp=function(u){return arguments.length?(l=!!u,s):l},s.interpolator=function(u){return arguments.length?(a=u,s):a};function f(u){return function(d){var h,m;return arguments.length?([h,m]=d,a=u(h,m),s):[a(0),a(1)]}}return s.range=f(Cn),s.rangeRound=f(al),s.unknown=function(u){return arguments.length?(c=u,s):c},function(u){return o=u,n=u(t),r=u(e),i=n===r?0:1/(r-n),s}}function Gm(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function xi(){var t=Tl(Xm()(Ke));return t.copy=function(){return Gm(t,xi())},yh.apply(t,arguments)}function Yr(t){for(var e=t.length/6|0,n=new Array(e),r=0;r<e;)n[r]="#"+t.slice(r*6,++r*6);return n}const Ce=Yr("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),Zm=Yr("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"),Nl=t=>lf(t[t.length-1]);var Jm=new Array(3).concat("ef8a62f7f7f767a9cf","ca0020f4a58292c5de0571b0","ca0020f4a582f7f7f792c5de0571b0","b2182bef8a62fddbc7d1e5f067a9cf2166ac","b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac","b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac","b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac","67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061","67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061").map(Yr);const Qm=Nl(Jm);var jm=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(Yr);const tg=Nl(jm);function Wt(t){return function(){return t}}const Ho=Math.abs,oe=Math.atan2,Ze=Math.cos,eg=Math.max,ri=Math.min,Se=Math.sin,gn=Math.sqrt,fe=1e-12,tr=Math.PI,Fr=tr/2,yr=2*tr;function ng(t){return t>1?0:t<-1?tr:Math.acos(t)}function Uo(t){return t>=1?Fr:t<=-1?-Fr:Math.asin(t)}function Fl(t){let e=3;return t.digits=function(n){if(!arguments.length)return e;if(n==null)e=null;else{const r=Math.floor(n);if(!(r>=0))throw new RangeError(`invalid digits: ${n}`);e=r}return t},()=>new Id(e)}function rg(t){return t.innerRadius}function ig(t){return t.outerRadius}function og(t){return t.startAngle}function ag(t){return t.endAngle}function lg(t){return t&&t.padAngle}function sg(t,e,n,r,i,o,a,l){var c=n-t,s=r-e,f=a-i,u=l-o,d=u*c-f*s;if(!(d*d<fe))return d=(f*(e-o)-u*(t-i))/d,[t+d*c,e+d*s]}function sr(t,e,n,r,i,o,a){var l=t-n,c=e-r,s=(a?o:-o)/gn(l*l+c*c),f=s*c,u=-s*l,d=t+f,h=e+u,m=n+f,g=r+u,p=(d+m)/2,v=(h+g)/2,T=m-d,M=g-h,x=T*T+M*M,k=i-o,w=d*g-m*h,S=(M<0?-1:1)*gn(eg(0,k*k*x-w*w)),N=(w*M-T*S)/x,H=(-w*T-M*S)/x,U=(w*M+T*S)/x,_=(-w*T+M*S)/x,X=N-p,A=H-v,C=U-p,E=_-v;return X*X+A*A>C*C+E*E&&(N=U,H=_),{cx:N,cy:H,x01:-f,y01:-u,x11:N*(i/k-1),y11:H*(i/k-1)}}function ii(){var t=rg,e=ig,n=Wt(0),r=null,i=og,o=ag,a=lg,l=null,c=Fl(s);function s(){var f,u,d=+t.apply(this,arguments),h=+e.apply(this,arguments),m=i.apply(this,arguments)-Fr,g=o.apply(this,arguments)-Fr,p=Ho(g-m),v=g>m;if(l||(l=f=c()),h<d&&(u=h,h=d,d=u),!(h>fe))l.moveTo(0,0);else if(p>yr-fe)l.moveTo(h*Ze(m),h*Se(m)),l.arc(0,0,h,m,g,!v),d>fe&&(l.moveTo(d*Ze(g),d*Se(g)),l.arc(0,0,d,g,m,v));else{var T=m,M=g,x=m,k=g,w=p,S=p,N=a.apply(this,arguments)/2,H=N>fe&&(r?+r.apply(this,arguments):gn(d*d+h*h)),U=ri(Ho(h-d)/2,+n.apply(this,arguments)),_=U,X=U,A,C;if(H>fe){var E=Uo(H/d*Se(N)),z=Uo(H/h*Se(N));(w-=E*2)>fe?(E*=v?1:-1,x+=E,k-=E):(w=0,x=k=(m+g)/2),(S-=z*2)>fe?(z*=v?1:-1,T+=z,M-=z):(S=0,T=M=(m+g)/2)}var B=h*Ze(T),$=h*Se(T),V=d*Ze(k),D=d*Se(k);if(U>fe){var G=h*Ze(M),L=h*Se(M),O=d*Ze(x),I=d*Se(x),P;if(p<tr)if(P=sg(B,$,O,I,G,L,V,D)){var Y=B-P[0],K=$-P[1],J=G-P[0],W=L-P[1],it=1/Se(ng((Y*J+K*W)/(gn(Y*Y+K*K)*gn(J*J+W*W)))/2),lt=gn(P[0]*P[0]+P[1]*P[1]);_=ri(U,(d-lt)/(it-1)),X=ri(U,(h-lt)/(it+1))}else _=X=0}S>fe?X>fe?(A=sr(O,I,B,$,h,X,v),C=sr(G,L,V,D,h,X,v),l.moveTo(A.cx+A.x01,A.cy+A.y01),X<U?l.arc(A.cx,A.cy,X,oe(A.y01,A.x01),oe(C.y01,C.x01),!v):(l.arc(A.cx,A.cy,X,oe(A.y01,A.x01),oe(A.y11,A.x11),!v),l.arc(0,0,h,oe(A.cy+A.y11,A.cx+A.x11),oe(C.cy+C.y11,C.cx+C.x11),!v),l.arc(C.cx,C.cy,X,oe(C.y11,C.x11),oe(C.y01,C.x01),!v))):(l.moveTo(B,$),l.arc(0,0,h,T,M,!v)):l.moveTo(B,$),!(d>fe)||!(w>fe)?l.lineTo(V,D):_>fe?(A=sr(V,D,G,L,d,-_,v),C=sr(B,$,O,I,d,-_,v),l.lineTo(A.cx+A.x01,A.cy+A.y01),_<U?l.arc(A.cx,A.cy,_,oe(A.y01,A.x01),oe(C.y01,C.x01),!v):(l.arc(A.cx,A.cy,_,oe(A.y01,A.x01),oe(A.y11,A.x11),!v),l.arc(0,0,d,oe(A.cy+A.y11,A.cx+A.x11),oe(C.cy+C.y11,C.cx+C.x11),v),l.arc(C.cx,C.cy,_,oe(C.y11,C.x11),oe(C.y01,C.x01),!v))):l.arc(0,0,d,k,x,v)}if(l.closePath(),f)return l=null,f+""||null}return s.centroid=function(){var f=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2,u=(+i.apply(this,arguments)+ +o.apply(this,arguments))/2-tr/2;return[Ze(u)*f,Se(u)*f]},s.innerRadius=function(f){return arguments.length?(t=typeof f=="function"?f:Wt(+f),s):t},s.outerRadius=function(f){return arguments.length?(e=typeof f=="function"?f:Wt(+f),s):e},s.cornerRadius=function(f){return arguments.length?(n=typeof f=="function"?f:Wt(+f),s):n},s.padRadius=function(f){return arguments.length?(r=f==null?null:typeof f=="function"?f:Wt(+f),s):r},s.startAngle=function(f){return arguments.length?(i=typeof f=="function"?f:Wt(+f),s):i},s.endAngle=function(f){return arguments.length?(o=typeof f=="function"?f:Wt(+f),s):o},s.padAngle=function(f){return arguments.length?(a=typeof f=="function"?f:Wt(+f),s):a},s.context=function(f){return arguments.length?(l=f??null,s):l},s}function Wi(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function $l(t){this._context=t}$l.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e);break}}};function cg(t){return new $l(t)}function ug(t){return t[0]}function fg(t){return t[1]}function Bo(t,e){var n=Wt(!0),r=null,i=cg,o=null,a=Fl(l);t=typeof t=="function"?t:t===void 0?ug:Wt(t),e=typeof e=="function"?e:e===void 0?fg:Wt(e);function l(c){var s,f=(c=Wi(c)).length,u,d=!1,h;for(r==null&&(o=i(h=a())),s=0;s<=f;++s)!(s<f&&n(u=c[s],s,c))===d&&((d=!d)?o.lineStart():o.lineEnd()),d&&o.point(+t(u,s,c),+e(u,s,c));if(h)return o=null,h+""||null}return l.x=function(c){return arguments.length?(t=typeof c=="function"?c:Wt(+c),l):t},l.y=function(c){return arguments.length?(e=typeof c=="function"?c:Wt(+c),l):e},l.defined=function(c){return arguments.length?(n=typeof c=="function"?c:Wt(!!c),l):n},l.curve=function(c){return arguments.length?(i=c,r!=null&&(o=i(r)),l):i},l.context=function(c){return arguments.length?(c==null?r=o=null:o=i(r=c),l):r},l}function dg(t,e){return e<t?-1:e>t?1:e>=t?0:NaN}function hg(t){return t}function mg(){var t=hg,e=dg,n=null,r=Wt(0),i=Wt(yr),o=Wt(0);function a(l){var c,s=(l=Wi(l)).length,f,u,d=0,h=new Array(s),m=new Array(s),g=+r.apply(this,arguments),p=Math.min(yr,Math.max(-yr,i.apply(this,arguments)-g)),v,T=Math.min(Math.abs(p)/s,o.apply(this,arguments)),M=T*(p<0?-1:1),x;for(c=0;c<s;++c)(x=m[h[c]=c]=+t(l[c],c,l))>0&&(d+=x);for(e!=null?h.sort(function(k,w){return e(m[k],m[w])}):n!=null&&h.sort(function(k,w){return n(l[k],l[w])}),c=0,u=d?(p-s*M)/d:0;c<s;++c,g=v)f=h[c],x=m[f],v=g+(x>0?x*u:0)+M,m[f]={data:l[f],index:c,value:x,startAngle:g,endAngle:v,padAngle:T};return m}return a.value=function(l){return arguments.length?(t=typeof l=="function"?l:Wt(+l),a):t},a.sortValues=function(l){return arguments.length?(e=l,n=null,a):e},a.sort=function(l){return arguments.length?(n=l,e=null,a):n},a.startAngle=function(l){return arguments.length?(r=typeof l=="function"?l:Wt(+l),a):r},a.endAngle=function(l){return arguments.length?(i=typeof l=="function"?l:Wt(+l),a):i},a.padAngle=function(l){return arguments.length?(o=typeof l=="function"?l:Wt(+l),a):o},a}function Vo(t){return t<0?-1:1}function Wo(t,e,n){var r=t._x1-t._x0,i=e-t._x1,o=(t._y1-t._y0)/(r||i<0&&-0),a=(n-t._y1)/(i||r<0&&-0),l=(o*i+a*r)/(r+i);return(Vo(o)+Vo(a))*Math.min(Math.abs(o),Math.abs(a),.5*Math.abs(l))||0}function Oo(t,e){var n=t._x1-t._x0;return n?(3*(t._y1-t._y0)/n-e)/2:e}function oi(t,e,n){var r=t._x0,i=t._y0,o=t._x1,a=t._y1,l=(o-r)/3;t._context.bezierCurveTo(r+l,i+l*e,o-l,a-l*n,o,a)}function $r(t){this._context=t}$r.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:oi(this,this._t0,Oo(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var n=NaN;if(t=+t,e=+e,!(t===this._x1&&e===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,oi(this,Oo(this,n=Wo(this,t,e)),n);break;default:oi(this,this._t0,n=Wo(this,t,e));break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=n}}};Object.create($r.prototype).point=function(t,e){$r.prototype.point.call(this,e,t)};function Yo(t){return new $r(t)}function qo(t,e){if((a=t.length)>1)for(var n=1,r,i,o=t[e[0]],a,l=o.length;n<a;++n)for(i=o,o=t[e[n]],r=0;r<l;++r)o[r][1]+=o[r][0]=isNaN(i[r][1])?i[r][0]:i[r][1]}function Ko(t){for(var e=t.length,n=new Array(e);--e>=0;)n[e]=e;return n}function gg(t,e){return t[e]}function pg(t){const e=[];return e.key=t,e}function yg(){var t=Wt([]),e=Ko,n=qo,r=gg;function i(o){var a=Array.from(t.apply(this,arguments),pg),l,c=a.length,s=-1,f;for(const u of o)for(l=0,++s;l<c;++l)(a[l][s]=[0,+r(u,a[l].key,s,o)]).data=u;for(l=0,f=Wi(e(a));l<c;++l)a[f[l]].index=l;return n(a,f),a}return i.keys=function(o){return arguments.length?(t=typeof o=="function"?o:Wt(Array.from(o)),i):t},i.value=function(o){return arguments.length?(r=typeof o=="function"?o:Wt(+o),i):r},i.order=function(o){return arguments.length?(e=o==null?Ko:typeof o=="function"?o:Wt(Array.from(o)),i):e},i.offset=function(o){return arguments.length?(n=o??qo,i):n},i}function qn(t,e,n){this.k=t,this.x=e,this.y=n}qn.prototype={constructor:qn,scale:function(t){return t===1?this:new qn(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new qn(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};qn.prototype;function vg(t){const e=t-1;return e*e*e+1}function Xo(t,{delay:e=0,duration:n=400,easing:r=vg,axis:i="y"}={}){const o=getComputedStyle(t),a=+o.opacity,l=i==="y"?"height":"width",c=parseFloat(o[l]),s=i==="y"?["top","bottom"]:["left","right"],f=s.map(v=>`${v[0].toUpperCase()}${v.slice(1)}`),u=parseFloat(o[`padding${f[0]}`]),d=parseFloat(o[`padding${f[1]}`]),h=parseFloat(o[`margin${f[0]}`]),m=parseFloat(o[`margin${f[1]}`]),g=parseFloat(o[`border${f[0]}Width`]),p=parseFloat(o[`border${f[1]}Width`]);return{delay:e,duration:n,easing:r,css:v=>`overflow: hidden;opacity: ${Math.min(v*20,1)*a};${l}: ${v*c}px;padding-${s[0]}: ${v*u}px;padding-${s[1]}: ${v*d}px;margin-${s[0]}: ${v*h}px;margin-${s[1]}: ${v*m}px;border-${s[0]}-width: ${v*g}px;border-${s[1]}-width: ${v*p}px;`}}function Go(t){let e,n,r,i,o,a,l,c=(t[0]?t[12]:t[13])+"",s,f,u;return{c(){e=R("button"),n=Xt("svg"),r=Xt("circle"),i=Xt("line"),o=Xt("line"),a=bt(),l=R("span"),s=j(c),y(r,"cx","12"),y(r,"cy","12"),y(r,"r","10"),y(i,"x1","12"),y(i,"y1","16"),y(i,"x2","12"),y(i,"y2","12"),y(o,"x1","12"),y(o,"y1","8"),y(o,"x2","12.01"),y(o,"y2","8"),y(n,"xmlns","http://www.w3.org/2000/svg"),y(n,"width","16"),y(n,"height","16"),y(n,"viewBox","0 0 24 24"),y(n,"fill","none"),y(n,"stroke","currentColor"),y(n,"stroke-width","2"),y(n,"stroke-linecap","round"),y(n,"stroke-linejoin","round"),y(n,"class","text-primary"),y(l,"class","sr-only"),y(e,"class","p-xs flex items-center justify-center rounded-full cursor-pointer bg-card border border-solid border-light info-button svelte-dipw5r"),y(e,"aria-expanded",t[0]),y(e,"aria-controls",t[4]),y(e,"type","button")},m(d,h){ut(d,e,h),b(e,n),b(n,r),b(n,i),b(n,o),b(e,a),b(e,l),b(l,s),t[17](e),f||(u=Zt(e,"click",t[16]),f=!0)},p(d,h){h&12289&&c!==(c=(d[0]?d[12]:d[13])+"")&&ht(s,c),h&1&&y(e,"aria-expanded",d[0]),h&16&&y(e,"aria-controls",d[4])},d(d){d&&ct(e),t[17](null),f=!1,u()}}}function Zo(t){let e,n,r=(t[3]?t[15]:t[2])+"",i,o,a;return{c(){e=R("div"),n=R("p"),i=j(r),y(n,"class","m-0 text-secondary text-sm"),y(e,"id",t[4]),y(e,"class","absolute top-100 left-0 right-0 bg-card rounded p-md mt-xs border border-solid border-default shadow-lg z-popover description svelte-dipw5r"),y(e,"role","region"),y(e,"aria-label",t[14])},m(l,c){ut(l,e,c),b(e,n),b(n,i),t[18](e),a=!0},p(l,c){(!a||c&32780)&&r!==(r=(l[3]?l[15]:l[2])+"")&&ht(i,r),(!a||c&16)&&y(e,"id",l[4]),(!a||c&16384)&&y(e,"aria-label",l[14])},i(l){a||(en(()=>{a&&(o||(o=Gi(e,Xo,{duration:150,easing:Jo},!0)),o.run(1))}),a=!0)},o(l){o||(o=Gi(e,Xo,{duration:150,easing:Jo},!1)),o.run(0),a=!1},d(l){l&&ct(e),t[18](null),l&&o&&o.end()}}}function _g(t){let e,n,r,i,o,a,l,c=(t[2]||t[3])&&Go(t),s=t[0]&&(t[2]||t[3])&&Zo(t);return{c(){e=R("div"),n=R("div"),r=R("h2"),i=bt(),c&&c.c(),o=bt(),s&&s.c(),y(r,"class","m-0 text-lg text-primary flex-1"),y(n,"class","flex items-center gap-sm pb-sm bg-page relative z-above title-container"),y(e,"class",a="mb-md relative visualization-header "+t[5]+" svelte-dipw5r")},m(f,u){ut(f,e,u),b(e,n),b(n,r),r.innerHTML=t[1],b(n,i),c&&c.m(n,null),b(e,o),s&&s.m(e,null),l=!0},p(f,[u]){(!l||u&2)&&(r.innerHTML=f[1]),f[2]||f[3]?c?c.p(f,u):(c=Go(f),c.c(),c.m(n,null)):c&&(c.d(1),c=null),f[0]&&(f[2]||f[3])?s?(s.p(f,u),u&13&&$t(s,1)):(s=Zo(f),s.c(),$t(s,1),s.m(e,null)):s&&(Pr(),Ht(s,1,1,()=>{s=null}),Hr()),(!l||u&32&&a!==(a="mb-md relative visualization-header "+f[5]+" svelte-dipw5r"))&&y(e,"class",a)},i(f){l||($t(s),l=!0)},o(f){Ht(s),l=!1},d(f){f&&ct(e),c&&c.d(),s&&s.d()}}}const Jo=t=>t;function bg(t,e,n){let r,i,o,a,l,c=xt,s=()=>(c(),c=Qe(r,E=>n(12,l=E)),r),f,u=xt,d=()=>(u(),u=Qe(i,E=>n(13,f=E)),i),h,m=xt,g=()=>(m(),m=Qe(o,E=>n(14,h=E)),o),p,v=xt,T=()=>(v(),v=Qe(a,E=>n(15,p=E)),a);t.$$.on_destroy.push(()=>c()),t.$$.on_destroy.push(()=>u()),t.$$.on_destroy.push(()=>m()),t.$$.on_destroy.push(()=>v());let{title:M=""}=e,{description:x=""}=e,{descriptionTranslationKey:k=""}=e,{showDescription:w=!1}=e,{descriptionId:S}=e,{className:N=""}=e,H,U;function _(E){E.stopPropagation(),E.preventDefault(),n(0,w=!w)}function X(E){if(!w)return;const z=E.target,B=H&&!H.contains(z),$=U&&!U.contains(z);B&&$&&n(0,w=!1)}xe(()=>{document.addEventListener("click",X)}),Ve(()=>{document.removeEventListener("click",X)});function A(E){le[E?"unshift":"push"](()=>{H=E,n(6,H)})}function C(E){le[E?"unshift":"push"](()=>{U=E,n(7,U)})}return t.$$set=E=>{"title"in E&&n(1,M=E.title),"description"in E&&n(2,x=E.description),"descriptionTranslationKey"in E&&n(3,k=E.descriptionTranslationKey),"showDescription"in E&&n(0,w=E.showDescription),"descriptionId"in E&&n(4,S=E.descriptionId),"className"in E&&n(5,N=E.className)},t.$$.update=()=>{t.$$.dirty&8&&T(n(8,a=k?ft(k):void 0))},s(n(11,r=ft("ui.hide_info"))),d(n(10,i=ft("ui.show_info"))),g(n(9,o=ft("ui.visualization_description"))),[w,M,x,k,S,N,H,U,a,o,i,r,l,f,h,p,_,A,C]}class wg extends pe{constructor(e){super(),ge(this,e,bg,_g,ce,{title:1,description:2,descriptionTranslationKey:3,showDescription:0,descriptionId:4,className:5})}}function qr(t={}){const{backgroundColor:e="rgba(0, 0, 0, 0.8)",color:n="white",padding:r="8px 12px",borderRadius:i="4px",fontSize:o="12px",zIndex:a="1000",boxShadow:l="0 2px 5px rgba(0,0,0,0.2)",defaultWidth:c=200,defaultHeight:s=100,offset:f=10}=t;let u=null;function d(){try{u&&document.body.contains(u)&&document.body.removeChild(u),u=document.createElement("div"),u.style.position="absolute",u.style.backgroundColor=e,u.style.color=n,u.style.padding=r,u.style.borderRadius=i,u.style.pointerEvents="none",u.style.display="none",u.style.fontSize=o,u.style.zIndex=a,u.style.boxShadow=l,t.maxWidth&&(u.style.maxWidth=t.maxWidth),t.whiteSpace&&(u.style.whiteSpace=t.whiteSpace),document&&document.body&&document.body.appendChild(u)}catch(v){console.error("Error creating tooltip:",v),u=null}}function h(v,T,M=c,x=s){try{if((!u||!document.body.contains(u))&&d(),!u)return;u.innerHTML=T;const k=m(v,M,x);u.style.left=`${k.left}px`,u.style.top=`${k.top}px`,u.style.display="block"}catch(k){console.error("Error showing tooltip:",k)}}function m(v,T=c,M=s){try{let x=v.pageX+f,k=v.pageY+f;return x+T>window.innerWidth&&(x=v.pageX-T-f),k+M>window.innerHeight&&(k=v.pageY-M-f),{left:x,top:k}}catch(x){return console.error("Error calculating tooltip position:",x),{left:window.innerWidth/2-T/2,top:window.innerHeight/2-M/2}}}function g(){try{u&&document.body.contains(u)&&(u.style.display="none")}catch(v){console.error("Error hiding tooltip:",v)}}function p(v){try{u&&document.body.contains(u)&&(u.innerHTML=v)}catch(T){console.error("Error updating tooltip content:",T)}}return xe(()=>{d()}),Ve(()=>{u&&document.body.contains(u)&&document.body.removeChild(u)}),{showTooltip:h,hideTooltip:g,updateTooltipContent:p,calculatePosition:m,getTooltipElement:()=>u}}function Re(t,e){const n=t?`<div class="font-bold mb-xs pb-xs border-b border-white border-opacity-30">
            ${t}
        </div>`:"",r=e.map(i=>`<span>${i.label}:</span><span class="text-right font-bold">${i.value}</span>`).join("");return`
        ${n}
        <div class="grid grid-cols-2 gap-xs">
            ${r}
        </div>
    `}function xg(t){let e;return{c(){e=R("div"),e.textContent=`${at("ui.no_visualization_content")}`,y(e,"class","text-center text-secondary")},m(n,r){ut(n,e,r)},p:xt,d(n){n&&ct(e)}}}function kg(t){let e,n=t[10].error+"",r;return{c(){e=R("div"),r=j(n),y(e,"class","text-center text-error"),y(e,"role","alert")},m(i,o){ut(i,e,o),b(e,r)},p(i,o){o[0]&1024&&n!==(n=i[10].error+"")&&ht(r,n)},d(i){i&&ct(e)}}}function Tg(t){let e;return{c(){e=R("div"),e.textContent=`${at("ui.loading")}`,y(e,"class","text-center text-secondary")},m(n,r){ut(n,e,r)},p:xt,d(n){n&&ct(e)}}}function Cg(t){let e;function n(o,a){return o[10].loading?Tg:o[10].error?kg:xg}let r=n(t),i=r(t);return{c(){e=R("div"),i.c(),y(e,"class","empty-visualization svelte-hwelso"),y(e,"aria-live","polite"),y(e,"style",t[9])},m(o,a){ut(o,e,a),i.m(e,null)},p(o,a){r===(r=n(o))&&i?i.p(o,a):(i.d(1),i=r(o),i&&(i.c(),i.m(e,null))),a[0]&512&&y(e,"style",o[9])},d(o){o&&ct(e),i.d()}}}function zg(t){let e,n,r,i,o,a,l,c;function s(m){t[31](m)}let f={title:t[5],description:t[1],descriptionTranslationKey:t[2],descriptionId:t[11],className:"z-above"};t[0]!==void 0&&(f.showDescription=t[0]),n=new wg({props:f}),le.push(()=>cs(n,"showDescription",s));const u=t[30].default,d=Ma(u,t,t[29],null),h=d||Cg(t);return{c(){e=R("div"),te(n.$$.fragment),i=bt(),o=R("div"),h&&h.c(),y(o,"class","w-full flex-1 flex flex-col relative z-base visualization-content"),y(o,"role","presentation"),y(e,"class",a="w-full flex flex-col relative visualization-wrapper "+t[3]+" "+t[4]+" svelte-hwelso"),y(e,"role","region"),y(e,"aria-label",t[8]),y(e,"aria-describedby",l=t[7]?t[11]:void 0)},m(m,g){ut(m,e,g),Jt(n,e,null),b(e,i),b(e,o),h&&h.m(o,null),t[32](o),c=!0},p(m,g){const p={};g[0]&32&&(p.title=m[5]),g[0]&2&&(p.description=m[1]),g[0]&4&&(p.descriptionTranslationKey=m[2]),!r&&g[0]&1&&(r=!0,p.showDescription=m[0],is(()=>r=!1)),n.$set(p),d?d.p&&(!c||g[0]&536870912)&&Da(d,u,m,m[29],c?Sa(u,m[29],g,null):La(m[29]),null):h&&h.p&&(!c||g[0]&1536)&&h.p(m,c?g:[-1,-1]),(!c||g[0]&24&&a!==(a="w-full flex flex-col relative visualization-wrapper "+m[3]+" "+m[4]+" svelte-hwelso"))&&y(e,"class",a),(!c||g[0]&256)&&y(e,"aria-label",m[8]),(!c||g[0]&128&&l!==(l=m[7]?m[11]:void 0))&&y(e,"aria-describedby",l)},i(m){c||($t(n.$$.fragment,m),$t(h,m),c=!0)},o(m){Ht(n.$$.fragment,m),Ht(h,m),c=!1},d(m){m&&ct(e),Qt(n),h&&h.d(m),t[32](null)}}}function Mg(t,e,n){let r,i,o,a,l;vt(t,ee,L=>n(10,l=L));let{$$slots:c={},$$scope:s}=e,{title:f=""}=e,{translationKey:u=""}=e,{titleHtml:d=""}=e,{description:h=""}=e,{descriptionTranslationKey:m=""}=e,{showDescription:g=!1}=e,{ariaLabel:p=""}=e;const v=`viz-desc-${Math.random().toString(36).slice(2,11)}`;let{enableResizeObserver:T=!0}=e,M,x;const k=$a();let{theme:w="default"}=e,{customBackground:S=""}=e,{customTextColor:N=""}=e,{minHeight:H="400px"}=e,{padding:U="var(--spacing-md)"}=e,{className:_=""}=e,{enableTooltip:X=!0}=e,{tooltipBackgroundColor:A="rgba(0, 0, 0, 0.8)"}=e,{tooltipTextColor:C="white"}=e,{tooltipMaxWidth:E="250px"}=e;const z=X?qr({backgroundColor:A,color:C,maxWidth:E}):null;function B(L,O,I,P){X&&z&&z.showTooltip(L,O,I,P)}function $(){X&&z&&z.hideTooltip()}function V(L){X&&z&&z.updateTooltipContent(L)}xe(()=>{T&&M&&(x=new ResizeObserver(L=>{const O=L[0];if(O){const{width:I,height:P}=O.contentRect;k("resize",{width:I,height:P})}}),x.observe(M))}),Ve(()=>{x&&M&&(x.unobserve(M),x.disconnect())});function D(L){g=L,n(0,g)}function G(L){le[L?"unshift":"push"](()=>{M=L,n(6,M)})}return t.$$set=L=>{"title"in L&&n(13,f=L.title),"translationKey"in L&&n(14,u=L.translationKey),"titleHtml"in L&&n(15,d=L.titleHtml),"description"in L&&n(1,h=L.description),"descriptionTranslationKey"in L&&n(2,m=L.descriptionTranslationKey),"showDescription"in L&&n(0,g=L.showDescription),"ariaLabel"in L&&n(16,p=L.ariaLabel),"enableResizeObserver"in L&&n(17,T=L.enableResizeObserver),"theme"in L&&n(3,w=L.theme),"customBackground"in L&&n(18,S=L.customBackground),"customTextColor"in L&&n(19,N=L.customTextColor),"minHeight"in L&&n(20,H=L.minHeight),"padding"in L&&n(21,U=L.padding),"className"in L&&n(4,_=L.className),"enableTooltip"in L&&n(22,X=L.enableTooltip),"tooltipBackgroundColor"in L&&n(23,A=L.tooltipBackgroundColor),"tooltipTextColor"in L&&n(24,C=L.tooltipTextColor),"tooltipMaxWidth"in L&&n(25,E=L.tooltipMaxWidth),"$$scope"in L&&n(29,s=L.$$scope)},t.$$.update=()=>{t.$$.dirty[0]&3932160&&n(9,r=`
        min-height: ${H};
        padding: ${U};
        ${S?`background: ${S};`:""}
        ${N?`color: ${N};`:""}
    `),t.$$.dirty[0]&57344&&n(5,i=d||(u?at(u):f)),t.$$.dirty[0]&6&&m&&at(m),t.$$.dirty[0]&65568&&n(8,o=p||i),t.$$.dirty[0]&6&&n(7,a=!!(h||m))},[g,h,m,w,_,i,M,a,o,r,l,v,Re,f,u,d,p,T,S,N,H,U,X,A,C,E,B,$,V,s,c,D,G]}class In extends pe{constructor(e){super(),ge(this,e,Mg,zg,ce,{createGridTooltipContent:12,title:13,translationKey:14,titleHtml:15,description:1,descriptionTranslationKey:2,showDescription:0,ariaLabel:16,enableResizeObserver:17,theme:3,customBackground:18,customTextColor:19,minHeight:20,padding:21,className:4,enableTooltip:22,tooltipBackgroundColor:23,tooltipTextColor:24,tooltipMaxWidth:25,showTooltip:26,hideTooltip:27,updateTooltipContent:28},null,[-1,-1])}get createGridTooltipContent(){return Re}get showTooltip(){return this.$$.ctx[26]}get hideTooltip(){return this.$$.ctx[27]}get updateTooltipContent(){return this.$$.ctx[28]}}const pn={news_article:{id:"news_article",nameEn:"News article",nameFr:"Article de presse",description:"Newspaper and magazine articles"},islamic_periodical:{id:"islamic_periodical",nameEn:"Islamic periodical",nameFr:"Périodique islamique",description:"Islamic magazines and periodicals"},documents:{id:"documents",nameEn:"Documents",nameFr:"Documents divers",description:"Various documents"},photographs:{id:"photographs",nameEn:"Photographs",nameFr:"Photographies",description:"Photographs and images"},video_recording:{id:"video_recording",nameEn:"Video recording",nameFr:"Enregistrement vidéo",description:"Video recordings and footage"},references:{id:"references",nameEn:"References",nameFr:"Références",description:"Reference materials"},other:{id:"other",nameEn:"Other",nameFr:"Autre",description:"Uncategorized items"}},Ag={"24h au Bénin":"news_article","Agence Bénin Presse":"news_article",Banouto:"news_article","Bénin Intelligent":"news_article","Boulevard des Infos":"news_article","Daho-Express":"news_article",Ehuzu:"news_article",Fraternité:"news_article","L'Evénement Précis":"news_article","La Nation":"news_article","La Nouvelle Tribune":"news_article","Le Matinal":"news_article","Les Pharaons":"news_article","Matin Libre":"news_article","Burkina 24":"news_article","Carrefour africain":"news_article",FasoZine:"news_article","L'Evénement":"news_article","L'Observateur":"news_article","L'Observateur Paalga":"news_article","Le Pays":"news_article","LeFaso.net":"news_article",Mutations:"news_article","San Finna":"news_article",Sidwaya:"news_article","Agence Ivoirienne de Presse":"news_article","Fraternité Hebdo":"news_article","Fraternité Matin":"news_article","Ivoire Dimanche":"news_article","L'Alternative":"news_article","L'Intelligent d'Abidjan":"news_article","La Voie":"news_article","Le Jour":"news_article","Le Jour Plus":"news_article","Le Nouvel Horizon":"news_article","Le Patriote":"news_article","Notre Temps":"news_article","Notre Voie":"news_article","Le Sahel":"news_article","Agence Togolaise de Presse":"news_article","Atopani Express":"news_article","Courrier du Golfe":"news_article","Forum Hebdo":"news_article","La Lettre de Tchaoudjo":"news_article","La Nouvelle Marche":"news_article","Le Démocrate":"news_article","L'éveil du Peuple":"news_article","Togo-Presse":"news_article",ASSALAM:"islamic_periodical","Islam Hebdo":"islamic_periodical","Al Mawadda":"islamic_periodical","An-Nasr Trimestriel":"islamic_periodical","An-Nasr Vendredi":"islamic_periodical","L'Appel":"islamic_periodical","L'Autre Regard":"islamic_periodical","La Preuve":"islamic_periodical","Le CERFIste":"islamic_periodical","Le vrai visage de l'islam":"islamic_periodical","AJMCI Infos":"islamic_periodical","Al Minbar":"islamic_periodical","Al Muwassat Info":"islamic_periodical","Al-Azan":"islamic_periodical",Alif:"islamic_periodical","Allahou Akbar":"islamic_periodical","Bulletin d'information du CNI":"islamic_periodical","Islam Info":"islamic_periodical","Les Échos de l'AEEMCI":"islamic_periodical","Plume Libre":"islamic_periodical","Al Maoulid Info":"islamic_periodical","Al Maoulid Magazine":"islamic_periodical","Al Maoulid Magazine (arabe)":"islamic_periodical","Le Pacific":"islamic_periodical","Le Rendez-Vous":"islamic_periodical","Documents divers (Burkina Faso)":"documents","Documents divers (Bénin)":"documents","Documents divers (Côte d'Ivoire)":"documents","Documents divers (Niger)":"documents","Documents divers (Togo)":"documents","Photographies (Burkina Faso)":"photographs","Photographies (Bénin)":"photographs","Photographies (Côte d'Ivoire)":"photographs","Photographies (Niger)":"photographs","Photographies (Togo)":"photographs","Collection de sermons islamiques sur vidéo":"video_recording","Références (Bénin)":"references","Références (Burkina Faso)":"references","Références (Côte d'Ivoire)":"references","Références (Niger)":"references","Références (Nigéria)":"references","Références (Togo)":"references"};function Qo(t,e){const n=pn[t]||pn.other;return e==="fr"?n.nameFr:n.nameEn}function En(t){const{container:e,onResize:n,debounce:r=!0,debounceDelay:i=100}=t;let o=0,a=0,l=null,c=null;function s(){if(!e)return;const u=e.getBoundingClientRect(),d=Math.abs(o-u.width)>1,h=Math.abs(a-u.height)>1;if(!d&&!h)return;o=u.width;const m=window.getComputedStyle(e);m.height!=="auto"&&!m.height.includes("%")||(a=u.height),r?(c!==null&&window.clearTimeout(c),c=window.setTimeout(()=>{n()},i)):n()}e&&(s(),l=new ResizeObserver(()=>{s()}),l.observe(e));function f(){l&&(l.disconnect(),l=null),c!==null&&(window.clearTimeout(c),c=null)}return{width:o,height:a,dimensions:{width:o,height:a},updateDimensions:s,cleanup:f}}function ve(t={}){const{filterMissingValues:e=!0,requiredFields:n=[],filterFn:r,calculatePercentages:i=!0,sortByCount:o=!0,sortDescending:a=!0}=t;function l(u){if(!u||u.length===0)return[];let d=[...u];return r&&(d=d.filter(r)),e&&n.length>0&&(d=d.filter(h=>n.every(m=>h[m]!==void 0&&h[m]!==null&&h[m]!==""))),d}function c(u,d,h){const m=l(u),g=h||m.length,p=to(m,T=>T.length,d),v=Array.from(p,([T,M])=>{const x={key:T,count:M,originalKey:T};return i&&(x.percentage=M/g*100),x});return o&&v.sort((T,M)=>a?M.count-T.count:T.count-M.count),v}function s(u,d,h){const m=l(u),g=h||m.length,p=zi(m,...d);function v(T,M=0){return Array.from(T,([x,k])=>{const w={name:x,originalName:x,value:k instanceof _n?0:k.length,itemCount:k instanceof _n?0:k.length};return i&&(w.percentage=w.value/g*100),k instanceof _n&&(w.children=v(k,M+1),w.value=w.children.reduce((S,N)=>S+N.value,0),w.itemCount=w.value),w})}return{name:"root",children:v(p)}}function f(u,d,h={}){try{const m=l(u),{startDate:g,endDate:p,includeCumulative:v=!0,initialTotal:T=0}=h;console.log("[useDataProcessing] Processing time data for",m.length,"items"),console.log("[useDataProcessing] Date range:",{startDate:g,endDate:p}),T>0&&console.log("[useDataProcessing] Using initial total of",T);const M=m.filter(w=>{try{const S=w[d];if(!S)return!1;const N=new Date(S),H=!isNaN(N.getTime()),U=!g||N>=g,_=!p||N<=p;return H&&U&&_}catch{return console.warn("[useDataProcessing] Error parsing date for item:",w),!1}});if(console.log("[useDataProcessing] Valid items after date filtering:",M.length),M.length>0)console.log("[useDataProcessing] Sample dates:",M.slice(0,3).map(w=>w[d]));else return console.warn("[useDataProcessing] No valid items with dates in the specified range"),[];const x=to(M,w=>w.length,w=>{try{const S=new Date(w[d]);return`${S.getFullYear()}-${String(S.getMonth()+1).padStart(2,"0")}`}catch(S){return console.error("[useDataProcessing] Error formatting date for grouping:",S),"unknown"}});x.has("unknown")&&(console.warn("[useDataProcessing] Removing unknown date entries"),x.delete("unknown"));const k=Array.from(x,([w,S])=>{try{const[N,H]=w.split("-"),U=new Date(parseInt(N),parseInt(H)-1);return{date:U,month:w,monthFormatted:U.toLocaleDateString(void 0,{month:"short",year:"numeric"}),count:S,total:0,percentage:S/M.length*100}}catch(N){return console.error("[useDataProcessing] Error parsing month data:",N),null}}).filter(w=>w!==null).sort((w,S)=>w.date.getTime()-S.date.getTime());if(k.length>1){const w=[],S=k[0].date,N=k[k.length-1].date;let H=new Date(S);for(;H<=N;){const U=H.getFullYear(),_=H.getMonth(),X=`${U}-${String(_+1).padStart(2,"0")}`,A=k.find(C=>C.month===X);A?w.push(A):w.push({date:new Date(U,_),month:X,monthFormatted:new Date(U,_).toLocaleDateString(void 0,{month:"short",year:"numeric"}),count:0,total:0,percentage:0}),H.setMonth(H.getMonth()+1)}w.length>k.length&&(console.log("[useDataProcessing] Filled in missing months:",w.length-k.length),k.length=0,k.push(...w))}if(v){let w=T;k.forEach(S=>{w+=S.count,S.total=w})}return console.log("[useDataProcessing] Processed timeline data:",k.length,"data points"),k}catch(m){return console.error("[useDataProcessing] Error processing time data:",m),[]}}return{filterItems:l,groupAndCount:c,groupHierarchically:s,processTimeData:f}}function jo(t,e,n){const r=t.slice();return r[8]=e[n],r[10]=n,r}function Sg(t){let e,n;return{c(){e=R("span"),n=j(t[1]),y(e,"class","mx-xs opacity-50")},m(r,i){ut(r,e,i),b(e,n)},p(r,i){i&2&&ht(n,r[1])},d(r){r&&ct(e)}}}function ta(t){let e,n,r=t[8].label+"",i,o,a,l,c,s=t[10]>0&&Sg(t);function f(){return t[5](t[8])}function u(...d){return t[6](t[8],...d)}return{c(){s&&s.c(),e=bt(),n=R("span"),i=j(r),o=bt(),y(n,"class",a=Yi(`${t[3]} ${t[10]===t[0].length-1?t[2]:""}`)+" svelte-lpaxl5"),y(n,"tabindex","0"),y(n,"role","link")},m(d,h){s&&s.m(d,h),ut(d,e,h),ut(d,n,h),b(n,i),b(n,o),l||(c=[Zt(n,"click",f),Zt(n,"keypress",u)],l=!0)},p(d,h){t=d,t[10]>0&&s.p(t,h),h&1&&r!==(r=t[8].label+"")&&ht(i,r),h&13&&a!==(a=Yi(`${t[3]} ${t[10]===t[0].length-1?t[2]:""}`)+" svelte-lpaxl5")&&y(n,"class",a)},d(d){s&&s.d(d),d&&ct(e),d&&ct(n),l=!1,me(c)}}}function Dg(t){let e,n=t[0],r=[];for(let i=0;i<n.length;i+=1)r[i]=ta(jo(t,n,i));return{c(){e=R("nav");for(let i=0;i<r.length;i+=1)r[i].c();y(e,"class","breadcrumb-navigation flex items-center text-sm svelte-lpaxl5")},m(i,o){ut(i,e,o);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null)},p(i,[o]){if(o&31){n=i[0];let a;for(a=0;a<n.length;a+=1){const l=jo(i,n,a);r[a]?r[a].p(l,o):(r[a]=ta(l),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=n.length}},i:xt,o:xt,d(i){i&&ct(e),xn(r,i)}}}function Lg(t,e,n){let{items:r=[]}=e,{separator:i="/"}=e,{activeItemClass:o="text-primary font-medium"}=e,{navItemClass:a="hover:text-primary transition-colors cursor-pointer"}=e;const l=$a();function c(u){l("navigate",{id:u})}const s=u=>c(u.id),f=(u,d)=>d.key==="Enter"&&c(u.id);return t.$$set=u=>{"items"in u&&n(0,r=u.items),"separator"in u&&n(1,i=u.separator),"activeItemClass"in u&&n(2,o=u.activeItemClass),"navItemClass"in u&&n(3,a=u.navItemClass)},[r,i,o,a,c,s,f]}class Ig extends pe{constructor(e){super(),ge(this,e,Lg,Dg,ce,{items:0,separator:1,activeItemClass:2,navItemClass:3})}}function Eg(t){let e,n,r,i=t[8]&&t[8].length&&ea(t);return{c(){e=R("div"),n=R("div"),i&&i.c(),y(n,"class","px-sm py-xs"),y(e,"class","breadcrumb-wrapper absolute top-0 left-0 right-0 bg-white bg-opacity-90 p-xs z-10 shadow-sm"),hn(e,"height","30px")},m(o,a){ut(o,e,a),b(e,n),i&&i.m(n,null),r=!0},p(o,a){o[8]&&o[8].length?i?(i.p(o,a),a[0]&256&&$t(i,1)):(i=ea(o),i.c(),$t(i,1),i.m(n,null)):i&&(Pr(),Ht(i,1,1,()=>{i=null}),Hr())},i(o){r||($t(i),r=!0)},o(o){Ht(i),r=!1},d(o){o&&ct(e),i&&i.d()}}}function Ng(t){let e;return{c(){e=R("div"),e.textContent="Initializing visualization...",y(e,"class","loading absolute inset-center text-secondary")},m(n,r){ut(n,e,r)},p:xt,i:xt,o:xt,d(n){n&&ct(e)}}}function Fg(t){let e,n;return{c(){e=R("div"),n=j(t[14]),y(e,"class","no-data absolute inset-center text-secondary")},m(r,i){ut(r,e,i),b(e,n)},p(r,i){i[0]&16384&&ht(n,r[14])},i:xt,o:xt,d(r){r&&ct(e)}}}function $g(t){let e,n=t[0].error+"",r;return{c(){e=R("div"),r=j(n),y(e,"class","error absolute inset-center text-error")},m(i,o){ut(i,e,o),b(e,r)},p(i,o){o[0]&1&&n!==(n=i[0].error+"")&&ht(r,n)},i:xt,o:xt,d(i){i&&ct(e)}}}function Rg(t){let e;return{c(){e=R("div"),e.textContent=`${at("ui.loading")}`,y(e,"class","loading absolute inset-center text-secondary")},m(n,r){ut(n,e,r)},p:xt,i:xt,o:xt,d(n){n&&ct(e)}}}function ea(t){let e,n;return e=new Ig({props:{items:t[8],separator:"/",navItemClass:"text-sm hover:text-primary transition-colors cursor-pointer font-medium",activeItemClass:"text-primary font-bold"}}),e.$on("navigate",t[32]),{c(){te(e.$$.fragment)},m(r,i){Jt(e,r,i),n=!0},p(r,i){const o={};i[0]&256&&(o.items=r[8]),e.$set(o)},i(r){n||($t(e.$$.fragment,r),n=!0)},o(r){Ht(e.$$.fragment,r),n=!1},d(r){Qt(e,r)}}}function na(t){let e,n,r,i,o=t[31](t[4])+"",a;return{c(){e=R("p"),n=j(t[17]),r=j(": "),i=R("strong"),a=j(o),y(i,"class","font-medium"),y(e,"class","text-sm text-secondary mb-xs")},m(l,c){ut(l,e,c),b(e,n),b(e,r),b(e,i),b(i,a)},p(l,c){c[0]&131072&&ht(n,l[17]),c[0]&16&&o!==(o=l[31](l[4])+"")&&ht(a,o)},d(l){l&&ct(e)}}}function Pg(t){let e,n;return{c(){e=R("p"),n=j(t[11]),y(e,"class","text-sm text-secondary mb-xs")},m(r,i){ut(r,e,i),b(e,n)},p(r,i){i[0]&2048&&ht(n,r[11])},d(r){r&&ct(e)}}}function Hg(t){let e,n,r,i,o=t[7].data.name+"",a;return{c(){e=R("p"),n=j(t[18]),r=j(": "),i=R("strong"),a=j(o),y(i,"class","font-medium"),y(e,"class","text-sm text-secondary mb-xs")},m(l,c){ut(l,e,c),b(e,n),b(e,r),b(e,i),b(i,a)},p(l,c){c[0]&262144&&ht(n,l[18]),c[0]&128&&o!==(o=l[7].data.name+"")&&ht(a,o)},d(l){l&&ct(e)}}}function Ug(t){let e,n,r,i,o,a,l,c,s,f,u,d,h,m=t[31](t[3])+"",g,p,v,T,M,x,k,w=t[31](t[6])+"",S,N,H,U,_,X,A=t[31](t[5])+"",C,E,z;const B=[Rg,$g,Fg,Ng,Eg],$=[];function V(I,P){return I[0].loading?0:I[0].error?1:!I[0].items||I[0].items.length===0?2:I[1]?I[10]?4:-1:3}~(n=V(t))&&(r=$[n]=B[n](t));let D=!t[7]&&na(t);function G(I,P){return I[7]?Hg:Pg}let L=G(t),O=L(t);return{c(){e=R("div"),r&&r.c(),i=bt(),o=R("div"),a=R("div"),l=R("h3"),c=j(t[15]),s=bt(),f=R("p"),u=j(t[16]),d=j(": "),h=R("strong"),g=j(m),p=bt(),D&&D.c(),v=bt(),T=R("p"),M=j(t[13]),x=j(": "),k=R("strong"),S=j(w),N=bt(),H=R("p"),U=j(t[12]),_=j(": "),X=R("strong"),C=j(A),E=bt(),O.c(),y(e,"class","chart-container relative flex-1 min-h-450 bg-card rounded p-md overflow-hidden"),y(l,"class","text-primary font-medium border-b pb-xs mb-sm"),y(h,"class","font-medium"),y(f,"class","text-sm text-secondary mb-xs"),y(k,"class","font-medium"),y(T,"class","text-sm text-secondary mb-xs"),y(X,"class","font-medium"),y(H,"class","text-sm text-secondary mb-xs"),y(a,"class","stat-summary"),y(o,"class","stats bg-card shadow rounded p-md")},m(I,P){ut(I,e,P),~n&&$[n].m(e,null),t[33](e),ut(I,i,P),ut(I,o,P),b(o,a),b(a,l),b(l,c),b(a,s),b(a,f),b(f,u),b(f,d),b(f,h),b(h,g),b(a,p),D&&D.m(a,null),b(a,v),b(a,T),b(T,M),b(T,x),b(T,k),b(k,S),b(a,N),b(a,H),b(H,U),b(H,_),b(H,X),b(X,C),b(a,E),O.m(a,null),z=!0},p(I,P){let Y=n;n=V(I),n===Y?~n&&$[n].p(I,P):(r&&(Pr(),Ht($[Y],1,1,()=>{$[Y]=null}),Hr()),~n?(r=$[n],r?r.p(I,P):(r=$[n]=B[n](I),r.c()),$t(r,1),r.m(e,null)):r=null),(!z||P[0]&32768)&&ht(c,I[15]),(!z||P[0]&65536)&&ht(u,I[16]),(!z||P[0]&8)&&m!==(m=I[31](I[3])+"")&&ht(g,m),I[7]?D&&(D.d(1),D=null):D?D.p(I,P):(D=na(I),D.c(),D.m(a,v)),(!z||P[0]&8192)&&ht(M,I[13]),(!z||P[0]&64)&&w!==(w=I[31](I[6])+"")&&ht(S,w),(!z||P[0]&4096)&&ht(U,I[12]),(!z||P[0]&32)&&A!==(A=I[31](I[5])+"")&&ht(C,A),L===(L=G(I))&&O?O.p(I,P):(O.d(1),O=L(I),O&&(O.c(),O.m(a,null)))},i(I){z||($t(r),z=!0)},o(I){Ht(r),z=!1},d(I){I&&ct(e),~n&&$[n].d(),t[33](null),I&&ct(i),I&&ct(o),D&&D.d(),O.d()}}}function Bg(t){let e,n,r,i={titleHtml:t[2],descriptionTranslationKey:"viz.country_distribution_description",theme:"default",className:"country-distribution",$$slots:{default:[Ug]},$$scope:{ctx:t}};return n=new In({props:i}),t[34](n),{c(){e=R("div"),te(n.$$.fragment),y(e,"class","flex flex-col gap-sm w-full h-full country-distribution-container")},m(o,a){ut(o,e,a),Jt(n,e,null),r=!0},p(o,a){const l={};a[0]&4&&(l.titleHtml=o[2]),a[0]&523771|a[2]&4&&(l.$$scope={dirty:a,ctx:o}),n.$set(l)},i(o){r||($t(n.$$.fragment,o),r=!0)},o(o){Ht(n.$$.fragment,o),r=!1},d(o){o&&ct(e),t[34](null),Qt(n)}}}function Vg(t,e,n){let r,i,o,a,l,c,s,f,u,d,h,m,g;vt(t,ee,nt=>n(0,s=nt));let p,v={name:"root",children:[]},T=null,M="en",x="",k=0,w=0,S=0,N=0,H=[],U=null,_=null,X=new Map,A=[{id:null,label:at("viz.all_countries")}],C=new Map,E=new Map;const z=ft("viz.no_data");vt(t,z,nt=>n(14,f=nt));const B=ft("viz.items");vt(t,B,nt=>n(48,o=nt));const $=ft("viz.percent_of_country");vt(t,$,nt=>n(47,i=nt));const V=ft("viz.percent_of_total");vt(t,V,nt=>n(46,r=nt));const D=ft("viz.click_zoom_in");vt(t,D,nt=>n(11,a=nt)),ft("viz.back_to_all"),ft("viz.all_countries"),ft("viz.unknown");const G=ft("viz.no_set");vt(t,G,nt=>n(49,u=nt));const L=ft("viz.summary");vt(t,L,nt=>n(15,d=nt));const O=ft("viz.total_items");vt(t,O,nt=>n(16,h=nt));const I=ft("viz.countries");vt(t,I,nt=>n(17,m=nt));const P=ft("viz.categories");vt(t,P,nt=>n(13,c=nt));const Y=ft("viz.sub_collections");vt(t,Y,nt=>n(12,l=nt));const K=ft("viz.currently_viewing");vt(t,K,nt=>n(18,g=nt)),ft("viz.click_back_to_return");let J,W,it=0,lt=0,F;const{filterItems:q,groupHierarchically:tt}=ve({filterMissingValues:!0,requiredFields:["country"],calculatePercentages:!0,sortByCount:!0,sortDescending:!0});function Z(nt){return nt.toLocaleString(M==="fr"?"fr-FR":"en-US")}function dt(){if(pt)try{if(k>0){const nt=Z(k);n(2,x=at("viz.distribution_items",{0:nt}))}else n(2,x=at("viz.country_distribution_title"))}catch(nt){console.error("Error updating title HTML:",nt),n(2,x="Country Distribution")}}let pt=!1;function Et(){pt&&p&&document.body.contains(p)&&wt()}xe(()=>(n(10,pt=!0),console.log("CountryDistribution component mounted"),(async()=>{try{if(await Pe(),!p){console.error("Container element not found in onMount");return}if(console.log("Container is ready, initializing visualization"),W=En({container:p,onResize:()=>{if(pt&&p&&document.body.contains(p)){const{width:nt,height:yt}=W.dimensions;it=nt,lt=yt,console.log(`Resizing to ${it}x${lt}`),it>0&&lt>0&&wt()}},debounceDelay:50}),F=ie.subscribe(nt=>{var yt;if(!(!pt||!document.body.contains(p))&&(console.log("Language changed to:",nt),M=nt,A&&A.length>0&&n(8,A[0].label=at("viz.all_countries"),A),dt(),s.items&&s.items.length>0)){const Dt=_,At=Dt==null?void 0:Dt.data.originalName;if(n(7,_=null),v=st(s.items),Dt&&At){const gt=(yt=De(v).children)==null?void 0:yt.find(Ct=>Ct.data.originalName===At);if(gt){ot(gt);return}}pt&&p&&document.body.contains(p)&&wt()}}),s.items&&s.items.length>0){if(console.log("Processing initial data"),v=st(s.items),v.children&&v.children.length>0){const Dt=se().domain(v.children.map(At=>At.originalName||At.name)).range(Ce);v.children.forEach(At=>{const et=At.originalName||At.name;C.has(et)||C.set(et,Dt(et))})}const{width:nt,height:yt}=W.dimensions;it=nt,lt=yt,X=new Map,await Pe(),pt&&p&&document.body.contains(p)&&(console.log("Updating visualization after initialization"),wt())}else console.log("Loading items from store"),ee.loadItems()}catch(nt){console.error("Error during initialization:",nt)}})(),()=>{try{console.log("CountryDistribution component unmounting"),n(10,pt=!1),W&&W.cleanup(),F&&F(),p&&mt(p).selectAll("*").remove(),T=null,n(7,_=null),U=null,H=[],X.clear(),console.log("CountryDistribution cleanup complete")}catch(nt){console.error("Error during cleanup:",nt)}}));function st(nt){const yt=tt(nt,[At=>At.country||"",At=>At.item_set_title||u]),Dt={name:"root",children:yt.children.map(At=>{const et=at(`country.${At.name}`)||At.name,gt=new Map;Object.values(pn).forEach(_t=>{gt.set(_t.id,{name:Qo(_t.id,M),children:[],itemCount:0,originalName:_t.id,categoryId:_t.id,isCategory:!0})}),At.children&&At.children.forEach(_t=>{const Q=Ag[_t.name]||"other",Tt=gt.get(Q);Tt!=null&&Tt.children&&(Tt.children.push({name:_t.name,value:_t.value,itemCount:_t.value,originalName:_t.name,categoryId:Q}),Tt.itemCount=(Tt.itemCount||0)+_t.value)});const Ct=Array.from(gt.values()).filter(_t=>_t.children&&_t.children.length>0).sort((_t,Q)=>(Q.itemCount||0)-(_t.itemCount||0));return Ct.forEach(_t=>{_t.children&&_t.children.sort((Q,Tt)=>(Tt.itemCount||0)-(Q.itemCount||0))}),{name:et,children:Ct,itemCount:At.value,originalName:At.name}})};return n(3,k=yt.children.reduce((At,et)=>At+et.value,0)),n(4,w=yt.children.length),n(6,N=Object.keys(pn).length),n(5,S=0),Dt.children&&Dt.children.forEach(At=>{At.children&&At.children.forEach(et=>{et.children&&n(5,S+=et.children.length)})}),dt(),Dt}function ot(nt){var yt,Dt,At;if(n(7,_=nt),_){_.data.isCategory;const et=_.data.isCategory;if(n(8,A=[{id:null,label:at("viz.all_countries")}]),et){const gt=_.parent;gt&&(A.push({id:gt.data.originalName||null,label:gt.data.name}),console.log("Added country to breadcrumb:",gt.data.name,"with ID:",gt.data.originalName))}if(et&&_.data.categoryId){const gt=_.data.categoryId,Ct=Qo(gt,M);A.push({id:_.data.categoryId||null,label:Ct}),console.log("Added category to breadcrumb:",Ct,"with ID:",_.data.categoryId)}else A.push({id:_.data.originalName||null,label:_.data.name}),console.log("Added item to breadcrumb:",_.data.name,"with ID:",_.data.originalName);if(!_.children||_.children.length===0){console.warn("Cannot zoom to node without children");return}if(console.log("Zooming to node:",_.data.name,"Original name:",_.data.originalName,"Is category:",_.data.isCategory),n(3,k=_.data.itemCount||0),_.data.isCategory)_.data.isCategory&&(n(5,S=((Dt=_.children)==null?void 0:Dt.length)||0),n(6,N=1));else{const gt=((yt=_.children)==null?void 0:yt.filter(Ct=>Ct.data.isCategory))||[];n(6,N=gt.length),n(5,S=0),gt.forEach(Ct=>{Ct.children&&n(5,S+=Ct.children.length)})}}else if(n(8,A=[{id:null,label:at("viz.all_countries")}]),s.items&&s.items.length>0){v=st(s.items);const et=s.items.filter(Ct=>Ct.country&&Ct.country.trim()!=="");n(3,k=et.length);const gt=zi(et,Ct=>Ct.country);n(4,w=gt.size),n(6,N=Object.keys(pn).length),n(5,S=0),(At=v.children)==null||At.forEach(Ct=>{var _t;(_t=Ct.children)==null||_t.forEach(Q=>{Q.children&&n(5,S+=Q.children.length)})})}dt(),wt()}function rt(nt){const{id:yt}=nt.detail;if(!pt||!document.body.contains(p)){console.log("Component not mounted, ignoring breadcrumb click");return}if(console.log("Breadcrumb navigation requested for ID:",yt),yt===null){console.log("Navigating to root view"),ot(null);return}if(X&&X.has(yt)){const Dt=X.get(yt);console.log("Found country node in map:",Dt==null?void 0:Dt.data.name),ot(Dt||null);return}if(T&&X)for(const Dt of X.values()){if(!Dt.children)continue;const At=Dt.children.find(et=>et.data.categoryId===yt||et.data.originalName===yt||et.data.name===yt);if(At){console.log("Found category node:",At.data.name,"in country:",Dt.data.name),ot(At);return}}console.log("Could not find a node matching ID:",yt)}function wt(){try{if(!p){console.error("Container element not found");return}const nt={top:30,right:10,bottom:10,left:10};if(_||(v=st(s.items)),!v.children||v.children.length===0){mt(p).select("svg").remove(),mt(p).append("div").attr("class","no-data absolute inset-center text-secondary").text(f);return}mt(p).select("svg").remove(),mt(p).select(".no-data").remove();const yt=p.getBoundingClientRect(),Dt=yt.width-nt.left-nt.right,At=yt.height-nt.top-nt.bottom,gt=mt(p).append("svg").attr("width","100%").attr("height","100%").attr("viewBox",`0 0 ${yt.width} ${yt.height}`).attr("preserveAspectRatio","xMidYMid meet").append("g").attr("transform",`translate(${nt.left}, ${nt.top})`),Ct=wl().size([Dt,At]).paddingOuter(4).paddingTop(20).paddingInner(2).round(!0);let _t;if(_){const Lt={name:_.data.name,children:_.data.children,originalName:_.data.originalName,isCategory:_.data.isCategory,categoryId:_.data.categoryId};_t=De(Lt).sum(Ut=>Ut.value||0).sort((Ut,Yt)=>(Yt.value||0)-(Ut.value||0))}else _t=De(v).sum(Lt=>Lt.value||0).sort((Lt,Ut)=>(Ut.value||0)-(Lt.value||0)),X.clear(),_t.children&&_t.children.forEach(Lt=>{const Ut=Lt.data.originalName||Lt.data.name;X.set(Ut,Lt)});T=_t;try{Ct(_t)}catch(Lt){console.error("Error applying treemap layout:",Lt),n(7,_=null),v=st(s.items),_t=De(v).sum(Ut=>Ut.value||0).sort((Ut,Yt)=>(Yt.value||0)-(Ut.value||0)),T=_t,Ct(_t)}const Q=se().domain(_t.children?_t.children.map(Lt=>Lt.data.originalName||Lt.data.name):[_t.data.originalName||_t.data.name]).range(Ce),Tt=se().domain(Object.keys(pn)).range(Zm),Kt=!_,Vt=_&&!_.data.isCategory,zt=_&&_.data.isCategory;if(Kt){const Lt=_t.children||[];gt.selectAll(".country").data(Lt).enter().append("g").attr("class","country").each(function(Yt){const Nt=mt(this),kt=Yt.data.name,St=Yt.data.originalName||kt;let qt;C.has(St)?qt=C.get(St)||Q(St):(qt=Q(St),C.set(St,qt));const Me=Yt.children||[],be=Nt.selectAll(".category").data(Me).enter().append("g").attr("class","category").attr("transform",It=>{const Ot=It.x0||0,re=It.y0||0;return`translate(${Ot},${re})`});be.append("rect").attr("width",It=>{const Ot=It.x0||0,re=It.x1||0;return Math.max(0,re-Ot)}).attr("height",It=>{const Ot=It.y0||0,re=It.y1||0;return Math.max(0,re-Ot)}).attr("fill",It=>{const Ot=It.data.categoryId||"other",re=de(qt),Ye=`${St}-${Ot}`;let ye;if(E.has(Ye))ye=E.get(Ye)||re.toString();else{const sn=de(Tt(Ot));ye=de(re.r*.7+sn.r*.3,re.g*.7+sn.g*.3,re.b*.7+sn.b*.3).toString(),E.set(Ye,ye)}return ye}).attr("stroke","white").attr("stroke-width",1.5).attr("opacity",.8).attr("class","cursor-pointer").on("click",(It,Ot)=>{ot(Yt)}).on("mouseover",function(It,Ot){Pt(It,Ot)}).on("mousemove",function(It,Ot){Pt(It,Ot)}).on("mouseout",function(){J.hideTooltip()}),be.append("text").attr("x",5).attr("y",15).attr("font-size","var(--font-size-xs)").attr("font-weight","bold").attr("fill","white").attr("class","pointer-events-none").text(It=>It.x1-It.x0<100?It.data.name:`${It.data.name} (${It.data.itemCount||0})`).each(function(It){const Ot=mt(this),re=this.getComputedTextLength(),Ye=It.x1-It.x0-10;if(re>Ye){let ye=It.data.name;Ot.text(ye);let sn=this.getComputedTextLength(),Kr=!1;for(;sn>Ye&&ye.length>3;)ye=ye.slice(0,-1),Ot.text(ye),sn=this.getComputedTextLength(),Kr=!0;Kr&&Ot.text(ye+"..."),Ot.append("title").text(`${kt} > ${It.data.name} (${It.data.itemCount||0} ${o})`)}});let Ae=1/0,Ge=1/0,We=-1/0,Oe=-1/0;Me.forEach(It=>{const Ot=It.x0||0,re=It.y0||0,Ye=It.x1||0,ye=It.y1||0;Ae=Math.min(Ae,Ot),Ge=Math.min(Ge,re),We=Math.max(We,Ye),Oe=Math.max(Oe,ye)}),Nt.append("rect").attr("x",Ae).attr("y",Ge-20).attr("width",We-Ae).attr("height",20).attr("fill",qt).attr("opacity",.9).attr("class","cursor-pointer").on("click",It=>{ot(Yt)}),Nt.append("text").attr("x",Ae+5).attr("y",Ge-6).attr("font-size","var(--font-size-sm)").attr("font-weight","bold").attr("fill","white").attr("class","pointer-events-none").text(`${kt} (${Yt.data.itemCount||0} ${o})`)})}else if(Vt){const Lt=gt.selectAll(".category").data(_t.children||[]).enter().append("g").attr("class","category").attr("transform",Nt=>{const kt=Nt.x0||0,St=Nt.y0||0;return`translate(${kt},${St})`}),Ut=(_==null?void 0:_.data.originalName)||(_==null?void 0:_.data.name)||"",Yt=C.get(Ut)||Q(Ut);Lt.append("rect").attr("width",Nt=>{const kt=Nt.x0||0,St=Nt.x1||0;return Math.max(0,St-kt)}).attr("height",Nt=>{const kt=Nt.y0||0,St=Nt.y1||0;return Math.max(0,St-kt)}).attr("fill",Nt=>{const kt=Nt.data.categoryId||"other",St=`${Ut}-${kt}`;if(E.has(St))return E.get(St)||Yt;{const qt=de(Yt),Me=de(Tt(kt)),Ae=de(qt.r*.7+Me.r*.3,qt.g*.7+Me.g*.3,qt.b*.7+Me.b*.3).toString();return E.set(St,Ae),Ae}}).attr("stroke","white").attr("stroke-width",1.5).attr("opacity",.8).attr("class","cursor-pointer").on("click",(Nt,kt)=>{ot(kt)}).on("mouseover",function(Nt,kt){Pt(Nt,kt)}).on("mousemove",function(Nt,kt){Pt(Nt,kt)}).on("mouseout",function(){J.hideTooltip()}),Lt.append("text").attr("x",5).attr("y",15).attr("font-size","var(--font-size-sm)").attr("font-weight","bold").attr("fill","white").attr("class","pointer-events-none").text(Nt=>`${Nt.data.name} (${Nt.data.itemCount||0} ${o})`).each(function(Nt){const kt=mt(this),St=this.getComputedTextLength(),qt=Nt.x1-Nt.x0-10;St>qt&&kt.text(Nt.data.name).append("title").text(`${Nt.data.name} (${Nt.data.itemCount||0} ${o})`)})}else if(zt&&_){const Lt=gt.selectAll(".subcollection").data(_t.children||[]).enter().append("g").attr("class","subcollection").attr("transform",kt=>{const St=kt.x0||0,qt=kt.y0||0;return`translate(${St},${qt})`}),Ut=_.data.categoryId||"other",Yt=_.parent;let Nt;if(Yt){const St=`${Yt.data.originalName||Yt.data.name}-${Ut}`;Nt=E.get(St)||Tt(Ut)}else Nt=Tt(Ut);Lt.append("rect").attr("width",kt=>{const St=kt.x0||0,qt=kt.x1||0;return Math.max(0,qt-St)}).attr("height",kt=>{const St=kt.y0||0,qt=kt.y1||0;return Math.max(0,qt-St)}).attr("fill",kt=>{const St=de(Nt);return de(St).brighter(.5).toString()}).attr("stroke","white").attr("stroke-width",.5).attr("class","cursor-pointer").on("mouseover",function(kt,St){mt(this).attr("stroke","var(--color-primary)").attr("stroke-width",2),Pt(kt,St)}).on("mousemove",function(kt,St){Pt(kt,St)}).on("mouseout",function(){mt(this).attr("stroke","white").attr("stroke-width",.5),J.hideTooltip()}),Lt.append("text").attr("x",3).attr("y",13).attr("font-size","var(--font-size-xs)").attr("fill","var(--color-text-primary)").attr("class","pointer-events-none").each(function(kt){const St=mt(this),qt=kt.x1-kt.x0,Me=kt.y1-kt.y0;if(qt<30||Me<20)return;let be=kt.data.name;const Ae=qt-6,Ge=Yt?Yt.data.name:"",We=_?_.data.name:"";let Oe="";Ge&&We?Oe=`${Ge} > ${We} > ${kt.data.name}: ${kt.data.itemCount||kt.value||0} ${o}`:We?Oe=`${We} > ${kt.data.name}: ${kt.data.itemCount||kt.value||0} ${o}`:Oe=`${kt.data.name}: ${kt.data.itemCount||kt.value||0} ${o}`,St.text(be).append("title").text(Oe);const It=this;let Ot=It.getComputedTextLength(),re=!1;for(;Ot>Ae&&be.length>3;)be=be.slice(0,-1),St.text(be),Ot=It.getComputedTextLength(),re=!0;re&&(St.text(be+"..."),St.append("title").text(Oe))})}}catch(nt){console.error("Error in updateVisualization:",nt)}}function Pt(nt,yt){var Dt,At;try{if(!J)return;const et=yt.parent===T,gt=yt.data.isCategory===!0,Ct=!et&&!gt;if(et){const _t=yt.data.name,Q=yt.data.itemCount||yt.value||0,Tt=((Dt=yt.children)==null?void 0:Dt.length)||0,Kt=k>0?(Q/k*100).toFixed(1)+"%":"N/A",Vt=`
                    <div class="font-bold mb-xs pb-xs border-b border-white border-opacity-30">
                        ${_t}
                    </div>
                    <div class="grid grid-cols-2 gap-xs">
                        <span>${o}:</span>
                        <span class="text-right font-medium">${Q}</span>
                        <span>${c}:</span>
                        <span class="text-right">${Tt}</span>
                        <span>${r}:</span>
                        <span class="text-right">${Kt}</span>
                    </div>
                    <div class="mt-xs italic text-xs">
                        ${a}
                    </div>
                `;J.showTooltip(nt,Vt,250,150)}else if(gt){const _t=yt.data.name,Q=yt.data.itemCount||yt.value||0,Tt=((At=yt.children)==null?void 0:At.length)||0,Kt=yt.parent,Vt=Kt?Kt.data.name:"",zt=Kt&&(Kt.data.itemCount||Kt.value)||0,Lt=zt>0?(Q/zt*100).toFixed(1)+"%":"N/A",Ut=k>0?(Q/k*100).toFixed(1)+"%":"N/A",Yt=`
                    <div class="font-bold mb-xs pb-xs border-b border-white border-opacity-30">
                        ${Vt} > ${_t}
                    </div>
                    <div class="grid grid-cols-2 gap-xs">
                        <span>${o}:</span>
                        <span class="text-right font-medium">${Q}</span>
                        <span>${l}:</span>
                        <span class="text-right">${Tt}</span>
                        <span>${i}:</span>
                        <span class="text-right">${Lt}</span>
                        <span>${r}:</span>
                        <span class="text-right">${Ut}</span>
                    </div>
                    <div class="mt-xs italic text-xs">
                        ${a}
                    </div>
                `;J.showTooltip(nt,Yt,250,150)}else{const _t=yt.data.name,Q=yt.data.itemCount||yt.value||0,Tt=yt.parent,Kt=Tt==null?void 0:Tt.parent,Vt=Tt?Tt.data.name:"",zt=Kt?Kt.data.name:"",Lt=Tt&&(Tt.data.itemCount||Tt.value)||0,Ut=Kt&&(Kt.data.itemCount||Kt.value)||0,Yt=Lt>0?(Q/Lt*100).toFixed(1)+"%":"N/A",Nt=Ut>0?(Q/Ut*100).toFixed(1)+"%":"N/A",kt=k>0?(Q/k*100).toFixed(1)+"%":"N/A";let St=_t;Vt&&zt?St=`${zt} > ${Vt} > ${_t}`:Vt?St=`${Vt} > ${_t}`:zt&&(St=`${zt} > ${_t}`);const qt=Vt||null,Me=zt||null,be=`
                    <div class="font-bold mb-xs pb-xs border-b border-white border-opacity-30">
                        ${St}
                    </div>
                    <div class="grid grid-cols-2 gap-xs">
                        <span>${o}:</span>
                        <span class="text-right font-medium">${Q}</span>
                        ${qt?`<span>% of ${qt}:</span>
                        <span class="text-right">${Yt}</span>`:""}
                        ${Me?`<span>${i}:</span>
                        <span class="text-right">${Nt}</span>`:""}
                        <span>${r}:</span>
                        <span class="text-right">${kt}</span>
                    </div>
                `;J.showTooltip(nt,be,250,150)}}catch(et){console.error("Error showing tooltip:",et)}}function Mt(nt){le[nt?"unshift":"push"](()=>{p=nt,n(1,p)})}function Ft(nt){le[nt?"unshift":"push"](()=>{J=nt,n(9,J)})}return t.$$.update=()=>{t.$$.dirty[0]&1&&s.items&&Et()},[s,p,x,k,w,S,N,_,A,J,pt,a,l,c,f,d,h,m,g,z,B,$,V,D,G,L,O,I,P,Y,K,Z,rt,Mt,Ft]}class Wg extends pe{constructor(e){super(),ge(this,e,Vg,Bg,ce,{},null,[-1,-1,-1])}}function Rl(t){const{container:e,title:n,titleTranslationKey:r,items:i=[],type:o="html",orientation:a="vertical",position:l="right",customPosition:c,maxItems:s=10,showValues:f=!0,className:u="",valueFormatter:d=z=>z.toLocaleString(),translateKeys:h={itemPrefix:"",othersLabel:"viz.others",countLabel:"viz.items"},responsive:m=!0,breakpoint:g=768,interactive:p=!1,onItemClick:v=()=>{},customProperties:T}=t;let M=n,x=null,k=[...i],w=null;function S(){if(!(e instanceof HTMLElement))return console.error("Container must be an HTMLElement for HTML legend"),null;if(x instanceof HTMLElement)x.innerHTML="";else{x=document.createElement("div");const I=m&&window.innerWidth<g;x.className=`legend ${I?"legend-mobile":"legend-desktop"} ${u}`.trim(),l==="custom"&&c?(x.style.position="absolute",x.style.left=`${c.x}px`,x.style.top=`${c.y}px`):x.classList.add(`legend-${l}`),e.appendChild(x)}const z=m&&window.innerWidth<g;let B="";if(r){const I=ft(r);typeof I=="string"?B=I:I.subscribe(P=>{B=P})()}else M&&(B=M);let $=[...k],V=null;if(s>0&&$.length>s){const I=$.slice(0,s),P=$.slice(s);V={key:"others",label:at(h.othersLabel||"viz.others"),color:"#999999",value:P.reduce((Y,K)=>Y+(K.value||0),0)},$=I}const D=B?`<div class="legend-heading${z?"-mobile":""}">${B}</div>`:"",G=z?"legend-grid-mobile":"legend-grid",L=$.map(I=>{let P=I.label||I.key;if(h.itemPrefix){const it=`${h.itemPrefix}${I.key}`,lt=at(it);lt!==it&&(P=lt)}const Y=z?"legend-color-mobile":"legend-color",K=z?"legend-label-mobile":"legend-label",J=z?"legend-value-mobile":"legend-value",W=I.visible===!1?"opacity: 0.5; text-decoration: line-through;":"";return`
        <div class="${Y}" data-color="${I.color}" style="${W}"></div>
        <div class="${K}" style="${W}">${P}</div>
        ${f&&I.value!==void 0?`<div class="${J}" style="${W}">${d(I.value)}</div>`:""}
      `}).join(""),O=V?`
      <div class="${z?"legend-color-mobile":"legend-color"}" data-color="${V.color}"></div>
      <div class="${z?"legend-label-mobile":"legend-label"}">${V.label}</div>
      ${f&&V.value!==void 0?`<div class="${z?"legend-value-mobile":"legend-value"}">${d(V.value)}</div>`:""}
    `:"";return x.innerHTML=`
      ${D}
      <div class="${G}">
        ${L}
        ${O}
      </div>
    `,x.querySelectorAll("[data-color]").forEach(I=>{I.style.backgroundColor=I.dataset.color||""}),p&&x.querySelectorAll(`.${z?"legend-label-mobile":"legend-label"}`).forEach((P,Y)=>{Y<$.length&&(P.classList.add("cursor-pointer"),P.addEventListener("click",()=>v($[Y],Y)))}),x}function N(){let z;e instanceof HTMLElement?z=mt(e):z=e,z.selectAll(`.legend${u?`.${u}`:""}`).remove();let B=10,$=10;if(l==="custom"&&c)B=c.x,$=c.y;else if(l==="right"){const Y=z.node();Y&&(B=Y.getBoundingClientRect().width-120)}else if(l==="bottom"){const Y=z.node();Y&&($=Y.getBoundingClientRect().height-50)}const V=z.append("g").attr("class",`legend legend-${a} ${u}`.trim()).attr("transform",`translate(${B}, ${$})`);if(M||r){let Y="";if(r){const K=ft(r);typeof K=="string"?Y=K:K.subscribe(J=>{Y=J})()}else M&&(Y=M);V.append("text").attr("class","legend-title").attr("x",0).attr("y",-10).attr("font-size","var(--font-size-xs)").attr("fill","var(--color-text-secondary)").text(Y)}const D=a==="horizontal",G=20,L=20,O=5,I=5,P=s>0&&k.length>s?k.slice(0,s):k;if(P.forEach((Y,K)=>{const J=D?K*(G+O*3+60):0,W=D?0:K*(L+O);let it=Y.label||Y.key;if(h.itemPrefix){const q=`${h.itemPrefix}${Y.key}`,tt=at(q);tt!==q&&(it=tt)}const lt=V.append("g").attr("class","legend-item").attr("transform",`translate(${J}, ${W})`);lt.append("rect").attr("width",G).attr("height",L).attr("fill",Y.color).attr("stroke",Y.visible===!1?"#999":"none").attr("stroke-width",Y.visible===!1?1:0).attr("opacity",Y.visible===!1?.5:1);const F=lt.append("text").attr("x",G+I).attr("y",L/2).attr("dy","0.35em").attr("fill","var(--color-text-primary)").attr("font-size","var(--font-size-sm)").text(it);if(f&&Y.value!==void 0){const q=D?G+I+U(F)+5:G+I,tt=D?L/2:L/2+15;lt.append("text").attr("x",q).attr("y",tt).attr("dy","0.35em").attr("fill","var(--color-text-secondary)").attr("font-size","var(--font-size-xs)").text(d(Y.value))}if(p&&(lt.attr("class","legend-item cursor-pointer").attr("role","button").style("cursor","pointer").on("click",()=>v(Y,K)),Y.visible===!1)){const q=F.node();if(q){const tt=q.getComputedTextLength();lt.append("line").attr("x1",G+I).attr("y1",L/2).attr("x2",G+I+tt).attr("y2",L/2).attr("stroke","var(--color-text-primary)").attr("stroke-width",1)}}}),s>0&&k.length>s){const K=k.slice(s).reduce((F,q)=>F+(q.value||0),0),J=D?P.length*(G+O*3+60):0,W=D?0:P.length*(L+O),it=V.append("g").attr("class","legend-item").attr("transform",`translate(${J}, ${W})`);it.append("rect").attr("width",G).attr("height",L).attr("fill","#999999");const lt=at(h.othersLabel||"viz.others");it.append("text").attr("x",G+I).attr("y",L/2).attr("dy","0.35em").attr("fill","var(--color-text-primary)").attr("font-size","var(--font-size-sm)").text(lt),f&&it.append("text").attr("x",D?G+I+lt.length*8+5:G+I).attr("y",D?L/2:L/2+15).attr("dy","0.35em").attr("fill","var(--color-text-secondary)").attr("font-size","var(--font-size-xs)").text(d(K))}return x=V,V}function H(){let z;e instanceof HTMLElement?z=mt(e):z=e,z.selectAll(`.legend${u?`.${u}`:""}`).remove();let B=10,$=10;if(l==="custom"&&c)B=c.x,$=c.y;else if(l==="right"){const O=z.node();O&&(B=O.getBoundingClientRect().width-120)}const V=z.append("g").attr("class",`legend legend-${a} ${u}`.trim()).attr("transform",`translate(${B}, ${$})`);if(M||r){let O="";if(r){const I=ft(r);typeof I=="string"?O=I:I.subscribe(P=>{O=P})()}else M&&(O=M);V.append("text").attr("class","legend-title").attr("x",0).attr("y",-10).attr("font-size","var(--font-size-xs)").attr("fill","var(--color-text-secondary)").text(O)}const D=20,G=20,L=5;return k.forEach((O,I)=>{var J,W;const P=I*G;let Y=O.label||O.key;if(h.itemPrefix){const it=`${h.itemPrefix}${O.key}`,lt=at(it);lt!==it&&(Y=lt)}const K=V.append("g").attr("class","legend-item").attr("transform",`translate(0, ${P})`);if(K.append("line").attr("x1",0).attr("y1",0).attr("x2",D).attr("y2",0).attr("stroke",O.color).attr("stroke-width",2).attr("stroke-dasharray",((J=O.customProperties)==null?void 0:J.dashArray)||"none"),(W=O.customProperties)!=null&&W.marker&&K.append("circle").attr("cx",D).attr("cy",0).attr("r",3).attr("fill",O.color),K.append("text").attr("x",D+L+5).attr("y",0).attr("dy","0.35em").attr("fill","var(--color-text-primary)").attr("font-size","var(--font-size-sm)").attr("class","legend-item-label").text(Y),p&&(K.attr("class","legend-item cursor-pointer").attr("role","button").style("cursor","pointer").on("click",()=>v(O,I)),O.visible===!1)){const it=Y.length*6;K.append("line").attr("x1",D+L+5).attr("y1",0).attr("x2",D+L+5+it).attr("y2",0).attr("stroke","var(--color-text-primary)").attr("stroke-width",1)}}),x=V,V}function U(z){const B=z.node();return B?B.getComputedTextLength():0}function _(){var z;o==="html"?S():o==="svg"&&(((z=t.customProperties)==null?void 0:z.lineChart)===!0?H():N()),m&&!w&&(w=()=>{const B=x instanceof HTMLElement&&x.classList.contains("legend-mobile"),$=window.innerWidth<g;B!==$&&_()},window.addEventListener("resize",w))}function X(z,B){k=[...z],B!==void 0&&(M=B),_()}function A(z,B){k=k.map(V=>V.key===z?{...V,visible:B}:V),_()}function C(){return x}function E(){w&&(window.removeEventListener("resize",w),w=null),x instanceof HTMLElement&&x.parentNode&&x.parentNode.removeChild(x),e&&o==="svg"&&(e instanceof HTMLElement?mt(e).selectAll(`.legend${u?`.${u}`:""}`).remove():e.selectAll(`.legend${u?`.${u}`:""}`).remove()),x=null}return{render:_,update:X,updateVisibility:A,getLegendElement:C,cleanup:E}}const Og={top:20,right:30,bottom:40,left:50};function Yg(t){const{container:e,width:n=e.clientWidth,height:r=e.clientHeight,margin:i=Og,className:o="d3-visualization",responsive:a=!0}=t;mt(e).select("svg").remove();const l=mt(e).append("svg").attr("width",n).attr("height",r).attr("class",o);a&&l.attr("viewBox",`0 0 ${n} ${r}`).attr("preserveAspectRatio","xMidYMid meet");const c=l.append("g").attr("transform",`translate(${i.left}, ${i.top})`);return{svg:l,chart:c,width:n,height:r,margin:i,chartWidth:n-i.left-i.right,chartHeight:r-i.top-i.bottom}}function qg(t){const{type:e,domain:n,range:r,padding:i=.1,nice:o=!0}=t;let a;switch(e){case"linear":a=jn().domain(n).range(r);break;case"log":a=zl().domain(n).range(r);break;case"time":a=El().domain(n).range(r);break;case"ordinal":a=se().domain(n).range(r);break;case"band":a=$i().domain(n).range(r).padding(i);break;default:throw new Error(`Unsupported scale type: ${e}`)}return o&&["linear","time","log"].includes(e)&&a.nice(),a}function Kg(t){const{type:e,scale:n,position:r=e==="x"?"bottom":"left",ticks:i,tickFormat:o,tickSize:a,tickPadding:l,rotate:c}=t;let s;if(r==="bottom")s=wr(n);else if(r==="top")s=oc(n);else if(r==="left")s=xr(n);else if(r==="right")s=ac(n);else throw new Error(`Unsupported axis position: ${r}`);return i!==void 0&&s.ticks(i),o!==void 0&&s.tickFormat(o),a!==void 0&&s.tickSize(a),l!==void 0&&s.tickPadding(l),{axis:s,rotate:c}}function Xg(t,e){const{axis:n,rotate:r}=e;t.call(n),r&&t.selectAll("text").style("text-anchor",r>45?"end":"middle").attr("dy",r>45?"0.15em":"0.35em").attr("dx",r>45?"-0.8em":"0").attr("transform",`rotate(${r})`)}function Gg(t,e="categorical"){if(e==="categorical")return se().domain(t).range(Ce);if(e==="sequential")return xi(tg).domain([0,t.length-1]);if(e==="diverging")return xi(Qm).domain([0,t.length-1]);throw new Error(`Unsupported color range type: ${e}`)}function Zg(t,e,n="chart-title"){t.append("text").attr("class",n).attr("x",t.attr("width")?parseInt(t.attr("width"))/2:0).attr("y",20).attr("text-anchor","middle").text(e)}function Jg(t,e,n={}){const{position:r={x:10,y:10},orientation:i="horizontal",itemWidth:o=20,itemHeight:a=20,itemMargin:l=5,className:c="legend",width:s=300}=n,f=t.append("g").attr("class",c).attr("transform",`translate(${r.x}, ${r.y})`),u=i==="horizontal"?"legend-horizontal":"legend-vertical";f.classed(u,!0);const d=i==="horizontal",h=f.append("g").attr("class","legend-items");if(c.includes("multi-row-legend")){const p=Math.floor(((s||300)-r.x-20)/(o+l*4)),v=Math.max(3,p);e.forEach((T,M)=>{const x=Math.floor(M/v),w=M%v*(o+l*4),S=x*(a+l*2),N=h.append("g").attr("class","legend-item").attr("transform",`translate(${w}, ${S})`);N.append("rect").attr("class","legend-item-swatch").attr("width",o).attr("height",a).attr("fill",T.color),N.append("text").attr("class","legend-item-label").attr("x",o+l).attr("y",a/2).attr("dy","0.35em").text(T.key)})}else e.forEach((g,p)=>{const v=d?p*(o+l*3):0,T=d?0:p*(a+l),M=h.append("g").attr("class","legend-item").attr("transform",`translate(${v}, ${T})`);M.append("rect").attr("class","legend-item-swatch").attr("width",o).attr("height",a).attr("fill",g.color),M.append("text").attr("class","legend-item-label").attr("x",o+l).attr("y",a/2).attr("dy","0.35em").text(g.key)});return f}function ra(t,e){return"ticks"in t&&typeof t.ticks=="function"?t.ticks(e):"domain"in t&&typeof t.domain=="function"?t.domain():[]}function Qg(t,e){const{width:n,height:r,xScale:i,yScale:o,xTicks:a=10,yTicks:l=10,className:c="grid"}=e,s=t.append("g").attr("class",c);if(i){const f=ra(i,a);s.append("g").attr("class","grid-x").selectAll("line").data(f).enter().append("line").attr("x1",u=>i(u)).attr("x2",u=>i(u)).attr("y1",0).attr("y2",r).attr("stroke","#e0e0e0").attr("stroke-dasharray","3,3")}if(o){const f=ra(o,l);s.append("g").attr("class","grid-y").selectAll("line").data(f).enter().append("line").attr("x1",0).attr("x2",n).attr("y1",u=>o(u)).attr("y2",u=>o(u)).attr("stroke","#e0e0e0").attr("stroke-dasharray","3,3")}return s}function jg(t=500,e=yl){return gl().duration(t).ease(e)}function tp(t){const e=parseInt(t.attr("width")),n=parseInt(t.attr("height"));t.attr("viewBox",`0 0 ${e} ${n}`).attr("preserveAspectRatio","xMidYMid meet").attr("width","100%").attr("height","100%")}function ep(t,e="No data available",n="absolute inset-center text-secondary z-50"){mt(t).select("svg").remove(),mt(t).selectAll(`.${n.split(" ")[0]}`).remove(),mt(t).append("div").attr("class",n).text(e)}function np(t="visualization-tooltip",e={}){return mt(`.${t}`).remove(),mt("body").append("div").attr("class",t).style("position","absolute").style("pointer-events","none").style("opacity",0).style("background",e.background||"rgba(0, 0, 0, 0.8)").style("color",e.color||"white").style("padding",e.padding||"8px 12px").style("border-radius",e.borderRadius||"4px").style("font-size",e.fontSize||"12px").style("z-index",e.zIndex||"1000").style("box-shadow",e.boxShadow||"0 2px 5px rgba(0,0,0,0.2)")}const Gt={createSVG:Yg,createScale:qg,createAxis:Kg,renderAxis:Xg,createColorScale:Gg,addTitle:Zg,createLegend:Jg,addGrid:Qg,createTransition:jg,makeResponsive:tp,handleNoData:ep,createTooltipContainer:np},rp={margin:{top:20,right:20,bottom:20,left:20},innerRadius:0,responsive:!0,colorScheme:Ce,animationDuration:500,hoverEffectEnabled:!0,hoverRadiusIncrease:10,showLegend:!0,legendPosition:"right",showLabels:!1,labelMinAngle:15,sortValues:!1,sortDescending:!0};function ip(t,e){const n={...rp,...e},{container:r,width:i=r.clientWidth,height:o=r.clientHeight,margin:a={top:20,right:20,bottom:20,left:20},innerRadius:l=0,responsive:c=!0,animationDuration:s=500,hoverEffectEnabled:f=!0,hoverRadiusIncrease:u=10,showLabels:d=!1,labelMinAngle:h=15,sortValues:m=!1,sortDescending:g=!0}=n;mt(r).select("svg").remove();let p=[...t];m&&p.sort((z,B)=>g?B.value-z.value:z.value-B.value);const{svg:v,chartWidth:T,chartHeight:M}=Gt.createSVG({container:r,width:i,height:o,margin:a,responsive:c}),k=Math.min(T,M)/2*.9,w=mg().value(z=>z.value);m||w.sort(null);const S=ii().innerRadius(l*k).outerRadius(k),N=ii().innerRadius(l*k).outerRadius(k+u),H=ii().innerRadius(k*.7).outerRadius(k*.7);let U;if(typeof n.colorScheme=="function")U=n.colorScheme;else{const z=se().domain(p.map(B=>B.key)).range(n.colorScheme||Ce);U=B=>z(B)}const _=v.append("g").attr("transform",`translate(${i/2}, ${o/2})`),X=w(p),A=_.selectAll("path").data(X).enter().append("path").attr("class","pie-segment cursor-pointer").attr("d",S).attr("fill",z=>U(z.data.key)).attr("stroke","white").attr("stroke-width",2);if(f&&A.on("mouseenter",function(z,B){mt(this).transition().duration(200).attr("d",N),n.onMouseEnter&&n.onMouseEnter(z,B)}).on("mousemove",function(z,B){n.onMouseMove&&n.onMouseMove(z,B)}).on("mouseleave",function(z,B){mt(this).transition().duration(200).attr("d",S),n.onMouseLeave&&n.onMouseLeave(z,B)}),d&&_.selectAll("text").data(X).enter().append("text").attr("transform",z=>(z.endAngle-z.startAngle)*(180/Math.PI)>=h?`translate(${H.centroid(z)})`:"").attr("dy","0.35em").attr("text-anchor","middle").text(z=>z.data.key).style("font-size","12px").style("fill","var(--color-text-primary, #333)").style("opacity",z=>(z.endAngle-z.startAngle)*(180/Math.PI)>=h?1:0),n.showLegend){p.map(K=>({key:K.key,color:U(K.key),value:K.value,percentage:K.percentage}));const z=i<768,B=z?{width:T,height:100}:{width:180,height:M};z?_.attr("transform",`translate(${i/2}, ${(o-B.height)/2})`):n.legendPosition==="right"&&_.attr("transform",`translate(${(i-B.width)/2}, ${o/2})`);const $=z?a.left:i-B.width,V=z?o-B.height:a.top+20,D=v.append("g").attr("class","legend").attr("transform",`translate(${$}, ${V})`);n.legendTitle&&D.append("text").attr("class","legend-title").attr("x",0).attr("y",z?0:-5).attr("font-size","14px").attr("font-weight","bold").attr("fill","var(--color-text-primary, #333)").text(n.legendTitle);const G=15,L=z?20:25,O=5,I=z?6:12;let P=z?Math.floor(T/120):1;if(P=Math.max(1,P),p.slice(0,I).forEach((K,J)=>{var Z;const W=Math.floor(J/P),it=J%P,lt=z?it*(T/P):0,F=(z?20:0)+W*L,q=D.append("g").attr("class","legend-item").attr("transform",`translate(${lt}, ${F})`);q.append("rect").attr("width",G).attr("height",G).attr("fill",U(K.key)).attr("stroke","var(--color-border, #e2e8f0)").attr("stroke-width",.5).attr("rx",2);const tt=K.label||K.key;if(q.append("text").attr("x",G+O).attr("y",G/2).attr("dy","0.35em").attr("fill","var(--color-text-primary, #333)").attr("font-size","12px").attr("font-family","var(--font-family-base, sans-serif)").text(tt),K.value!==void 0){const dt=z?K.value.toLocaleString():`${K.value.toLocaleString()} (${(Z=K.percentage)==null?void 0:Z.toFixed(1)}%)`;z?q.append("text").attr("x",G+O+tt.length*7+10).attr("y",G/2).attr("dy","0.35em").attr("text-anchor","start").attr("fill","var(--color-text-secondary, #666)").attr("font-size","11px").attr("font-family","var(--font-family-base, sans-serif)").text(`(${K.value.toLocaleString()})`):q.append("text").attr("x",G+O).attr("y",G/2+14).attr("fill","var(--color-text-secondary, #666)").attr("font-size","11px").attr("font-family","var(--font-family-base, sans-serif)").text(dt)}}),p.length>I){const K=p.length-I,J=Math.floor(I/P),W=I%P,it=z?W*(T/P):0,lt=(z?20:0)+J*L;D.append("text").attr("x",it+(z?0:G+O)).attr("y",lt+(z?0:G/2)).attr("fill","var(--color-text-secondary, #666)").attr("font-size","11px").attr("font-style","italic").attr("font-family","var(--font-family-base, sans-serif)").text(`+${K} more...`)}}return{svg:v,pieGroup:_,update:z=>{let B=[...z];if(m&&B.sort((D,G)=>g?G.value-D.value:D.value-G.value),typeof n.colorScheme!="function"){const D=se().domain(B.map(G=>G.key)).range(n.colorScheme||Ce);U=G=>D(G)}const $=w(B),V=_.selectAll("path").data($);if(V.exit().transition().duration(s).attrTween("d",function(D){const G=D,L=G.endAngle,O={...G,startAngle:L,endAngle:L},I=Cn(G,O);return function(P){return S(I(P))}}).remove(),V.enter().append("path").attr("class","pie-segment cursor-pointer").attr("fill",D=>U(D.data.key)).attr("stroke","white").attr("stroke-width",2).attr("d",S).style("opacity",0).transition().duration(s).style("opacity",1),V.transition().duration(s).attrTween("d",function(D){const L=this.__data__,O=Cn(L,D);return function(I){return S(O(I))}}).attr("fill",D=>U(D.data.key)),f&&_.selectAll("path").on("mouseenter",function(D,G){mt(this).transition().duration(200).attr("d",N),n.onMouseEnter&&n.onMouseEnter(D,G)}).on("mousemove",function(D,G){n.onMouseMove&&n.onMouseMove(D,G)}).on("mouseleave",function(D,G){mt(this).transition().duration(200).attr("d",S),n.onMouseLeave&&n.onMouseLeave(D,G)}),d){const D=_.selectAll("text").data($);D.exit().remove(),D.enter().append("text").attr("dy","0.35em").attr("text-anchor","middle").style("font-size","12px").style("fill","var(--color-text-primary, #333)").merge(D).transition().duration(s).attr("transform",G=>(G.endAngle-G.startAngle)*(180/Math.PI)>=h?`translate(${H.centroid(G)})`:"").text(G=>G.data.key).style("opacity",G=>(G.endAngle-G.startAngle)*(180/Math.PI)>=h?1:0)}if(n.showLegend){v.select(".legend").remove();const D=i<768,G=D?{width:T,height:100}:{width:180,height:M};D?_.attr("transform",`translate(${i/2}, ${(o-G.height)/2})`):n.legendPosition==="right"&&_.attr("transform",`translate(${(i-G.width)/2}, ${o/2})`);const L=D?a.left:i-G.width,O=D?o-G.height:a.top+20,I=v.append("g").attr("class","legend").attr("transform",`translate(${L}, ${O})`);n.legendTitle&&I.append("text").attr("class","legend-title").attr("x",0).attr("y",D?0:-5).attr("font-size","14px").attr("font-weight","bold").attr("fill","var(--color-text-primary, #333)").text(n.legendTitle);const P=15,Y=D?20:25,K=5,J=D?6:12;let W=D?Math.floor(T/120):1;if(W=Math.max(1,W),B.slice(0,J).forEach((lt,F)=>{var st;const q=Math.floor(F/W),tt=F%W,Z=D?tt*(T/W):0,dt=(D?20:0)+q*Y,pt=I.append("g").attr("class","legend-item").attr("transform",`translate(${Z}, ${dt})`);pt.append("rect").attr("width",P).attr("height",P).attr("fill",U(lt.key)).attr("stroke","var(--color-border, #e2e8f0)").attr("stroke-width",.5).attr("rx",2);const Et=lt.label||lt.key;if(pt.append("text").attr("x",P+K).attr("y",P/2).attr("dy","0.35em").attr("fill","var(--color-text-primary, #333)").attr("font-size","12px").attr("font-family","var(--font-family-base, sans-serif)").text(Et),lt.value!==void 0){const ot=D?lt.value.toLocaleString():`${lt.value.toLocaleString()} (${(st=lt.percentage)==null?void 0:st.toFixed(1)}%)`;D?pt.append("text").attr("x",P+K+Et.length*7+10).attr("y",P/2).attr("dy","0.35em").attr("text-anchor","start").attr("fill","var(--color-text-secondary, #666)").attr("font-size","11px").attr("font-family","var(--font-family-base, sans-serif)").text(`(${lt.value.toLocaleString()})`):pt.append("text").attr("x",P+K).attr("y",P/2+14).attr("fill","var(--color-text-secondary, #666)").attr("font-size","11px").attr("font-family","var(--font-family-base, sans-serif)").text(ot)}}),B.length>J){const lt=B.length-J,F=Math.floor(J/W),q=J%W,tt=D?q*(T/W):0,Z=(D?20:0)+F*Y;I.append("text").attr("x",tt+(D?0:P+K)).attr("y",Z+(D?0:P/2)).attr("fill","var(--color-text-secondary, #666)").attr("font-size","11px").attr("font-style","italic").attr("font-family","var(--font-family-base, sans-serif)").text(`+${lt} more...`)}}},destroy:()=>{r&&mt(r).select("svg").remove()}}}function op(t,e){return ip(t,{...e,innerRadius:e.innerRadius===void 0?.5:e.innerRadius})}const{Map:ia}=ql;function oa(t,e,n){const r=t.slice();return r[55]=e[n],r}function aa(t,e,n){const r=t.slice();return r[55]=e[n],r}function la(t,e){let n,r=e[55].label+"",i,o,a=e[16](e[55].count)+"",l,c,s;return{key:t,first:null,c(){n=R("option"),i=j(r),o=j(" ("),l=j(a),c=j(")"),n.__value=s=e[55].value,n.value=n.__value,this.first=n},m(f,u){ut(f,n,u),b(n,i),b(n,o),b(n,l),b(n,c)},p(f,u){e=f,u[0]&64&&r!==(r=e[55].label+"")&&ht(i,r),u[0]&64&&a!==(a=e[16](e[55].count)+"")&&ht(l,a),u[0]&64&&s!==(s=e[55].value)&&(n.__value=s,n.value=n.__value)},d(f){f&&ct(n)}}}function sa(t,e){let n,r=e[55].label+"",i,o,a=e[16](e[55].count)+"",l,c,s;return{key:t,first:null,c(){n=R("option"),i=j(r),o=j(" ("),l=j(a),c=j(")"),n.__value=s=e[55].value,n.value=n.__value,this.first=n},m(f,u){ut(f,n,u),b(n,i),b(n,o),b(n,l),b(n,c)},p(f,u){e=f,u[0]&128&&r!==(r=e[55].label+"")&&ht(i,r),u[0]&128&&a!==(a=e[16](e[55].count)+"")&&ht(l,a),u[0]&128&&s!==(s=e[55].value)&&(n.__value=s,n.value=n.__value)},d(f){f&&ct(n)}}}function ca(t){let e,n=at("viz.showing_items",{0:t[16](t[8]),1:t[5].length.toString()})+"",r;return{c(){e=R("span"),r=j(n)},m(i,o){ut(i,e,o),b(e,r)},p(i,o){o[0]&288&&n!==(n=at("viz.showing_items",{0:i[16](i[8]),1:i[5].length.toString()})+"")&&ht(r,n)},d(i){i&&ct(e)}}}function ap(t){let e,n=t[3].error+"",r;return{c(){e=R("div"),r=j(n),y(e,"class","absolute inset-center text-error")},m(i,o){ut(i,e,o),b(e,r)},p(i,o){o[0]&8&&n!==(n=i[3].error+"")&&ht(r,n)},d(i){i&&ct(e)}}}function lp(t){let e;return{c(){e=R("div"),e.textContent=`${at("ui.loading")}`,y(e,"class","absolute inset-center text-secondary")},m(n,r){ut(n,e,r)},p:xt,d(n){n&&ct(e)}}}function sp(t){let e,n,r,i,o,a,l,c=[],s=new ia,f,u,d,h,m,g,p,v=[],T=new ia,M,x,k,w,S,N,H=(t[4]?at("viz.pie_chart"):at("viz.donut_chart"))+"",U,_,X,A,C,E,z,B=t[6];const $=P=>P[55].value;for(let P=0;P<B.length;P+=1){let Y=aa(t,B,P),K=$(Y);s.set(K,c[P]=la(K,Y))}let V=t[7];const D=P=>P[55].value;for(let P=0;P<V.length;P+=1){let Y=oa(t,V,P),K=D(Y);T.set(K,v[P]=sa(K,Y))}let G=t[5].length>0&&ca(t);function L(P,Y){if(P[3].loading)return lp;if(P[3].error)return ap}let O=L(t),I=O&&O(t);return{c(){e=R("div"),n=R("div"),r=R("label"),i=j(t[11]),o=j(":"),a=bt(),l=R("select");for(let P=0;P<c.length;P+=1)c[P].c();f=bt(),u=R("div"),d=R("label"),h=j(t[12]),m=j(":"),g=bt(),p=R("select");for(let P=0;P<v.length;P+=1)v[P].c();M=bt(),x=R("div"),k=R("label"),k.textContent=`${at("viz.chart_type")}:`,w=bt(),S=R("div"),N=R("button"),U=j(H),_=bt(),X=R("div"),G&&G.c(),A=bt(),C=R("div"),I&&I.c(),y(r,"for","country-filter"),y(r,"class","text-xs font-bold text-secondary"),y(l,"id","country-filter"),y(l,"class","p-xs px-sm rounded-sm border border-solid border-default bg-card text-primary"),t[0]===void 0&&en(()=>t[22].call(l)),y(n,"class","flex flex-col gap-xs filter-group svelte-1chk83o"),y(d,"for","type-filter"),y(d,"class","text-xs font-bold text-secondary"),y(p,"id","type-filter"),y(p,"class","p-xs px-sm rounded-sm border border-solid border-default bg-card text-primary"),t[1]===void 0&&en(()=>t[23].call(p)),y(u,"class","flex flex-col gap-xs filter-group svelte-1chk83o"),y(k,"for","chart-type"),y(k,"class","text-xs font-bold text-secondary"),y(N,"class","p-xs px-sm rounded-sm border border-solid border-default bg-card text-primary hover:bg-hover"),y(S,"class","flex items-center"),y(x,"class","flex flex-col gap-xs filter-group svelte-1chk83o"),y(X,"class","ml-auto flex items-end text-sm text-secondary summary svelte-1chk83o"),y(e,"class","flex flex-wrap gap-md p-md bg-card rounded-t border-b border-solid border-default filters svelte-1chk83o"),y(C,"class","chart-container svelte-1chk83o")},m(P,Y){ut(P,e,Y),b(e,n),b(n,r),b(r,i),b(r,o),b(n,a),b(n,l);for(let K=0;K<c.length;K+=1)c[K]&&c[K].m(l,null);qe(l,t[0],!0),b(e,f),b(e,u),b(u,d),b(d,h),b(d,m),b(u,g),b(u,p);for(let K=0;K<v.length;K+=1)v[K]&&v[K].m(p,null);qe(p,t[1],!0),b(e,M),b(e,x),b(x,k),b(x,w),b(x,S),b(S,N),b(N,U),b(e,_),b(e,X),G&&G.m(X,null),ut(P,A,Y),ut(P,C,Y),I&&I.m(C,null),t[24](C),E||(z=[Zt(l,"change",t[17]),Zt(l,"change",t[22]),Zt(p,"change",t[18]),Zt(p,"change",t[23]),Zt(N,"click",t[19])],E=!0)},p(P,Y){Y[0]&2048&&ht(i,P[11]),Y[0]&65600&&(B=P[6],c=Ji(c,Y,$,1,P,B,s,l,Zi,la,null,aa)),Y[0]&65&&qe(l,P[0]),Y[0]&4096&&ht(h,P[12]),Y[0]&65664&&(V=P[7],v=Ji(v,Y,D,1,P,V,T,p,Zi,sa,null,oa)),Y[0]&130&&qe(p,P[1]),Y[0]&16&&H!==(H=(P[4]?at("viz.pie_chart"):at("viz.donut_chart"))+"")&&ht(U,H),P[5].length>0?G?G.p(P,Y):(G=ca(P),G.c(),G.m(X,null)):G&&(G.d(1),G=null),O===(O=L(P))&&I?I.p(P,Y):(I&&I.d(1),I=O&&O(P),I&&(I.c(),I.m(C,null)))},d(P){P&&ct(e);for(let Y=0;Y<c.length;Y+=1)c[Y].d();for(let Y=0;Y<v.length;Y+=1)v[Y].d();G&&G.d(),P&&ct(A),P&&ct(C),I&&I.d(),t[24](null),E=!1,me(z)}}}function cp(t){let e,n,r,i={titleHtml:t[9],descriptionTranslationKey:"viz.language_distribution_description",theme:"default",className:"language-visualization",$$slots:{default:[sp]},$$scope:{ctx:t}};return n=new In({props:i}),t[25](n),{c(){e=R("div"),te(n.$$.fragment),y(e,"class","w-full h-full flex flex-col language-visualization-container")},m(o,a){ut(o,e,a),Jt(n,e,null),r=!0},p(o,a){const l={};a[0]&512&&(l.titleHtml=o[9]),a[0]&6655|a[1]&536870912&&(l.$$scope={dirty:a,ctx:o}),n.$set(l)},i(o){r||($t(n.$$.fragment,o),r=!0)},o(o){Ht(n.$$.fragment,o),r=!1},d(o){o&&ct(e),t[25](null),Qt(n)}}}function up(t,e,n){let r,i,o,a,l;vt(t,ee,Z=>n(3,r=Z)),vt(t,ie,Z=>n(21,i=Z));let c="all",s="all",f=!0,u=[],d=[],h=[],m=0,g="en",p="",v=[],T=0,M=0,x,k=null,w,S;const{filterItems:N,groupAndCount:H}=ve({filterMissingValues:!0,requiredFields:["language"],filterFn:Z=>!(c!=="all"&&Z.country!==c||s!=="all"&&Z.type!==s),calculatePercentages:!0,sortByCount:!0,sortDescending:!0}),U=ve({filterMissingValues:!0,requiredFields:["language","country"],filterFn:Z=>s==="all"||Z.type===s}),_=ve({filterMissingValues:!0,requiredFields:["language","type"],filterFn:Z=>c==="all"||Z.country===c});let X,A,C=!1;const E=se(Ce);let z=new Map;function B(Z){if(z.has(Z))return z.get(Z);const dt=E(Z);return z.set(Z,dt),dt}ft("viz.all_countries"),ft("viz.all_types");const $=ft("viz.filter_by_country");vt(t,$,Z=>n(11,a=Z));const V=ft("viz.filter_by_type");vt(t,V,Z=>n(12,l=Z)),ft("viz.no_data");const D=ft("viz.toggle_languages");vt(t,D,Z=>n(35,o=Z)),ft("viz.showing_items",{0:G(m),1:G(u.length)}),ft("viz.items"),ft("viz.percent_of_total");function G(Z){return Z.toLocaleString(g==="fr"?"fr-FR":"en-US")}function L(Z){const dt=G(Z);return at("viz.language_distribution_items",{0:dt})}function O(){m>0?n(9,p=L(m)):n(9,p=at("viz.language_distribution_title"))}xe(()=>(n(20,C=!0),(async()=>{try{if(await Pe(),!x){console.error("Container element not found in onMount");return}if(S=En({container:x,onResize:()=>{if(C&&x){const{width:Z,height:dt}=S.dimensions;T=Z,M=dt,K()}}}),X=ie.subscribe(Z=>{C&&(g=Z,x&&(O(),r.items&&r.items.length>0&&K()))}),r.items&&r.items.length>0){const{width:Z,height:dt}=S.dimensions;T=Z,M=dt,await Pe(),x&&K()}else ee.loadItems()}catch(Z){console.error("Error during initialization:",Z)}})(),()=>{try{n(20,C=!1),S&&S.cleanup(),X&&X(),A&&(A.cleanup(),A=null),k&&(k.destroy(),k=null),x&&mt(x).selectAll("*").remove()}catch(Z){console.error("Error during cleanup:",Z)}})),Ve(()=>{try{n(20,C=!1),S&&S.cleanup(),X&&X(),A&&(A.cleanup(),A=null),x&&mt(x).selectAll("*").remove()}catch(Z){console.error("Error during cleanup:",Z)}});function I(){if(!r.items||r.items.length===0)return;const dt=H(r.items,pt=>pt.language||"Unknown").map(pt=>({language:pt.key,count:pt.count,percentage:pt.percentage||0}));return dt.forEach(pt=>{z.has(pt.language)||z.set(pt.language,E(pt.language))}),n(8,m=dt.reduce((pt,Et)=>pt+Et.count,0)),O(),dt}function P(){if(!r.items||r.items.length===0)return;const Z=at("viz.all_countries"),dt=at("viz.all_types"),pt=U.filterItems(r.items),Et=_.filterItems(r.items),st=U.groupAndCount(pt,rt=>rt.country||"Unknown");n(6,d=[{value:"all",label:Z,count:pt.length},...st.filter(rt=>rt.key!=="Unknown").map(rt=>{const wt=at(`country.${rt.key}`)||rt.key;return{value:rt.key,label:wt,count:rt.count}}).sort((rt,wt)=>wt.count-rt.count)]);const ot=_.groupAndCount(Et,rt=>rt.type||"Unknown");n(7,h=[{value:"all",label:dt,count:Et.length},...ot.map(rt=>({value:rt.key,label:rt.key,count:rt.count})).sort((rt,wt)=>wt.count-rt.count)])}function Y(Z,dt){var ot;if(!w)return;const pt=dt.data,Et=at(`lang.${pt.key}`)||pt.key,st=Re(Et,[{label:at("viz.items"),value:G(pt.value)},{label:at("viz.percent_of_total"),value:`${((ot=pt.percentage)==null?void 0:ot.toFixed(2))||0}%`}]);w.showTooltip(Z,st)}function K(){if(!x)return;const Z=I();if(n(5,u=Z||[]),!Z||Z.length===0){k&&(k.destroy(),k=null),A&&(A.cleanup(),A=null),Gt.handleNoData(x,at("viz.no_data"));return}if(v.length===0)v=Z.map(ot=>({language:ot.language,visible:!0}));else{const ot=v.map(rt=>rt.language);Z.forEach(rt=>{ot.includes(rt.language)||v.push({language:rt.language,visible:!0})})}const dt=Z.filter(ot=>{const rt=v.find(wt=>wt.language===ot.language);return(rt==null?void 0:rt.visible)??!0}).map(ot=>({key:ot.language,label:at(`lang.${ot.language}`)||ot.language,value:ot.count,percentage:ot.percentage}));if(dt.length===0){k&&(k.destroy(),k=null),A&&(A.cleanup(),A=null),Gt.handleNoData(x,at("viz.no_data"));return}k&&(k.destroy(),k=null),A&&(A.cleanup(),A=null);const pt=x.getBoundingClientRect();T=pt.width,M=pt.height;const Et=T<768;if(k=op(dt,{container:x,width:T,height:M,margin:Et?{top:10,right:10,bottom:50,left:10}:{top:20,right:20,bottom:20,left:20},innerRadius:f?.5:0,responsive:!0,colorScheme:ot=>B(ot),hoverEffectEnabled:!0,hoverRadiusIncrease:Et?5:10,showLegend:!1,showLabels:!1,sortValues:!0,sortDescending:!0,onMouseEnter:Y,onMouseMove:Y,onMouseLeave:()=>w.hideTooltip()}),k){const ot=Z.map(Mt=>{var nt;const Ft=((nt=v.find(yt=>yt.language===Mt.language))==null?void 0:nt.visible)??!0;return{key:Mt.language,label:at(`lang.${Mt.language}`)||Mt.language,color:B(Mt.language),value:Mt.count,visible:Ft,customProperties:{language:Mt.language}}});A=Rl({container:x,title:o,items:ot,type:"html",position:"bottom",orientation:"horizontal",className:"multi-row-legend",showValues:!0,valueFormatter:Mt=>G(Mt),translateKeys:{itemPrefix:"lang."},responsive:!0,breakpoint:768,interactive:!0,onItemClick:Mt=>{const Ft=v.findIndex(nt=>{var yt;return nt.language===((yt=Mt.customProperties)==null?void 0:yt.language)});Ft>=0&&(v[Ft].visible=!v[Ft].visible,v=[...v],K())}}),A.render();const wt=Math.ceil(Z.length/5)*22+30,Pt=mt(x).select("svg");Pt.empty()||Pt.attr("height",M+wt+30)}}function J(Z){const dt=Z.target;n(0,c=dt.value),P(),K()}function W(Z){const dt=Z.target;n(1,s=dt.value),P(),K()}function it(){n(4,f=!f),K()}function lt(){c=qi(this),n(0,c),n(6,d)}function F(){s=qi(this),n(1,s),n(7,h)}function q(Z){le[Z?"unshift":"push"](()=>{x=Z,n(2,x)})}function tt(Z){le[Z?"unshift":"push"](()=>{w=Z,n(10,w)})}return t.$$.update=()=>{t.$$.dirty[0]&1048588&&C&&r.items&&x&&K(),t.$$.dirty[0]&2097163&&(i||c||s)&&r.items&&r.items.length>0&&P()},O(),[c,s,x,r,f,u,d,h,m,p,w,a,l,$,V,D,G,J,W,it,C,i,lt,F,q,tt]}class fp extends pe{constructor(e){super(),ge(this,e,up,cp,ce,{},null,[-1,-1])}}function dp(t){const{container:e,width:n=e.clientWidth,height:r=e.clientHeight,data:i,keyField:o="key",valueField:a="value",className:l="bar-chart",barPadding:c=.2,barCornerRadius:s=3,barStroke:f="white",barStrokeWidth:u=1,margin:d={top:20,right:30,bottom:60,left:50},responsive:h=!0,isMobile:m=!1,showXAxis:g=!0,showYAxis:p=!0,xAxisLabel:v,yAxisLabel:T,xAxisRotation:M=-45,xAxisTickFormat:x,yAxisTickFormat:k,xAxisTicks:w,yAxisTicks:S=5,showValueLabels:N=!0,valueLabelMinHeight:H=15,valueFormatter:U=J=>J.toString(),enableInteraction:_=!0,highlightColor:X,onBarMouseEnter:A,onBarMouseMove:C,onBarMouseLeave:E,onBarClick:z}=t;let B;t.barColors?Array.isArray(t.barColors)?B=se().domain(i.map(J=>J[t.keyField||"key"])).range(t.barColors):B=t.barColors:B=se(Ce);const $=kn(i,J=>J[a])||0,{svg:V,chart:D,chartWidth:G,chartHeight:L}=Gt.createSVG({container:e,width:n,height:r,margin:d,className:l,responsive:h}),O=Gt.createScale({type:"band",domain:i.map(J=>J[o]),range:[0,G],padding:m?Math.min(c,.1):c}),I=Gt.createScale({type:"linear",domain:[0,$*1.1],range:[L,0]});if(g){const J=Gt.createAxis({type:"x",scale:O,position:"bottom",tickFormat:x,ticks:w,rotate:M});D.append("g").attr("class","x-axis").attr("transform",`translate(0, ${L})`).call(W=>Gt.renderAxis(W,J)).selectAll("text").attr("font-size",m?"8px":"var(--font-size-xs)").attr("fill","var(--color-text-primary)"),v&&D.append("text").attr("class","x-axis-label").attr("text-anchor","middle").attr("x",G/2).attr("y",L+(m?d.bottom*.5:d.bottom*.4)).text(v)}if(p){const J=Gt.createAxis({type:"y",scale:I,position:"left",tickFormat:k,ticks:m?Math.min(S,3):S});D.append("g").attr("class","y-axis").call(W=>Gt.renderAxis(W,J)).selectAll("text").attr("font-size",m?"8px":"var(--font-size-xs)").attr("fill","var(--color-text-primary)"),T&&D.append("text").attr("class","y-axis-label").attr("text-anchor","middle").attr("transform","rotate(-90)").attr("x",-L/2).attr("y",m?-d.left+12:-d.left+15).text(T)}const P=D.selectAll(".bar").data(i).enter().append("rect").attr("class","bar").attr("x",J=>O(J[o])||0).attr("y",J=>I(J[a])).attr("width",O.bandwidth()).attr("height",J=>Math.max(0,L-I(J[a]))).attr("fill",J=>B(J.originalKey||J[o])).attr("rx",m?Math.min(s,2):s).attr("ry",m?Math.min(s,2):s).attr("stroke",f).attr("stroke-width",m?u/2:u);_&&P.classed("cursor-pointer",!0).on("mouseenter",function(J,W){const it=this;if(X)mt(it).transition().duration(200).attr("fill",X);else{const lt=B(W.originalKey||W[o]);mt(it).transition().duration(200).attr("fill",de(lt).brighter(.5).toString())}A&&A(J,W,it)}).on("mousemove",function(J,W){C&&C(J,W,this)}).on("mouseleave",function(J,W){const it=this;mt(it).transition().duration(200).attr("fill",B(W.originalKey||W[o])),E&&E(J,W,it)}).on("click",function(J,W){z&&z(J,W,this)}),N&&D.selectAll(".bar-label").data(i).enter().append("text").attr("class","bar-label").attr("x",J=>(O(J[o])||0)+O.bandwidth()/2).attr("y",J=>I(J[a])-5).attr("text-anchor","middle").attr("font-size",m?"8px":"var(--font-size-xs)").attr("fill","var(--color-text-secondary)").attr("display",J=>L-I(J[a])<H&&m?"none":"block").text(J=>U(J[a]));function Y(J){O.domain(J.map(F=>F[o]));const W=kn(J,F=>F[a])||0;if(I.domain([0,W*1.1]),g){const F=D.select(".x-axis"),q=Gt.createAxis({type:"x",scale:O,position:"bottom",tickFormat:x,ticks:w,rotate:M});F.transition().duration(500).call(tt=>Gt.renderAxis(tt,q))}if(p){const F=D.select(".y-axis"),q=Gt.createAxis({type:"y",scale:I,position:"left",tickFormat:k,ticks:m?Math.min(S,3):S});F.transition().duration(500).call(tt=>Gt.renderAxis(tt,q))}const it=D.selectAll(".bar").data(J);it.exit().transition().duration(300).attr("y",L).attr("height",0).remove();const lt=it.enter().append("rect").attr("class","bar").attr("x",F=>O(F[o])||0).attr("y",L).attr("width",O.bandwidth()).attr("height",0).attr("fill",F=>B(F.originalKey||F[o])).attr("rx",m?Math.min(s,2):s).attr("ry",m?Math.min(s,2):s).attr("stroke",f).attr("stroke-width",m?u/2:u);if(_&&lt.classed("cursor-pointer",!0).on("mouseenter",function(F,q){const tt=this;if(X)mt(tt).transition().duration(200).attr("fill",X);else{const Z=B(q.originalKey||q[o]);mt(tt).transition().duration(200).attr("fill",de(Z).brighter(.5).toString())}A&&A(F,q,tt)}).on("mousemove",function(F,q){C&&C(F,q,this)}).on("mouseleave",function(F,q){const tt=this;mt(tt).transition().duration(200).attr("fill",B(q.originalKey||q[o])),E&&E(F,q,tt)}).on("click",function(F,q){z&&z(F,q,this)}),it.transition().duration(500).attr("x",F=>O(F[o])||0).attr("y",F=>I(F[a])).attr("width",O.bandwidth()).attr("height",F=>Math.max(0,L-I(F[a]))).attr("fill",F=>B(F.originalKey||F[o])),lt.transition().duration(500).attr("y",F=>I(F[a])).attr("height",F=>Math.max(0,L-I(F[a]))),N){const F=D.selectAll(".bar-label").data(J);F.exit().remove(),F.enter().append("text").attr("class","bar-label").attr("x",q=>(O(q[o])||0)+O.bandwidth()/2).attr("y",q=>I(q[a])-5).attr("text-anchor","middle").attr("font-size",m?"8px":"var(--font-size-xs)").attr("fill","var(--color-text-secondary)").attr("opacity",0).text(q=>U(q[a])).attr("display",q=>L-I(q[a])<H&&m?"none":"block").transition().duration(500).attr("opacity",1),F.transition().duration(500).attr("x",q=>(O(q[o])||0)+O.bandwidth()/2).attr("y",q=>I(q[a])-5).text(q=>U(q[a])).attr("display",q=>L-I(q[a])<H&&m?"none":"block")}}function K(){V&&(V.selectAll("*").remove(),V.remove())}return{svg:V,chart:D,xScale:O,yScale:I,chartWidth:G,chartHeight:L,update:Y,destroy:K}}function hp(t){let e,n=t[3].error+"",r;return{c(){e=R("div"),r=j(n),y(e,"class","absolute inset-center text-error error")},m(i,o){ut(i,e,o),b(e,r)},p(i,o){o&8&&n!==(n=i[3].error+"")&&ht(r,n)},d(i){i&&ct(e)}}}function mp(t){let e;return{c(){e=R("div"),e.textContent=`${at("ui.loading")}`,y(e,"class","absolute inset-center text-secondary loading")},m(n,r){ut(n,e,r)},p:xt,d(n){n&&ct(e)}}}function gp(t){let e;function n(o,a){if(o[3].loading)return mp;if(o[3].error)return hp}let r=n(t),i=r&&r(t);return{c(){e=R("div"),i&&i.c(),y(e,"class","relative bg-card rounded p-md overflow-hidden min-h-400 w-full chart-container")},m(o,a){ut(o,e,a),i&&i.m(e,null),t[4](e)},p(o,a){r===(r=n(o))&&i?i.p(o,a):(i&&i.d(1),i=r&&r(o),i&&(i.c(),i.m(e,null)))},d(o){o&&ct(e),i&&i.d(),t[4](null)}}}function pp(t){let e,n,r,i={titleHtml:t[1],descriptionTranslationKey:yp,theme:"default",className:"index-visualization",$$slots:{default:[gp]},$$scope:{ctx:t}};return n=new In({props:i}),t[5](n),{c(){e=R("div"),te(n.$$.fragment),y(e,"class","w-full index-visualization-container")},m(o,a){ut(o,e,a),Jt(n,e,null),r=!0},p(o,[a]){const l={};a&2&&(l.titleHtml=o[1]),a&268435465&&(l.$$scope={dirty:a,ctx:o}),n.$set(l)},i(o){r||($t(n.$$.fragment,o),r=!0)},o(o){Ht(n.$$.fragment,o),r=!1},d(o){o&&ct(e),t[5](null),Qt(n)}}}const yp="viz.index_distribution_description";function vp(t,e,n){let r;vt(t,ee,C=>n(3,r=C));const i={Évènements:"Events",Associations:"Organizations",Individus:"Persons",Emplacements:"Locations",Sujets:"Topics","Notices d'autorité":"Authority Files"};function o(C){return i[C]||C}let a=[],l=0,c=!1,s,f="en",u="",d=0,h=0,m=null,g=null,p,v=null;const{filterItems:T,groupAndCount:M}=ve({filterMissingValues:!0,requiredFields:["type"],filterFn:C=>C.type==="Notice d'autorité",calculatePercentages:!0,sortByCount:!0,sortDescending:!0}),x=se(Ce);function k(C){return C.toLocaleString(f==="fr"?"fr-FR":"en-US")}function w(C){const E=k(C);return at("viz.index_distribution_items",{0:E})}function S(){c&&(l>0?n(1,u=w(l)):n(1,u=at("viz.index_distribution_title")))}let N=null;xe(async()=>{try{if(c=!0,await Pe(),!s){console.error("Container element not found in onMount");return}const C=s.getBoundingClientRect();d=C.width||100,h=C.height||400,v=En({container:s,onResize:()=>{c&&s&&v&&(d=v.width,H())},debounce:!0,debounceDelay:200}),N=ie.subscribe(E=>{c&&(f=E,s&&(S(),r.items&&r.items.length>0&&H()))}),g=ee.subscribe(E=>{c&&s&&E.items&&E.items.length>0&&H()}),r.items&&r.items.length>0?H():ee.loadItems()}catch(C){console.error("Error during initialization:",C)}});function H(){if(!(!c||!s))try{d=s.getBoundingClientRect().width,h=500;const E=U();if(!E||E.length===0){Gt.handleNoData(s,at("viz.no_data"));return}a=E;const z=d<768;m&&(m.destroy(),m=null);const B=E.map(D=>({key:D.category,value:D.count,originalKey:D.originalCategory,percentage:D.percentage})),$=E.length>5;m=dp({container:s,width:d,height:h,data:B,margin:{top:20,right:30,bottom:120,left:60},className:"index-distribution-chart",isMobile:z,barColors:x,barPadding:.2,barCornerRadius:3,xAxisLabel:at("viz.categories"),yAxisLabel:at("viz.number_of_items"),xAxisRotation:-75,xAxisTicks:Math.max(3,Math.floor(d/120)),yAxisTicks:z?3:5,xAxisTickFormat:D=>D.length>15?D.substring(0,12)+"...":D,valueFormatter:k,onBarMouseEnter:(D,G)=>{if(!c)return;const L=a.find(O=>O.category===G.key);L&&_(D,L)},onBarMouseMove:(D,G)=>{if(!c)return;const L=a.find(O=>O.category===G.key);L&&_(D,L)},onBarMouseLeave:()=>{c&&p&&p.hideTooltip()}})}catch(C){console.error("Error creating bar chart:",C)}}function U(){if(!r.items||r.items.length===0)return[];console.log(`Processing ${r.items.length} items`);const C=r.items.filter(B=>B.type==="Notice d'autorité");if(console.log(`Found ${C.length} items of type "Notice d'autorité"`),C.length===0)return[];const E=M(C,B=>B.item_set_title||at("viz.uncategorized"));console.log(`Grouped into ${E.length} categories`);const z=E.map(B=>{const V=`category.${o(B.key)}`,D=at(V);return{category:D!==V?D:B.key,originalCategory:B.key,count:B.count,percentage:B.percentage||0}});return l=E.reduce((B,$)=>B+$.count,0),kn(z,B=>B.count),S(),z}function _(C,E){if(!c||!p)return;const z=p.createGridTooltipContent(E.category,[{label:at("viz.items"),value:k(E.count)},{label:at("viz.percent_of_total"),value:`${E.percentage.toFixed(2)}%`}]);p.showTooltip(C,z)}Ve(()=>{try{c=!1,m&&(m.destroy(),m=null),v&&(v.cleanup(),v=null),N&&(N(),N=null),g&&(g(),g=null),s&&mt(s).selectAll("*").remove()}catch(C){console.error("Error during cleanup:",C)}});function X(C){le[C?"unshift":"push"](()=>{s=C,n(0,s)})}function A(C){le[C?"unshift":"push"](()=>{p=C,n(2,p)})}return[s,u,p,r,X,A]}class _p extends pe{constructor(e){super(),ge(this,e,vp,pp,ce,{})}}class ua{constructor(e){Nn(this,"options");Nn(this,"tooltipCallbacks",null);Nn(this,"monthFormat",Xe("%Y-%m"));Nn(this,"displayFormat",Xe("%b %Y"));this.options={...e,isMobile:e.width<768,isExtraSmall:e.width<480}}setTooltipCallbacks(e){this.tooltipCallbacks=e}render(e){try{const{container:n,width:r,height:i,isMobile:o,isExtraSmall:a,currentLang:l="en"}=this.options;if(console.log("[TimelineChart] Rendering with dimensions:",{width:r,height:i}),console.log("[TimelineChart] Container element:",n),console.log("[TimelineChart] Data points to render:",e.length),!e||e.length===0){console.warn("[TimelineChart] No timeline data available"),mt(n).selectAll("*").remove(),mt(n).append("div").attr("class","absolute inset-center text-secondary").text("No timeline data available with the current filters");return}if(!n){console.error("[TimelineChart] Container element is null or undefined");return}let c=r,s=i;(!c||c<=0)&&(console.warn("[TimelineChart] Invalid width, using minimum width of 300px"),c=300),(!s||s<=0)&&(console.warn("[TimelineChart] Invalid height, using minimum height of 500px"),s=500),console.log("[TimelineChart] Using dimensions:",{width:c,height:s}),mt(n).selectAll("*").remove();const f={top:o?20:40,right:o?15:30,bottom:o?70:80,left:o?40:60},u=mt(n).append("svg").attr("width",c).attr("height",s).attr("viewBox",`0 0 ${c} ${s}`).attr("class","timeline-chart"),d=c-f.left-f.right,m=(s-f.top-f.bottom-(o?30:50))/2,g=El().domain(Ys(e,p=>p.date)).range([0,d]);u.append("line").attr("x1",f.left).attr("y1",f.top+m+(o?15:25)).attr("x2",c-f.right).attr("y2",f.top+m+(o?15:25)).attr("stroke","var(--color-border-default)").attr("stroke-width",1).attr("stroke-dasharray","3,3"),this.addLegend(u,f,a,c),u.append("defs").append("marker").attr("id","circle").attr("viewBox","-5 -5 10 10").attr("refX",0).attr("refY",0).attr("markerWidth",5).attr("markerHeight",5).append("circle").attr("r",3).attr("fill","var(--color-primary)"),this.renderMonthlyChart(u,e,f,d,m,g,o),this.renderTotalChart(u,e,f,d,m,g,o),console.log("[TimelineChart] Successfully rendered timeline chart")}catch(n){console.error("[TimelineChart] Error rendering timeline chart:",n);try{this.options.container&&(mt(this.options.container).selectAll("*").remove(),mt(this.options.container).append("div").attr("class","absolute inset-center text-error p-md").text("Error rendering timeline chart. Please check console for details."))}catch(r){console.error("[TimelineChart] Error showing error message:",r)}}}addLegend(e,n,r,i){if(r)return;const{translations:o}=this.options,a=e.append("g").attr("transform",`translate(${i-n.right}, ${n.top-10})`);a.append("line").attr("x1",-100).attr("y1",0).attr("x2",-80).attr("y2",0).attr("stroke","var(--color-primary)").attr("stroke-width",2).attr("marker-end","url(#circle)"),a.append("text").attr("x",-75).attr("y",4).attr("class","text-xs text-secondary").text((o==null?void 0:o.monthlyAdditions)||"Monthly Additions"),a.append("line").attr("x1",-100).attr("y1",20).attr("x2",-80).attr("y2",20).attr("stroke","var(--color-secondary)").attr("stroke-width",2).attr("stroke-dasharray","4 2"),a.append("text").attr("x",-75).attr("y",24).attr("class","text-xs text-secondary").text((o==null?void 0:o.totalItems)||"Total Items")}renderMonthlyChart(e,n,r,i,o,a,l){const{translations:c,currentLang:s="en"}=this.options,f=e.append("g").attr("transform",`translate(${r.left}, ${r.top})`),u=jn().domain([0,(kn(n,g=>g.count)||0)*1.1]).range([o,0]);f.append("g").attr("class","grid").selectAll("line").data(u.ticks(l?3:5)).enter().append("line").attr("x1",0).attr("x2",i).attr("y1",g=>u(g)).attr("y2",g=>u(g)).attr("stroke","var(--color-border-default)").attr("stroke-width",.5);const d=wr(a).ticks(l?6:12).tickFormat(g=>{const p=g;return l?`${p.getMonth()+1}/${p.getFullYear().toString().substr(2)}`:Xe("%Y-%m")(p)});f.append("g").attr("class","x-axis").attr("transform",`translate(0, ${o})`).call(d).selectAll("text").attr("class","text-xs text-primary").attr("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform",`rotate(${l?-45:-30})`);const h=xr(u).ticks(l?3:5);f.append("g").attr("class","y-axis").call(h).selectAll("text").attr("class","text-xs text-primary"),l||f.append("text").attr("class","text-xs text-secondary").attr("transform","rotate(-90)").attr("y",-40).attr("x",-o/2).attr("text-anchor","middle").text((c==null?void 0:c.monthlyAdditions)||"Monthly Additions");const m=Bo().x(g=>a(g.date)).y(g=>u(g.count)).curve(Yo);f.append("path").datum(n).attr("fill","none").attr("stroke","var(--color-primary)").attr("stroke-width",l?1.5:2).attr("d",m),this.addMonthlyDots(f,n,a,u,l)}addMonthlyDots(e,n,r,i,o){const{formatNumber:a,translations:l,currentLang:c="en"}=this.options;if(!this.tooltipCallbacks)return;const{showTooltip:s,hideTooltip:f}=this.tooltipCallbacks;e.selectAll(".dot-monthly").data(o?n.filter((u,d)=>d%2===0):n).enter().append("circle").attr("class","dot-monthly cursor-pointer").attr("cx",u=>r(u.date)).attr("cy",u=>i(u.count)).attr("r",o?3:4).attr("fill","var(--color-primary)").attr("stroke","white").attr("stroke-width",1).on("mouseenter",function(u,d){mt(this).transition().duration(200).attr("r",o?5:6);const h=d.date.toLocaleString(c==="fr"?"fr-FR":"en-US",{month:"long"}),m=d.date.getFullYear(),g=Re(`${h} ${m}`,[{label:(l==null?void 0:l.newItems)||"New Items",value:a?a(d.count):d.count.toString()},{label:(l==null?void 0:l.percentage)||"Percentage",value:`${d.percentage.toFixed(2)}%`}]);s(u,g)}).on("mousemove",function(u,d){const h=d.date.toLocaleString(c==="fr"?"fr-FR":"en-US",{month:"long"}),m=d.date.getFullYear(),g=Re(`${h} ${m}`,[{label:(l==null?void 0:l.newItems)||"New Items",value:a?a(d.count):d.count.toString()},{label:(l==null?void 0:l.percentage)||"Percentage",value:`${d.percentage.toFixed(2)}%`}]);s(u,g)}).on("mouseleave",function(){mt(this).transition().duration(200).attr("r",o?3:4),f()})}renderTotalChart(e,n,r,i,o,a,l){const{translations:c,currentLang:s="en"}=this.options,f=e.append("g").attr("transform",`translate(${r.left}, ${r.top+o+(l?30:50)})`),u=jn().domain([0,(kn(n,g=>g.total)||0)*1.1]).range([o,0]);f.append("g").attr("class","grid").selectAll("line").data(u.ticks(l?3:5)).enter().append("line").attr("x1",0).attr("x2",i).attr("y1",g=>u(g)).attr("y2",g=>u(g)).attr("stroke","var(--color-border-default)").attr("stroke-width",.5);const d=wr(a).ticks(l?6:12).tickFormat(g=>{const p=g;return l?`${p.getMonth()+1}/${p.getFullYear().toString().substr(2)}`:Xe("%Y-%m")(p)});f.append("g").attr("class","x-axis").attr("transform",`translate(0, ${o})`).call(d).selectAll("text").attr("class","text-xs text-primary").attr("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform",`rotate(${l?-45:-30})`);const h=xr(u).ticks(l?3:5);f.append("g").attr("class","y-axis").call(h).selectAll("text").attr("class","text-xs text-primary"),l||(f.append("text").attr("class","text-xs text-secondary").attr("transform","rotate(-90)").attr("y",-40).attr("x",-o/2).attr("text-anchor","middle").text((c==null?void 0:c.totalItems)||"Total Items"),f.append("text").attr("class","text-xs text-secondary").attr("text-anchor","middle").attr("x",i/2).attr("y",o+45).text((c==null?void 0:c.month)||"Month"));const m=Bo().x(g=>a(g.date)).y(g=>u(g.total)).curve(Yo);f.append("path").datum(n).attr("fill","none").attr("stroke","var(--color-secondary)").attr("stroke-width",l?1.5:2).attr("stroke-dasharray","4 2").attr("d",m),this.addTotalDots(f,n,a,u,l)}addTotalDots(e,n,r,i,o){const{formatNumber:a,translations:l,currentLang:c="en"}=this.options;if(!this.tooltipCallbacks)return;const{showTooltip:s,hideTooltip:f}=this.tooltipCallbacks;e.selectAll(".dot-total").data(o?n.filter((u,d)=>d%2===0):n).enter().append("circle").attr("class","dot-total cursor-pointer").attr("cx",u=>r(u.date)).attr("cy",u=>i(u.total)).attr("r",o?3:4).attr("fill","var(--color-secondary)").attr("stroke","white").attr("stroke-width",1).on("mouseenter",function(u,d){mt(this).transition().duration(200).attr("r",o?5:6);const h=d.date.toLocaleString(c==="fr"?"fr-FR":"en-US",{month:"long"}),m=d.date.getFullYear(),g=Re(`${h} ${m}`,[{label:(l==null?void 0:l.totalItems)||"Total Items",value:a?a(d.total):d.total.toString()}]);s(u,g)}).on("mousemove",function(u,d){const h=d.date.toLocaleString(c==="fr"?"fr-FR":"en-US",{month:"long"}),m=d.date.getFullYear(),g=Re(`${h} ${m}`,[{label:(l==null?void 0:l.totalItems)||"Total Items",value:a?a(d.total):d.total.toString()}]);s(u,g)}).on("mouseleave",function(){mt(this).transition().duration(200).attr("r",o?3:4),f()})}}function fa(t,e,n){const r=t.slice();return r[72]=e[n],r}function da(t,e,n){const r=t.slice();return r[75]=e[n],r}function ha(t,e,n){const r=t.slice();return r[75]=e[n],r}function ma(t){let e,n=t[75].label+"",r,i,o=t[34](t[75].count)+"",a,l,c;return{c(){e=R("option"),r=j(n),i=j(" ("),a=j(o),l=j(")"),e.__value=c=t[75].value,e.value=e.__value},m(s,f){ut(s,e,f),b(e,r),b(e,i),b(e,a),b(e,l)},p(s,f){f[0]&64&&n!==(n=s[75].label+"")&&ht(r,n),f[0]&64&&o!==(o=s[34](s[75].count)+"")&&ht(a,o),f[0]&64&&c!==(c=s[75].value)&&(e.__value=c,e.value=e.__value)},d(s){s&&ct(e)}}}function ga(t){let e,n=t[75].label+"",r,i,o=t[34](t[75].count)+"",a,l,c;return{c(){e=R("option"),r=j(n),i=j(" ("),a=j(o),l=j(")"),e.__value=c=t[75].value,e.value=e.__value},m(s,f){ut(s,e,f),b(e,r),b(e,i),b(e,a),b(e,l)},p(s,f){f[0]&128&&n!==(n=s[75].label+"")&&ht(r,n),f[0]&128&&o!==(o=s[34](s[75].count)+"")&&ht(a,o),f[0]&128&&c!==(c=s[75].value)&&(e.__value=c,e.value=e.__value)},d(s){s&&ct(e)}}}function pa(t){let e,n=t[13].replace("{0}",t[34](t[8])).replace("{1}",t[5].length.toString())+"",r;return{c(){e=R("span"),r=j(n)},m(i,o){ut(i,e,o),b(e,r)},p(i,o){o[0]&8480&&n!==(n=i[13].replace("{0}",i[34](i[8])).replace("{1}",i[5].length.toString())+"")&&ht(r,n)},d(i){i&&ct(e)}}}function bp(t){let e,n;return{c(){e=R("div"),n=j(t[14]),y(e,"class","absolute inset-center text-secondary")},m(r,i){ut(r,e,i),b(e,n)},p(r,i){i[0]&16384&&ht(n,r[14])},d(r){r&&ct(e)}}}function wp(t){let e;return{c(){e=R("div"),e.innerHTML=`<div class="loading-spinner mr-sm svelte-1dm70g2"></div> 
                    <span>Initializing visualization...</span>`,y(e,"class","absolute inset-center text-secondary")},m(n,r){ut(n,e,r)},p:xt,d(n){n&&ct(e)}}}function xp(t){let e,n=t[4].error+"",r;return{c(){e=R("div"),r=j(n),y(e,"class","absolute inset-center text-error")},m(i,o){ut(i,e,o),b(e,r)},p(i,o){o[0]&16&&n!==(n=i[4].error+"")&&ht(r,n)},d(i){i&&ct(e)}}}function kp(t){let e,n,r,i;return{c(){e=R("div"),n=R("div"),r=bt(),i=R("span"),i.textContent=`${at("ui.loading")}`,y(n,"class","loading-spinner mr-sm svelte-1dm70g2"),y(e,"class","absolute inset-center text-secondary")},m(o,a){ut(o,e,a),b(e,n),b(e,r),b(e,i)},p:xt,d(o){o&&ct(e)}}}function Tp(t){let e;return{c(){e=R("div"),e.textContent="Store not available",y(e,"class","absolute inset-center text-error")},m(n,r){ut(n,e,r)},p:xt,d(n){n&&ct(e)}}}function Cp(t){let e,n;return{c(){e=R("div"),n=j(t[14]),y(e,"class","p-md col-span-2 text-center text-secondary")},m(r,i){ut(r,e,i),b(e,n)},p(r,i){i[0]&16384&&ht(n,r[14])},d(r){r&&ct(e)}}}function zp(t){var D,G;let e,n,r,i,o,a,l,c,s=t[34](t[8])+"",f,u,d,h,m,g,p=(((D=t[5][0])==null?void 0:D.monthFormatted)||"")+"",v,T,M=(((G=t[5][t[5].length-1])==null?void 0:G.monthFormatted)||"")+"",x,k,w,S,N,H,U=t[34](Math.round(t[8]/(t[5].length||1)))+"",_,X,A,C,E,z,B,$=[...t[5]].sort(va).slice(0,3),V=[];for(let L=0;L<$.length;L+=1)V[L]=ya(fa(t,$,L));return{c(){e=R("div"),n=R("h3"),r=j(t[15]),i=bt(),o=R("p"),a=j(t[10]),l=j(": "),c=R("strong"),f=j(s),u=bt(),d=R("p"),h=j(t[16]),m=j(": "),g=R("strong"),v=j(p),T=j(" to "),x=j(M),k=bt(),w=R("p"),S=j(t[17]),N=j(": "),H=R("strong"),_=j(U),X=bt(),A=R("div"),C=R("h3"),E=j(t[18]),z=bt(),B=R("ul");for(let L=0;L<V.length;L+=1)V[L].c();y(n,"class","mt-0 mb-sm text-md text-primary border-b border-solid border-default pb-xs"),y(c,"class","font-medium"),y(o,"class","text-sm mb-xs"),y(g,"class","font-medium"),y(d,"class","text-sm mb-xs"),y(H,"class","font-medium"),y(w,"class","text-sm"),y(e,"class","p-md stat-summary"),y(C,"class","mt-0 mb-sm text-md text-primary border-b border-solid border-default pb-xs"),y(B,"class","list-style-none p-0 m-0"),y(A,"class","p-md peak-months")},m(L,O){ut(L,e,O),b(e,n),b(n,r),b(e,i),b(e,o),b(o,a),b(o,l),b(o,c),b(c,f),b(e,u),b(e,d),b(d,h),b(d,m),b(d,g),b(g,v),b(g,T),b(g,x),b(e,k),b(e,w),b(w,S),b(w,N),b(w,H),b(H,_),ut(L,X,O),ut(L,A,O),b(A,C),b(C,E),b(A,z),b(A,B);for(let I=0;I<V.length;I+=1)V[I]&&V[I].m(B,null)},p(L,O){var I,P;if(O[0]&32768&&ht(r,L[15]),O[0]&1024&&ht(a,L[10]),O[0]&256&&s!==(s=L[34](L[8])+"")&&ht(f,s),O[0]&65536&&ht(h,L[16]),O[0]&32&&p!==(p=(((I=L[5][0])==null?void 0:I.monthFormatted)||"")+"")&&ht(v,p),O[0]&32&&M!==(M=(((P=L[5][L[5].length-1])==null?void 0:P.monthFormatted)||"")+"")&&ht(x,M),O[0]&131072&&ht(S,L[17]),O[0]&288&&U!==(U=L[34](Math.round(L[8]/(L[5].length||1)))+"")&&ht(_,U),O[0]&262144&&ht(E,L[18]),O[0]&524576|O[1]&8){$=[...L[5]].sort(va).slice(0,3);let Y;for(Y=0;Y<$.length;Y+=1){const K=fa(L,$,Y);V[Y]?V[Y].p(K,O):(V[Y]=ya(K),V[Y].c(),V[Y].m(B,null))}for(;Y<V.length;Y+=1)V[Y].d(1);V.length=$.length}},d(L){L&&ct(e),L&&ct(X),L&&ct(A),xn(V,L)}}}function ya(t){let e,n,r=t[72].monthFormatted+"",i,o,a,l=t[34](t[72].count)+"",c,s,f,u,d=(t[72].count/(t[8]||1)*100).toFixed(1)+"",h,m,g;return{c(){e=R("li"),n=R("span"),i=j(r),o=bt(),a=R("span"),c=j(l),s=bt(),f=j(t[19]),u=j(" ("),h=j(d),m=j("%)"),g=bt(),y(n,"class","text-primary"),y(a,"class","text-secondary font-medium"),y(e,"class","flex justify-between mb-xs text-sm")},m(p,v){ut(p,e,v),b(e,n),b(n,i),b(e,o),b(e,a),b(a,c),b(a,s),b(a,f),b(a,u),b(a,h),b(a,m),b(e,g)},p(p,v){v[0]&32&&r!==(r=p[72].monthFormatted+"")&&ht(i,r),v[0]&32&&l!==(l=p[34](p[72].count)+"")&&ht(c,l),v[0]&524288&&ht(f,p[19]),v[0]&288&&d!==(d=(p[72].count/(p[8]||1)*100).toFixed(1)+"")&&ht(h,d)},d(p){p&&ct(e)}}}function Mp(t){let e,n,r,i,o,a,l,c,s,f,u,d,h,m,g,p,v,T,M,x,k,w,S=t[6],N=[];for(let $=0;$<S.length;$+=1)N[$]=ma(ha(t,S,$));let H=t[7],U=[];for(let $=0;$<H.length;$+=1)U[$]=ga(da(t,H,$));let _=t[5]&&t[5].length>0&&pa(t);function X($,V){if(!$[4])return Tp;if($[4].loading)return kp;if($[4].error)return xp;if(!$[3])return wp;if(!$[5]||$[5].length===0)return bp}let A=X(t),C=A&&A(t);function E($,V){return $[5]&&$[5].length>0?zp:Cp}let z=E(t),B=z(t);return{c(){e=R("div"),n=R("div"),r=R("label"),i=j(t[11]),o=j(":"),a=bt(),l=R("select");for(let $=0;$<N.length;$+=1)N[$].c();c=bt(),s=R("div"),f=R("label"),u=j(t[12]),d=j(":"),h=bt(),m=R("select");for(let $=0;$<U.length;$+=1)U[$].c();g=bt(),p=R("div"),_&&_.c(),v=bt(),T=R("div"),C&&C.c(),M=bt(),x=R("div"),B.c(),y(r,"for","country-filter"),y(r,"class","text-xs font-bold text-secondary"),y(l,"id","country-filter"),y(l,"class","p-xs px-sm rounded-sm border border-solid border-default bg-card text-primary text-sm"),y(n,"class","flex flex-col gap-xs filter-group svelte-1dm70g2"),y(f,"for","type-filter"),y(f,"class","text-xs font-bold text-secondary"),y(m,"id","type-filter"),y(m,"class","p-xs px-sm rounded-sm border border-solid border-default bg-card text-primary text-sm"),y(s,"class","flex flex-col gap-xs filter-group svelte-1dm70g2"),y(p,"class","ml-auto self-end text-sm text-secondary summary svelte-1dm70g2"),y(e,"class","flex flex-wrap gap-md p-md bg-card rounded-t border-b border-solid border-default filters svelte-1dm70g2"),y(T,"class","flex-1 relative min-h-500 bg-card rounded-b p-md chart-container overflow-hidden svelte-1dm70g2"),hn(T,"height","500px"),y(x,"class","grid grid-cols-2 gap-md p-md bg-card rounded shadow mt-md stats svelte-1dm70g2")},m($,V){ut($,e,V),b(e,n),b(n,r),b(r,i),b(r,o),b(n,a),b(n,l);for(let D=0;D<N.length;D+=1)N[D]&&N[D].m(l,null);qe(l,t[0]),b(e,c),b(e,s),b(s,f),b(f,u),b(f,d),b(s,h),b(s,m);for(let D=0;D<U.length;D+=1)U[D]&&U[D].m(m,null);qe(m,t[1]),b(e,g),b(e,p),_&&_.m(p,null),ut($,v,V),ut($,T,V),C&&C.m(T,null),t[42](T),ut($,M,V),ut($,x,V),B.m(x,null),k||(w=[Zt(l,"change",t[35]),Zt(m,"change",t[36])],k=!0)},p($,V){if(V[0]&2048&&ht(i,$[11]),V[0]&64|V[1]&8){S=$[6];let D;for(D=0;D<S.length;D+=1){const G=ha($,S,D);N[D]?N[D].p(G,V):(N[D]=ma(G),N[D].c(),N[D].m(l,null))}for(;D<N.length;D+=1)N[D].d(1);N.length=S.length}if(V[0]&65&&qe(l,$[0]),V[0]&4096&&ht(u,$[12]),V[0]&128|V[1]&8){H=$[7];let D;for(D=0;D<H.length;D+=1){const G=da($,H,D);U[D]?U[D].p(G,V):(U[D]=ga(G),U[D].c(),U[D].m(m,null))}for(;D<U.length;D+=1)U[D].d(1);U.length=H.length}V[0]&130&&qe(m,$[1]),$[5]&&$[5].length>0?_?_.p($,V):(_=pa($),_.c(),_.m(p,null)):_&&(_.d(1),_=null),A===(A=X($))&&C?C.p($,V):(C&&C.d(1),C=A&&A($),C&&(C.c(),C.m(T,null))),z===(z=E($))&&B?B.p($,V):(B.d(1),B=z($),B&&(B.c(),B.m(x,null)))},d($){$&&ct(e),xn(N,$),xn(U,$),_&&_.d(),$&&ct(v),$&&ct(T),C&&C.d(),t[42](null),$&&ct(M),$&&ct(x),B.d(),k=!1,me(w)}}}function Ap(t){let e,n,r;return n=new In({props:{title:"Growth of the Database",titleHtml:t[9],descriptionTranslationKey:Sp,theme:"default",className:"timeline-visualization",$$slots:{default:[Mp]},$$scope:{ctx:t}}}),{c(){e=R("div"),te(n.$$.fragment),y(e,"class","w-full h-full flex flex-col gap-md")},m(i,o){ut(i,e,o),Jt(n,e,null),r=!0},p(i,o){const a={};o[0]&512&&(a.titleHtml=i[9]),o[0]&1048063|o[2]&262144&&(a.$$scope={dirty:o,ctx:i}),n.$set(a)},i(i){r||($t(n.$$.fragment,i),r=!0)},o(i){Ht(n.$$.fragment,i),r=!1},d(i){i&&ct(e),Qt(n)}}}const Sp="viz.growth_since_april_description",va=(t,e)=>e.count-t.count;function Dp(t,e,n){let r,i,o,a,l,c,s,f,u,d,h,m,g,p,v,T;vt(t,ee,Q=>n(4,r=Q)),vt(t,ie,Q=>n(41,i=Q));let M="all",x="all",k=[],w=[],S=[],N=0,H=0,U=0,_="en",X="",A=0,C=0,E,z;const{showTooltip:B,hideTooltip:$}=qr({defaultWidth:200,defaultHeight:100});let V;const{filterItems:D,groupAndCount:G,processTimeData:L}=ve({filterMissingValues:!0,requiredFields:["created_date"],calculatePercentages:!0,sortByCount:!0,sortDescending:!0,filterFn:Q=>!(M!=="all"&&Q.country!==M||x!=="all"&&Q.type!==x)}),O=ve({filterMissingValues:!0,requiredFields:["created_date"],filterFn:Q=>{if(!Q.created_date)return!1;const Tt=new Date(Q.created_date);return isNaN(Tt.getTime())||Tt<new Date(2024,3,1)?!1:x==="all"||Q.type===x}}),I=ve({filterMissingValues:!0,requiredFields:["created_date"],filterFn:Q=>{if(!Q.created_date)return!1;const Tt=new Date(Q.created_date);return isNaN(Tt.getTime())||Tt<new Date(2024,3,1)?!1:M==="all"||Q.country===M}});let P,Y=!1,K=!1;Xe("%Y-%m"),Xe("%b %Y");const J=ft("viz.filter_by_country");vt(t,J,Q=>n(11,f=Q));const W=ft("viz.filter_by_type");vt(t,W,Q=>n(12,u=Q));const it=ft("viz.no_data");vt(t,it,Q=>n(14,h=Q));const lt=ft("viz.summary");vt(t,lt,Q=>n(15,m=Q));const F=ft("viz.total_items");vt(t,F,Q=>n(10,c=Q));const q=ft("viz.time_period");vt(t,q,Q=>n(16,g=Q));const tt=ft("viz.avg_monthly_additions");vt(t,tt,Q=>n(17,p=Q));const Z=ft("viz.peak_growth_months");vt(t,Z,Q=>n(18,v=Q));const dt=ft("viz.showing_items_over_months");vt(t,dt,Q=>n(13,d=Q));const pt=ft("viz.items");vt(t,pt,Q=>n(19,T=Q)),ft("viz.timeline_distribution_items");const Et=ft("viz.monthly_additions");vt(t,Et,Q=>n(53,s=Q));const st=ft("viz.month");vt(t,st,Q=>n(50,o=Q)),ft("viz.growth_since_april");const ot=ft("viz.new_items");vt(t,ot,Q=>n(52,l=Q));const rt=ft("viz.percentage");vt(t,rt,Q=>n(51,a=Q));function wt(Q){return Q.toLocaleString(_==="fr"?"fr-FR":"en-US")}function Pt(){if(N>0){const Q=wt(N);return at("viz.growth_since_april",{0:Q})}else return at("viz.growth_since_april_title")}function Mt(){console.log("[TimelineDistribution] Updating title with count:",N),n(9,X=Pt())}let Ft=null;function nt(){Ft&&clearTimeout(Ft),Ft=setTimeout(()=>{Dt(),Ft=null},250)}xe(()=>(n(40,Y=!0),console.log("[TimelineDistribution] Component mounted"),(async()=>{var Q;try{if(await Pe(),!E){console.error("[TimelineDistribution] Container element not found in onMount");return}console.log("[TimelineDistribution] Container element found:",E),n(39,V=En({container:E,onResize:()=>{if(Y&&K&&E){const{width:Vt,height:zt}=V.dimensions,Lt=Math.abs(A-Vt)>5,Ut=Math.abs(C-zt)>5;(Lt||Ut)&&(console.log("[TimelineDistribution] Size changed, updating visualization",{newWidth:Vt,newHeight:zt}),n(37,A=Vt),n(38,C=zt),nt())}}}));const{width:Tt,height:Kt}=V.dimensions;if(n(37,A=Tt),n(38,C=Kt||500),console.log("[TimelineDistribution] Initial dimensions:",{width:A,height:C}),P=ie.subscribe(Vt=>{Y&&(console.log("[TimelineDistribution] Language changed to:",Vt),_=Vt,Mt(),K&&E&&nt())}),!r.items||r.items.length===0){console.log("[TimelineDistribution] No items loaded, loading items");try{await ee.loadItems(),console.log("[TimelineDistribution] Items loaded:",(Q=r.items)==null?void 0:Q.length)}catch(Vt){console.error("[TimelineDistribution] Error loading items:",Vt)}}else console.log("[TimelineDistribution] Items already loaded:",r.items.length);Ct(),n(3,K=!0),await Pe(),E?(yt(),Dt(),console.log("[TimelineDistribution] Visualization initialized")):console.error("[TimelineDistribution] Container not available after initialization")}catch(Tt){console.error("[TimelineDistribution] Error during initialization:",Tt)}})(),()=>{try{console.log("[TimelineDistribution] Component unmounting, cleaning up"),n(40,Y=!1),n(3,K=!1),V&&V.cleanup(),P&&P(),Ft&&(clearTimeout(Ft),Ft=null),E&&mt(E).selectAll("*").remove()}catch(Q){console.error("[TimelineDistribution] Error during cleanup:",Q)}}));function yt(){try{console.log("[TimelineDistribution] Initializing timeline chart with dimensions:",{width:A,height:C}),console.log("[TimelineDistribution] Container element:",E),mt(E).selectAll("*").remove(),z=new ua({container:E,width:A,height:C,formatNumber:wt,currentLang:_,translations:{monthlyAdditions:s,totalItems:c,newItems:l,percentage:a,month:o}}),z.setTooltipCallbacks({showTooltip:B,hideTooltip:$}),console.log("[TimelineDistribution] Timeline chart initialized")}catch(Q){console.error("[TimelineDistribution] Error initializing timeline chart:",Q)}}function Dt(){try{if(!E||!Y||!K){console.error("[TimelineDistribution] Cannot update visualization - component not ready",{container:!!E,isMounted:Y,isInitialized:K});return}console.log("[TimelineDistribution] Updating visualization with dimensions:",{width:A,height:C}),C<=0&&(n(38,C=500),console.log("[TimelineDistribution] Using fallback height of 500px"));const Q=gt();if(!Q||Q.length===0){console.warn("[TimelineDistribution] No timeline data available with current filters"),mt(E).selectAll("*").remove(),mt(E).append("div").attr("class","absolute inset-center text-secondary").text("No timeline data available with the current filters");return}n(5,k=Q),console.log("[TimelineDistribution] Timeline data updated with",k.length,"data points"),mt(E).selectAll("*").remove(),z=new ua({container:E,width:A,height:C,formatNumber:wt,currentLang:_,translations:{monthlyAdditions:s,totalItems:c,newItems:l,percentage:a,month:o}}),z.setTooltipCallbacks({showTooltip:B,hideTooltip:$}),z.render(Q),console.log("[TimelineDistribution] Chart rendered with",Q.length,"data points")}catch(Q){if(console.error("[TimelineDistribution] Error updating visualization:",Q),E)try{mt(E).selectAll("*").remove(),mt(E).append("div").attr("class","absolute inset-center text-error").text("Error rendering timeline visualization")}catch(Tt){console.error("[TimelineDistribution] Error showing error message:",Tt)}}}function At(Q){const Tt=Q.target;n(0,M=Tt.value),Ct(),nt()}function et(Q){const Tt=Q.target;n(1,x=Tt.value),Ct(),nt()}function gt(){var Q;if(!r.items||r.items.length===0)return console.warn("[TimelineDistribution] No items available for timeline data"),[];console.log("[TimelineDistribution] Processing data with filters:",{country:M,type:x}),console.log("[TimelineDistribution] Total items before filtering:",r.items.length);try{const Tt=new Date(2024,3,1),Kt=8e3;r.items.length>0&&console.log("[TimelineDistribution] Sample created_date values:",r.items.slice(0,5).map(Lt=>Lt.created_date));const Vt=D(r.items);console.log("[TimelineDistribution] Items after filtering:",Vt.length);const zt=L(Vt,"created_date",{startDate:Tt,includeCumulative:!0,initialTotal:Kt});return console.log("[TimelineDistribution] Processed timeline data length:",zt.length),zt.length>0&&console.log("[TimelineDistribution] First and last data points:",zt[0],zt[zt.length-1]),zt.length===0?(console.warn("[TimelineDistribution] No timeline data generated after processing"),[]):(n(8,N=((Q=zt[zt.length-1])==null?void 0:Q.total)||Kt),H=Math.max(...zt.map(Lt=>Lt.count)),U=Math.max(...zt.map(Lt=>Lt.total)),zt)}catch(Tt){return console.error("[TimelineDistribution] Error processing timeline data:",Tt),[]}}function Ct(){if(!r.items||r.items.length===0)return;console.log("[TimelineDistribution] Generating facet options with filters:",{country:M,type:x});const Q=O.filterItems(r.items),Tt=I.filterItems(r.items);console.log("[TimelineDistribution] Items for country facets:",Q.length),console.log("[TimelineDistribution] Items for type facets:",Tt.length);const Kt=O.groupAndCount(Q,zt=>zt.country||"Unknown",Q.length);n(6,w=[{value:"all",label:at("country.all"),count:Q.length},...Kt.filter(zt=>zt.key!=="Unknown").map(zt=>({value:zt.key,label:at(`country.${zt.key}`),count:zt.count})).sort((zt,Lt)=>Lt.count-zt.count)]);const Vt=I.groupAndCount(Tt,zt=>zt.type||"Unknown",Tt.length);n(7,S=[{value:"all",label:at("type.all"),count:Tt.length},...Vt.filter(zt=>zt.key!=="Unknown"&&zt.count>0).map(zt=>({value:zt.key,label:at(`type.${zt.key}`),count:zt.count})).sort((zt,Lt)=>Lt.count-zt.count)]),console.log("[TimelineDistribution] Updated facet options:",{countryOptions:w.length,typeOptions:S.length})}function _t(Q){le[Q?"unshift":"push"](()=>{E=Q,n(2,E)})}return t.$$.update=()=>{t.$$.dirty[0]&19&&r.items&&r.items.length>0&&(console.log("[TimelineDistribution] Items loaded, updating title"),n(8,N=r.items.filter(Q=>!(M!=="all"&&Q.country!==M||x!=="all"&&Q.type!==x)).length),Mt()),t.$$.dirty[1]&1024&&Mt(),t.$$.dirty[0]&28|t.$$.dirty[1]&960&&Y&&K&&r.items&&E&&V&&(A!==V.dimensions.width||C!==V.dimensions.height)&&(n(37,A=V.dimensions.width),n(38,C=V.dimensions.height),Dt()),t.$$.dirty[0]&16|t.$$.dirty[1]&1536&&Y&&i&&r.items&&r.items.length>0&&Ct(),t.$$.dirty[0]&11&&K&&(M||x)&&nt()},[M,x,E,K,r,k,w,S,N,X,c,f,u,d,h,m,g,p,v,T,J,W,it,lt,F,q,tt,Z,dt,pt,Et,st,ot,rt,wt,At,et,A,C,V,Y,i,_t]}class Lp extends pe{constructor(e){super(),ge(this,e,Dp,Ap,ce,{},null,[-1,-1,-1])}}const Ip=!1,wn=[],Ep=1e3;function Np(){return new Date().toISOString()}function Bt(t,e,n){const i={timestamp:Np(),component:t,action:e,details:n};wn.push(i),wn.length>Ep&&wn.shift()}const Fp=new Set,$p={};function Rp(){console.group("IWAC Debug Logs"),wn.forEach(t=>{console.groupCollapsed(`${t.timestamp} - ${t.component} - ${t.action}`),console.log("Component:",t.component),console.log("Action:",t.action),t.details&&console.log("Details:",t.details),console.groupEnd()}),console.groupEnd()}function Pp(){return JSON.stringify(wn,null,2)}typeof window<"u"&&(window.__IWAC_DEBUG={logs:wn,dumpLogs:Rp,exportLogs:Pp,mountedComponents:()=>Array.from(Fp),hierarchy:$p});function _a(t,e,n){const r=t.slice();return r[55]=e[n],r}function ba(t){let e,n;return{c(){e=Xt("svg"),n=Xt("path"),y(n,"fill","currentColor"),y(n,"d","M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"),y(e,"viewBox","0 0 24 24"),y(e,"width","14"),y(e,"height","14")},m(r,i){ut(r,e,i),b(e,n)},d(r){r&&ct(e)}}}function wa(t){let e,n,r,i,o=t[55].label+"",a,l,c,s=t[55].count+"",f,u,d,h,m,g=t[55].selected&&ba();function p(){return t[16](t[55])}function v(...T){return t[17](t[55],...T)}return{c(){e=R("div"),n=R("span"),g&&g.c(),r=bt(),i=R("span"),a=j(o),l=bt(),c=R("span"),f=j(s),u=bt(),y(n,"class","facet-checkbox svelte-1uu7ity"),y(i,"class","facet-label svelte-1uu7ity"),y(c,"class","facet-count svelte-1uu7ity"),y(e,"class","facet-option svelte-1uu7ity"),y(e,"role","checkbox"),y(e,"aria-checked",d=t[55].selected),y(e,"tabindex","0"),Ki(e,"selected",t[55].selected)},m(T,M){ut(T,e,M),b(e,n),g&&g.m(n,null),b(e,r),b(e,i),b(i,a),b(e,l),b(e,c),b(c,f),b(e,u),h||(m=[Zt(e,"click",p),Zt(e,"keydown",v)],h=!0)},p(T,M){t=T,t[55].selected?g||(g=ba(),g.c(),g.m(n,null)):g&&(g.d(1),g=null),M[0]&2&&o!==(o=t[55].label+"")&&ht(a,o),M[0]&2&&s!==(s=t[55].count+"")&&ht(f,s),M[0]&2&&d!==(d=t[55].selected)&&y(e,"aria-checked",d),M[0]&2&&Ki(e,"selected",t[55].selected)},d(T){T&&ct(e),g&&g.d(),h=!1,me(m)}}}function Hp(t){let e,n=t[5].error+"",r;return{c(){e=R("div"),r=j(n),y(e,"class","absolute inset-center text-error z-50")},m(i,o){ut(i,e,o),b(e,r)},p(i,o){o[0]&32&&n!==(n=i[5].error+"")&&ht(r,n)},d(i){i&&ct(e)}}}function Up(t){let e;return{c(){e=R("div"),e.textContent=`${at("ui.loading")}`,y(e,"class","absolute inset-center text-secondary z-50")},m(n,r){ut(n,e,r)},p:xt,d(n){n&&ct(e)}}}function Bp(t){let e,n,r,i,o,a,l,c,s,f,u,d,h,m,g,p,v=t[3][0]+"",T,M,x,k=t[3][1]+"",w,S,N,H,U,_,X,A,C,E,z,B,$,V,D,G,L=t[1],O=[];for(let K=0;K<L.length;K+=1)O[K]=wa(_a(t,L,K));function I(K,J){if(K[5].loading)return Up;if(K[5].error)return Hp}let P=I(t),Y=P&&P(t);return{c(){e=R("div"),n=R("div"),r=R("div"),i=R("div"),o=R("h3"),a=j(t[6]),l=bt(),c=R("div");for(let K=0;K<O.length;K+=1)O[K].c();s=bt(),f=R("div"),u=R("h3"),d=j(t[7]),h=bt(),m=R("div"),g=R("div"),p=R("span"),T=j(v),M=bt(),x=R("span"),w=j(k),S=bt(),N=R("div"),H=R("input"),A=bt(),C=R("input"),$=bt(),V=R("div"),Y&&Y.c(),y(o,"class","svelte-1uu7ity"),y(c,"class","facet-options table-layout svelte-1uu7ity"),y(i,"class","facet-group svelte-1uu7ity"),y(r,"class","facets svelte-1uu7ity"),y(u,"class","svelte-1uu7ity"),y(g,"class","slider-labels svelte-1uu7ity"),y(H,"type","range"),y(H,"min",U=t[2][0]),y(H,"max",_=t[2][t[2].length-1]),H.value=X=t[3][0],y(H,"data-index","0"),y(H,"class","svelte-1uu7ity"),y(C,"type","range"),y(C,"min",E=t[2][0]),y(C,"max",z=t[2][t[2].length-1]),C.value=B=t[3][1],y(C,"data-index","1"),y(C,"class","svelte-1uu7ity"),y(N,"class","slider-inputs svelte-1uu7ity"),y(m,"class","slider-container svelte-1uu7ity"),y(f,"class","year-range svelte-1uu7ity"),y(n,"class","controls-container svelte-1uu7ity"),y(V,"class","chart-container svelte-1uu7ity"),y(e,"class","type-distribution-container svelte-1uu7ity")},m(K,J){ut(K,e,J),b(e,n),b(n,r),b(r,i),b(i,o),b(o,a),b(i,l),b(i,c);for(let W=0;W<O.length;W+=1)O[W]&&O[W].m(c,null);b(n,s),b(n,f),b(f,u),b(u,d),b(f,h),b(f,m),b(m,g),b(g,p),b(p,T),b(g,M),b(g,x),b(x,w),b(m,S),b(m,N),b(N,H),b(N,A),b(N,C),b(e,$),b(e,V),Y&&Y.m(V,null),t[18](V),D||(G=[Zt(H,"input",t[15]),Zt(C,"input",t[15])],D=!0)},p(K,J){if(J[0]&64&&ht(a,K[6]),J[0]&16386){L=K[1];let W;for(W=0;W<L.length;W+=1){const it=_a(K,L,W);O[W]?O[W].p(it,J):(O[W]=wa(it),O[W].c(),O[W].m(c,null))}for(;W<O.length;W+=1)O[W].d(1);O.length=L.length}J[0]&128&&ht(d,K[7]),J[0]&8&&v!==(v=K[3][0]+"")&&ht(T,v),J[0]&8&&k!==(k=K[3][1]+"")&&ht(w,k),J[0]&4&&U!==(U=K[2][0])&&y(H,"min",U),J[0]&4&&_!==(_=K[2][K[2].length-1])&&y(H,"max",_),J[0]&8&&X!==(X=K[3][0])&&(H.value=X),J[0]&4&&E!==(E=K[2][0])&&y(C,"min",E),J[0]&4&&z!==(z=K[2][K[2].length-1])&&y(C,"max",z),J[0]&8&&B!==(B=K[3][1])&&(C.value=B),P===(P=I(K))&&Y?Y.p(K,J):(Y&&Y.d(1),Y=P&&P(K),Y&&(Y.c(),Y.m(V,null)))},d(K){K&&ct(e),xn(O,K),Y&&Y.d(),t[18](null),D=!1,me(G)}}}function Vp(t){let e,n;return e=new In({props:{title:"",translationKey:"",description:"This visualization shows the distribution of items by type over time. You can filter by country and year range to explore how different types of items have been published over time.",descriptionTranslationKey:"viz.type_distribution_description",titleHtml:t[4],className:"word-visualization-compact-header",$$slots:{default:[Bp]},$$scope:{ctx:t}}}),{c(){te(e.$$.fragment)},m(r,i){Jt(e,r,i),n=!0},p(r,i){const o={};i[0]&16&&(o.titleHtml=r[4]),i[0]&239|i[1]&134217728&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){n||($t(e.$$.fragment,r),n=!0)},o(r){Ht(e.$$.fragment,r),n=!1},d(r){Qt(e,r)}}}const Wp="TypeDistribution";function cr(t){return t?/^\d{4}$/.test(t)?parseInt(t):/^\d{4}-\d{2}$/.test(t)||/^\d{4}-\d{2}-\d{2}$/.test(t)?parseInt(t.substring(0,4)):null:null}function Op(t,e,n){let r,i,o,a,l,c,s;vt(t,ee,q=>n(5,r=q));let f=!1,u,d,h="en",m,g,p=0,v=0,T=[],M=[],x=[0,0],k=[],w=0,S=[];const{showTooltip:N,hideTooltip:H}=qr({defaultWidth:250,defaultHeight:150});let U;const{filterItems:_,groupAndCount:X,groupHierarchically:A}=ve({filterMissingValues:!0,requiredFields:["publication_date","type"],calculatePercentages:!0,sortByCount:!0,sortDescending:!0}),C=ft("viz.no_data");vt(t,C,q=>n(33,l=q)),ft("viz.filter_by_country"),ft("viz.all_countries"),ft("viz.publication_year");const E=ft("viz.year");vt(t,E,q=>n(32,a=q));const z=ft("viz.number_of_items");vt(t,z,q=>n(31,o=q));const B=ft("viz.toggle_types");vt(t,B,q=>n(30,i=q)),ft("viz.toggled_type");const $=ft("viz.countries");vt(t,$,q=>n(6,c=q));const V=ft("viz.time_period");vt(t,V,q=>n(7,s=q)),ft("viz.summary"),ft("viz.showing_items_over_months"),ft("viz.types"),ft("viz.published_between");let D="";function G(q){return q.toLocaleString(h==="fr"?"fr-FR":"en-US")}function L(){if(w>0){const q=w.toLocaleString();n(4,D=at("viz.type_distribution_items",{0:q}))}else n(4,D=at("viz.type_distribution_title"));console.log("Type Distribution Title updated:",D)}function O(){var ot;if(!f||!r.items||r.items.length===0)return[];const q=T.filter(rt=>rt.selected).map(rt=>rt.value),tt=q.includes("all"),Z=rt=>{if(rt.type==="Notice d'autorité")return!1;const wt=cr(rt.publication_date);return!(!wt||wt<x[0]||wt>x[1]||!rt.country||rt.country.trim()===""||rt.country==="Unknown"||!tt&&!q.includes(rt.country))},{filterItems:dt}=ve({filterMissingValues:!0,requiredFields:["publication_date","type"],filterFn:Z}),pt=dt(r.items);w=pt.length,L();const Et=A(pt,[rt=>{var wt;return((wt=cr(rt.publication_date))==null?void 0:wt.toString())||"Unknown"},rt=>rt.type||"Unknown"]),st=[];return(ot=Et.children)==null||ot.forEach(rt=>{var Pt;const wt=parseInt(rt.name);(Pt=rt.children)==null||Pt.forEach(Mt=>{st.push({year:wt,type:Mt.name,count:Mt.value})})}),st}function I(){var st;if(!f||!r.items||r.items.length===0)return;const q=ot=>{if(ot.type==="Notice d'autorité")return!1;const rt=cr(ot.publication_date);return rt!==null&&rt>=x[0]&&rt<=x[1]},{filterItems:tt,groupAndCount:Z}=ve({filterMissingValues:!0,requiredFields:["publication_date"],filterFn:q}),dt=tt(r.items),pt=Z(dt,ot=>ot.country||"Unknown"),Et=dt.filter(ot=>ot.country&&ot.country.trim()!==""&&ot.country!=="Unknown").length;n(1,T=[{value:"all",label:at("country.all"),count:Et,selected:((st=T.find(ot=>ot.value==="all"))==null?void 0:st.selected)??!0},...pt.filter(ot=>ot.key!=="Unknown").map(ot=>{var rt;return{value:ot.key,label:at(`country.${ot.key}`)||ot.key,count:ot.count,selected:((rt=T.find(wt=>wt.value===ot.key))==null?void 0:rt.selected)??!1}})]),T.sort((ot,rt)=>ot.value==="all"?-1:rt.value==="all"?1:ot.label.localeCompare(rt.label))}function P(){if(!f||!r.items||r.items.length===0)return;const q=r.items.filter(dt=>dt.type!=="Notice d'autorité").map(dt=>cr(dt.publication_date)).filter(dt=>dt!==null);if(q.length===0)return;const tt=Math.min(...q),Z=Math.max(...q);n(2,M=Array.from({length:Z-tt+1},(dt,pt)=>tt+pt)),(x[0]===0||x[1]===0)&&n(3,x=[tt,Z])}function Y(q){f&&(q.value==="all"?T.forEach(tt=>{tt.selected=tt.value==="all"}):(T.find(tt=>tt.value==="all").selected=!1,q.selected=!q.selected,T.some(tt=>tt.selected)||(T.find(tt=>tt.value==="all").selected=!0)),n(1,T=[...T]),J())}function K(q){const tt=q.target,Z=parseInt(tt.dataset.index||"0"),dt=parseInt(tt.value);Z===0?n(3,x=[dt,Math.max(dt,x[1])]):n(3,x=[Math.min(dt,x[0]),dt]),I(),J()}function J(){if(!f||!g||!document.body.contains(g)){console.error("Cannot update visualization - component not mounted or container not found");return}try{if(k=O(),mt(g).select("svg").remove(),mt(g).selectAll(".absolute.inset-center").remove(),m&&(m.cleanup(),m=null),k.length===0){mt(g).append("div").attr("class","absolute inset-center text-secondary z-50").text(l);return}if(!f||!document.body.contains(g))return;const q=g.getBoundingClientRect();if(p=q.width,v=Math.max(400,q.height-100),!f||!document.body.contains(g))return;const tt=Array.from(new Set(k.map(et=>et.type))),Z={top:20,right:30,bottom:70,left:60},dt=p-Z.left-Z.right;if(tt.sort((et,gt)=>{const Ct=at(`type.${et}`)!==`type.${et}`?at(`type.${et}`):et,_t=at(`type.${gt}`)!==`type.${gt}`?at(`type.${gt}`):gt;return Ct.localeCompare(_t)}),!f||!document.body.contains(g))return;if(S.length===0)S=tt.map(et=>({type:et,visible:!0}));else{const et=S.map(gt=>gt.type);tt.forEach(gt=>{et.includes(gt)||S.push({type:gt,visible:!0})})}const pt=tt.filter(et=>{var gt;return((gt=S.find(Ct=>Ct.type===et))==null?void 0:gt.visible)??!0}),Et=v-Z.top-Z.bottom;if(!f||!document.body.contains(g))return;if(pt.length===0){mt(g).selectAll(".absolute.inset-center").remove(),mt(g).append("div").attr("class","absolute inset-center text-secondary z-50").text(l);return}const st=mt(g).append("svg").attr("width",p).attr("height",v),ot=st.append("g").attr("transform",`translate(${Z.left}, ${Z.top})`),rt=Array.from(zi(k.filter(et=>{var gt;return((gt=S.find(Ct=>Ct.type===et.type))==null?void 0:gt.visible)??!0}),et=>et.year),([et,gt])=>{const Ct={year:et};return gt.forEach(_t=>{Ct[_t.type]=_t.count}),Ct}).sort((et,gt)=>et.year-gt.year);if(rt.length===0){mt(g).selectAll(".absolute.inset-center").remove(),mt(g).append("div").attr("class","absolute inset-center text-secondary z-50").text(l);return}const wt=$i().domain(rt.map(et=>et.year.toString())).range([0,dt]).padding(.1),Pt=yg().keys(pt).value((et,gt)=>et[gt]||0)(rt),Mt=jn().domain([0,kn(Pt.length>0?Pt[Pt.length-1]:[],et=>et[1])||0]).range([Et,0]);if(!f||!document.body.contains(g))return;const Ft=["Press Article","Journal Article","Book Chapter","Doctoral Thesis","type.Article d'encyclopédie","type.Mémoire de maitrise","Book","type.Compte rendu de livre","type.Rapport","type.Working paper","type.Mémoire de licence","Islamic Periodical","Document","type.Photographie","Blog Post","Scientific Communication","type.Enregistrement vidéo","Article de presse","Article de revue","Chapitre de livre","Thèse de doctorat","Article d'encyclopédie","Mémoire de maitrise","Livre","Compte rendu de livre","Rapport","Working paper","Mémoire de licence","Périodique islamique","Document","Photographie","Article de blog","Communication scientifique","Enregistrement vidéo"],nt=se().domain(Ft).range(Ce);if(ot.append("g").attr("transform",`translate(0, ${Et})`).call(wr(wt).tickValues(rt.filter(et=>et.year%5===0).map(et=>et.year.toString())).tickSizeOuter(0)).selectAll("text").attr("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-45)").attr("class","text-xs text-primary"),!f||!document.body.contains(g)||(ot.append("g").call(xr(Mt).ticks(5)).selectAll("text").attr("class","text-xs text-primary"),ot.append("text").attr("text-anchor","middle").attr("x",dt/2).attr("y",Et+40).attr("fill","var(--color-text-secondary)").attr("class","text-sm text-secondary").text(a),ot.append("text").attr("text-anchor","middle").attr("transform","rotate(-90)").attr("x",-Et/2).attr("y",-Z.left+15).attr("fill","var(--color-text-secondary)").attr("class","text-sm text-secondary").text(o),!f||!document.body.contains(g))||(ot.selectAll(".type-bars").data(Pt).enter().append("g").attr("class","type-bars").attr("fill",et=>nt(et.key)).selectAll("rect").data(et=>et).enter().append("rect").attr("x",et=>wt(et.data.year.toString())||0).attr("y",et=>Mt(et[1])).attr("height",et=>Mt(et[0])-Mt(et[1])).attr("width",wt.bandwidth()).attr("stroke","white").attr("stroke-width",1).on("mouseenter",(et,gt)=>{if(f){const Ct=W(gt,Pt);N(et,Ct)}}).on("mousemove",(et,gt)=>{if(f){const Ct=W(gt,Pt);N(et,Ct)}}).on("mouseleave",()=>{f&&H()}),!f||!document.body.contains(g)))return;const yt=tt.map(et=>{const gt=k.filter(Ct=>Ct.type===et).reduce((Ct,_t)=>Ct+_t.count,0);return{type:et,count:gt}}).sort((et,gt)=>gt.count-et.count);m=Rl({container:g,title:i,items:yt.map(et=>{var gt;return{key:et.type,label:at(`type.${et.type}`)!==`type.${et.type}`?at(`type.${et.type}`):et.type,color:nt(et.type),value:et.count,visible:((gt=S.find(Ct=>Ct.type===et.type))==null?void 0:gt.visible)??!0,customProperties:{type:et.type}}}),type:"html",position:"bottom",orientation:"horizontal",className:"multi-row-legend",showValues:!0,valueFormatter:et=>G(et),translateKeys:{itemPrefix:"type."},responsive:!0,breakpoint:768,interactive:!0,onItemClick:et=>{if(!f)return;const gt=S.findIndex(Ct=>{var _t;return Ct.type===((_t=et.customProperties)==null?void 0:_t.type)});gt>=0&&(S[gt].visible=!S[gt].visible,S=[...S],J())}}),m.render();const At=Math.ceil(yt.length/5)*22+30;st.attr("height",v+At+30)}catch(q){console.error("Error updating visualization:",q)}}function W(q,tt){const Z=q.data.year,dt=tt.map(st=>{const ot=st.find(rt=>rt.data.year===Z);return{type:st.key,count:ot?ot[1]-ot[0]:0}}).filter(st=>st.count>0),pt=dt.reduce((st,ot)=>st+ot.count,0),Et=[{label:at("viz.type"),value:at("viz.count")+" / %"}];return dt.forEach(st=>{const ot=`type.${st.type}`;let rt=st.type;const wt=at(ot);wt!==ot&&(rt=wt),Et.push({label:rt,value:`${G(st.count)} (${(st.count/pt*100).toFixed(1)}%)`})}),Et.push({label:at("viz.total_items"),value:G(pt)}),Re(`${at("viz.year")}: ${Z}`,Et)}xe(()=>(f=!0,(async()=>{try{if(await Pe(),!g){console.error("Container element not found in onMount");return}U=En({container:g,onResize:()=>{if(f&&g){const{width:q,height:tt}=U.dimensions;p=q,v=tt,J()}}}),d=ie.subscribe(q=>{f&&(h=q,g&&(L(),console.log("Language changed to",q,"- updating legend with",i),r.items&&r.items.length>0&&(m&&(m.cleanup(),m=null),I(),J())))}),u=ee.subscribe(q=>{f&&q!=null&&q.items&&q.items.length>0&&(P(),I(),L(),g&&J())}),r.items&&r.items.length>0?(P(),I(),L(),J()):ee.loadItems()}catch(q){console.error("Error during initialization:",q)}})(),()=>{f=!1,U&&U.cleanup(),u&&(u(),u=null),d&&(d(),d=null),m&&(m.cleanup(),m=null),g&&mt(g).selectAll("*").remove()})),Ve(()=>{f=!1,u&&(u(),u=null),d&&(d(),d=null),m&&(m.cleanup(),m=null),Bt(Wp,"Component destroyed")});const it=q=>Y(q),lt=(q,tt)=>tt.key==="Enter"&&Y(q);function F(q){le[q?"unshift":"push"](()=>{g=q,n(0,g)})}return[g,T,M,x,D,r,c,s,C,E,z,B,$,V,Y,K,it,lt,F]}class Yp extends pe{constructor(e){super(),ge(this,e,Op,Vp,ce,{},null,[-1,-1])}}class qp{static createTreemap(e,n){try{const{container:r,width:i=r.clientWidth,height:o=Math.min(r.clientHeight,500),margin:a={top:10,right:10,bottom:10,left:10},padding:l={outer:3,top:16,inner:1},tooltipCallback:c,hideTooltipCallback:s,zoomCallback:f,currentZoomedNode:u=null,minSizeThreshold:d=.001,useBreadcrumbs:h=!1,rootName:m="All",labelOptions:g={parentLabel:{fontSize:"var(--font-size-sm)",fontWeight:"bold",color:"white"},childLabel:{fontSize:"var(--font-size-xs)",color:"var(--color-text-primary)",minWidth:30,minHeight:20}}}=n;if(mt(r).select("svg").remove(),mt(r).select(".absolute").remove(),!e.children||e.children.length===0)return Gt.handleNoData(r),{svg:null,chart:null};r.style.height=`${o}px`,r.style.maxHeight=`${o}px`,r.style.overflow="hidden";const p={...a};u&&h&&(p.top+=30);const{svg:v,chart:T,chartWidth:M,chartHeight:x}=Gt.createSVG({container:r,width:i,height:o,margin:p,responsive:!1});v.attr("height",o).attr("viewBox",`0 0 ${i} ${o}`).style("height",`${o}px`).style("max-height",`${o}px`).style("overflow","hidden").on("mouseout",H=>{var U;H.relatedTarget&&!((U=v.node())!=null&&U.contains(H.relatedTarget))&&s&&s()}),u&&(h?this.addBreadcrumbNavigation(v,a,u,m,f):this.addZoomOutButton(v,a,f));const k=wl().size([M,x]).paddingOuter(l.outer||3).paddingTop(l.top||16).paddingInner(l.inner||1).round(!0);let w;if(u)w=this.prepareZoomedHierarchy(u);else if(w=De(e).sum(H=>H.value||0).sort((H,U)=>(U.value||0)-(H.value||0)),w.children&&d>0){const U=(w.value||0)*d;w.children=w.children.filter(_=>(_.value||0)>U)}try{k(w)}catch(H){return console.error("Error applying treemap layout:",H),Gt.handleNoData(r,"Error rendering treemap"),{svg:null,chart:null}}const S=this.createColorScale(w,n);let N;return u&&n.colorMap&&(N=n.colorMap.get(u.data.name)),u?this.renderLeafNodes(T,w.children||[],S,c,g,N,s):(this.renderParentNodes(T,w.children||[],S,f,g),this.renderLeafNodes(T,w.leaves(),S,c,g,void 0,s)),{svg:v,chart:T}}catch(r){return console.error("Error creating treemap:",r),Gt.handleNoData(n.container,"Error creating treemap"),{svg:null,chart:null}}}static prepareZoomedHierarchy(e){if(e.data.children&&e.data.children.length>0){const n={name:e.data.name,children:e.data.children};return De(n).sum(r=>r.value||0).sort((r,i)=>(i.value||0)-(r.value||0))}else if(e.children&&e.children.length>0){const n=e.children.map(i=>({name:i.data.name,value:i.data.value||i.value,wordCount:i.data.wordCount,itemCount:i.data.itemCount})),r={name:e.data.name,children:n};return De(r).sum(i=>i.value||0).sort((i,o)=>(o.value||0)-(i.value||0))}else return console.warn("Zoomed node has no valid children data"),De({name:"Empty",children:[]}).sum(n=>n.value||0)}static createColorScale(e,n){if(n.colors)return n.colors;const r=se().domain(e.children?e.children.map(i=>i.data.name):[e.data.name]).range(Ce);return n.colorMap&&e.children&&e.children.forEach(i=>{n.colorMap&&!n.colorMap.has(i.data.name)&&n.colorMap.set(i.data.name,r(i.data.name))}),r}static addZoomOutButton(e,n,r){if(!r)return;const i=e.append("g").attr("class","zoom-out-button cursor-pointer").attr("transform",`translate(${n.left}, ${n.top})`).on("click",()=>r(null));i.append("rect").attr("width",100).attr("height",24).attr("rx",4).attr("fill","var(--primary-color)").attr("opacity",.8),i.append("text").attr("x",50).attr("y",16).attr("text-anchor","middle").attr("fill","white").attr("font-size","var(--font-size-sm)").text("Back to All")}static addBreadcrumbNavigation(e,n,r,i,o){var u,d;if(!o)return;const a=30,l=((u=e.node())==null?void 0:u.getBoundingClientRect().width)||300;e.append("rect").attr("x",0).attr("y",0).attr("width",l).attr("height",a).attr("fill","white").attr("opacity",.9);const c=e.append("g").attr("class","breadcrumb-navigation").attr("transform",`translate(${n.left+10}, ${n.top+10})`),f=((d=c.append("text").attr("x",0).attr("y",5).attr("font-size","var(--font-size-sm)").attr("fill","var(--primary-color)").attr("class","cursor-pointer").text(i).on("click",()=>o(null)).node())==null?void 0:d.getComputedTextLength())||20;c.append("line").attr("x1",0).attr("y1",22).attr("x2",f).attr("y2",22).attr("stroke","var(--primary-color)").attr("stroke-width",1),c.append("text").attr("x",f+8).attr("y",5).attr("font-size","var(--font-size-sm)").attr("fill","var(--color-text-secondary)").text("/"),c.append("text").attr("x",f+20).attr("y",5).attr("font-size","var(--font-size-sm)").attr("font-weight","bold").attr("fill","var(--color-text-primary)").text(r.data.name)}static renderParentNodes(e,n,r,i,o){var l,c,s;const a=e.selectAll(".parent-node").data(n).enter().append("g").attr("class","parent-node").attr("transform",f=>{const u=f.x0||0,d=f.y0||0;return`translate(${u},${d})`});a.append("rect").attr("width",f=>{const u=f.x0||0,d=f.x1||0;return Math.max(0,d-u)}).attr("height",f=>{const u=f.y0||0,d=f.y1||0;return Math.max(0,d-u)}).attr("fill",f=>r(f.data.name)).attr("stroke","white").attr("stroke-width",2).attr("opacity",.7).attr("class","cursor-pointer").on("click",(f,u)=>{i&&i(u)}),a.append("text").attr("x",5).attr("y",15).attr("font-size",((l=o==null?void 0:o.parentLabel)==null?void 0:l.fontSize)||"var(--font-size-sm)").attr("font-weight",((c=o==null?void 0:o.parentLabel)==null?void 0:c.fontWeight)||"bold").attr("fill",((s=o==null?void 0:o.parentLabel)==null?void 0:s.color)||"white").text(f=>{var d;return f.x1-f.x0-10<150?f.data.name:`${f.data.name} (${((d=f.data.wordCount)==null?void 0:d.toLocaleString())||0})`}).attr("pointer-events","none").each(function(f){var m;const u=mt(this),d=this.getComputedTextLength(),h=f.x1-f.x0-10;if(d>h){let g=f.data.name;u.text(g);let p=this.getComputedTextLength(),v=!1;for(;p>h&&g.length>3;)g=g.slice(0,-1),u.text(g),p=this.getComputedTextLength(),v=!0;v&&u.text(g+"..."),u.append("title").text(`${f.data.name} (${((m=f.data.wordCount)==null?void 0:m.toLocaleString())||0})`)}})}static renderLeafNodes(e,n,r,i,o,a,l){var s,f;const c=e.selectAll(".leaf-node").data(n).enter().append("g").attr("class","leaf-node").attr("transform",u=>{const d=u.x0||0,h=u.y0||0;return`translate(${d},${h})`});c.append("rect").attr("width",u=>{const d=u.x0||0,h=u.x1||0;return Math.max(0,h-d)}).attr("height",u=>{const d=u.y0||0,h=u.y1||0;return Math.max(0,h-d)}).attr("fill",u=>a||(u.parent?r(u.parent.data.name):r(u.data.name))).attr("stroke","white").attr("stroke-width",.5).attr("class","cursor-pointer").on("mouseover",function(u,d){mt(this).attr("stroke","var(--primary-color)").attr("stroke-width",2),i&&i(u,d)}).on("mousemove",function(u,d){i&&i(u,d)}).on("mouseout",function(){mt(this).attr("stroke","white").attr("stroke-width",.5),l&&l()}),c.append("text").attr("x",3).attr("y",13).attr("font-size",((s=o==null?void 0:o.childLabel)==null?void 0:s.fontSize)||"var(--font-size-xs)").attr("fill",((f=o==null?void 0:o.childLabel)==null?void 0:f.color)||"var(--color-text-primary)").attr("pointer-events","none").each(function(u){var S,N,H,U;const d=mt(this),h=u.x1-u.x0,m=u.y1-u.y0,g=((S=o==null?void 0:o.childLabel)==null?void 0:S.minWidth)||30,p=((N=o==null?void 0:o.childLabel)==null?void 0:N.minHeight)||20;if(h<g||m<p)return;let v=u.data.name;const T=h-6,M=u.parent?u.parent.data.name:"";d.text(v).append("title").text(`${M} > ${u.data.name}: ${((H=u.data.wordCount)==null?void 0:H.toLocaleString())||0} (${u.data.itemCount||0} items)`);const x=this;let k=x.getComputedTextLength(),w=!1;for(;k>T&&v.length>3;)v=v.slice(0,-1),d.text(v),k=x.getComputedTextLength(),w=!0;w&&(d.text(v+"..."),d.append("title").text(`${M} > ${u.data.name}: ${((U=u.data.wordCount)==null?void 0:U.toLocaleString())||0} (${u.data.itemCount||0} items)`))})}}function Kp(t){let e,n=t[5].error+"",r;return{c(){e=R("div"),r=j(n),y(e,"class","absolute inset-center text-error")},m(i,o){ut(i,e,o),b(e,r)},p(i,o){o[0]&32&&n!==(n=i[5].error+"")&&ht(r,n)},d(i){i&&ct(e)}}}function Xp(t){let e;return{c(){e=R("div"),e.textContent=`${at("ui.loading")}`,y(e,"class","absolute inset-center text-secondary")},m(n,r){ut(n,e,r)},p:xt,d(n){n&&ct(e)}}}function xa(t){let e,n,r,i,o=t[25](Math.round(t[1]/t[2]))+"",a;return{c(){e=R("p"),n=j(t[6]),r=j(": "),i=R("strong"),a=j(o),y(i,"class","font-medium"),y(e,"class","my-xs text-sm text-secondary")},m(l,c){ut(l,e,c),b(e,n),b(e,r),b(e,i),b(i,a)},p(l,c){c[0]&64&&ht(n,l[6]),c[0]&6&&o!==(o=l[25](Math.round(l[1]/l[2]))+"")&&ht(a,o)},d(l){l&&ct(e)}}}function Gp(t){let e,n;return{c(){e=R("p"),n=j(t[12]),y(e,"class","my-xs text-sm text-secondary")},m(r,i){ut(r,e,i),b(e,n)},p(r,i){i[0]&4096&&ht(n,r[12])},d(r){r&&ct(e)}}}function Zp(t){let e,n,r,i,o=t[3].data.name+"",a,l,c,s;return{c(){e=R("p"),n=j(t[10]),r=j(": "),i=R("strong"),a=j(o),l=bt(),c=R("p"),s=j(t[11]),y(i,"class","font-medium"),y(e,"class","my-xs text-sm text-secondary"),y(c,"class","my-xs text-sm text-secondary")},m(f,u){ut(f,e,u),b(e,n),b(e,r),b(e,i),b(i,a),ut(f,l,u),ut(f,c,u),b(c,s)},p(f,u){u[0]&1024&&ht(n,f[10]),u[0]&8&&o!==(o=f[3].data.name+"")&&ht(a,o),u[0]&2048&&ht(s,f[11])},d(f){f&&ct(e),f&&ct(l),f&&ct(c)}}}function Jp(t){let e,n,r,i,o,a,l,c,s,f,u,d=t[25](t[2])+"",h,m,g,p,v,T,M=t[25](t[1])+"",x,k,w;function S(C,E){if(C[5].loading)return Xp;if(C[5].error)return Kp}let N=S(t),H=N&&N(t),U=t[2]>0&&xa(t);function _(C,E){return C[3]?Zp:Gp}let X=_(t),A=X(t);return{c(){e=R("div"),H&&H.c(),n=bt(),r=R("div"),i=R("div"),o=R("h3"),a=j(t[7]),l=bt(),c=R("p"),s=j(t[8]),f=j(": "),u=R("strong"),h=j(d),m=bt(),g=R("p"),p=j(t[9]),v=j(": "),T=R("strong"),x=j(M),k=bt(),U&&U.c(),w=bt(),A.c(),y(e,"class","flex-1 min-h-500 relative bg-card rounded shadow"),hn(e,"height","500px"),hn(e,"max-height","500px"),hn(e,"overflow","hidden"),hn(e,"position","relative"),y(o,"class","mt-0 mb-sm text-primary text-md font-medium border-b border-solid border-default pb-xs"),y(u,"class","font-medium"),y(c,"class","my-xs text-sm text-secondary"),y(T,"class","font-medium"),y(g,"class","my-xs text-sm text-secondary"),y(r,"class","p-md bg-card rounded shadow mt-md")},m(C,E){ut(C,e,E),H&&H.m(e,null),t[26](e),ut(C,n,E),ut(C,r,E),b(r,i),b(i,o),b(o,a),b(i,l),b(i,c),b(c,s),b(c,f),b(c,u),b(u,h),b(i,m),b(i,g),b(g,p),b(g,v),b(g,T),b(T,x),b(i,k),U&&U.m(i,null),b(i,w),A.m(i,null)},p(C,E){N===(N=S(C))&&H?H.p(C,E):(H&&H.d(1),H=N&&N(C),H&&(H.c(),H.m(e,null))),E[0]&128&&ht(a,C[7]),E[0]&256&&ht(s,C[8]),E[0]&4&&d!==(d=C[25](C[2])+"")&&ht(h,d),E[0]&512&&ht(p,C[9]),E[0]&2&&M!==(M=C[25](C[1])+"")&&ht(x,M),C[2]>0?U?U.p(C,E):(U=xa(C),U.c(),U.m(i,w)):U&&(U.d(1),U=null),X===(X=_(C))&&A?A.p(C,E):(A.d(1),A=X(C),A&&(A.c(),A.m(i,null)))},d(C){C&&ct(e),H&&H.d(),t[26](null),C&&ct(n),C&&ct(r),U&&U.d(),A.d()}}}function Qp(t){let e,n,r;return n=new In({props:{title:"",translationKey:"",description:"This visualization shows the distribution of words across items by country and collection. The size of each block represents the word count in that country or collection.",descriptionTranslationKey:"viz.word_distribution_description",titleHtml:t[4],className:"word-visualization-compact-header",$$slots:{default:[Jp]},$$scope:{ctx:t}}}),{c(){e=R("div"),te(n.$$.fragment),y(e,"class","w-full h-full flex flex-col gap-md")},m(i,o){ut(i,e,o),Jt(n,e,null),r=!0},p(i,o){const a={};o[0]&16&&(a.titleHtml=i[4]),o[0]&8175|o[1]&134217728&&(a.$$scope={dirty:o,ctx:i}),n.$set(a)},i(i){r||($t(n.$$.fragment,i),r=!0)},o(i){Ht(n.$$.fragment,i),r=!1},d(i){i&&ct(e),Qt(n)}}}const ae="WordDistributionRefactored";function jp(t,e,n){let r,i,o,a,l,c,s,f,u,d,h,m,g;vt(t,ee,st=>n(5,r=st));let p=!1,v,T,M=0,x=0,k=0,w=0,S={name:"root",children:[]},N=null,H="",U="en",_=new Map;const{showTooltip:X,hideTooltip:A}=qr({maxWidth:"250px"});let C;const E=ft("viz.no_data");vt(t,E,st=>n(34,i=st)),ft("viz.word_distribution");const z=ft("viz.total_words");vt(t,z,st=>n(9,d=st));const B=ft("viz.avg_words_per_item");vt(t,B,st=>n(6,l=st));const $=ft("viz.click_zoom_in");vt(t,$,st=>n(12,g=st)),ft("viz.click_zoom_out"),ft("viz.unknown"),ft("viz.no_set"),ft("viz.back_to_all");const V=ft("viz.currently_viewing");vt(t,V,st=>n(10,h=st));const D=ft("viz.click_back_to_return");vt(t,D,st=>n(11,m=st));const G=ft("viz.total_items_with_word_count");vt(t,G,st=>n(8,u=st));const L=ft("viz.summary");vt(t,L,st=>n(7,f=st));const O=ft("viz.words");vt(t,O,st=>n(38,s=st));const I=ft("viz.items");vt(t,I,st=>n(37,c=st));const P=ft("viz.percent_of_country");vt(t,P,st=>n(36,a=st));const Y=ft("viz.percent_of_total");vt(t,Y,st=>n(35,o=st)),ft("viz.item_set_summary");const{filterItems:K,groupAndCount:J,groupHierarchically:W}=ve({filterMissingValues:!0,requiredFields:["word_count","country"],calculatePercentages:!0,sortByCount:!0,sortDescending:!0});function it(st){return st.toLocaleString(U==="fr"?"fr-FR":"en-US")}function lt(){w>0?U==="en"?n(4,H=`Distribution of ${it(k)} ${s} by country and sub-collection`):n(4,H=`Répartition de ${it(k)} ${s} par pays et sous-collection`):n(4,H=at("viz.word_distribution"))}function F(){N&&(U==="en"?n(4,H=`${N.data.name}: ${it(N.data.wordCount||0)} ${s}`):n(4,H=`${N.data.name}: ${it(N.data.wordCount||0)} ${s}`))}function q(){if(!r.items||r.items.length===0)return{name:"root",children:[]};const st=Mt=>!(Mt.word_count===void 0||Mt.word_count===0||!Mt.country),{filterItems:ot}=ve({filterMissingValues:!0,requiredFields:["word_count","country"],filterFn:st}),rt=ot(r.items);n(2,w=rt.length),n(1,k=rt.reduce((Mt,Ft)=>Mt+(Ft.word_count||0),0)),lt();const wt=new Map;rt.forEach(Mt=>{const Ft=Mt.country||"Unknown",nt=Mt.item_set_title||"No Set",yt=Mt.word_count||0;wt.has(Ft)||wt.set(Ft,{words:0,items:0,sets:new Map});const Dt=wt.get(Ft);Dt.words+=yt,Dt.items+=1,Dt.sets.has(nt)||Dt.sets.set(nt,{words:0,items:0});const At=Dt.sets.get(nt);At.words+=yt,At.items+=1});const Pt={name:"Word Distribution",children:Array.from(wt.entries()).map(([Mt,Ft])=>({name:Mt,wordCount:Ft.words,itemCount:Ft.items,children:Array.from(Ft.sets.entries()).map(([nt,yt])=>({name:nt,value:yt.words,wordCount:yt.words,itemCount:yt.items}))}))};return Pt.children&&(Pt.children.sort((Mt,Ft)=>(Ft.wordCount||0)-(Mt.wordCount||0)),Pt.children.forEach(Mt=>{Mt.children&&Mt.children.sort((Ft,nt)=>(nt.wordCount||0)-(Ft.wordCount||0))})),Pt}function tt(st){if(n(3,N=st),N)n(2,w=N.data.itemCount||0),n(1,k=N.data.wordCount||0),F();else{if(r.items&&r.items.length>0){const ot=K(r.items).filter(rt=>rt.word_count!==void 0&&rt.word_count>0&&rt.country);n(2,w=ot.length),n(1,k=ot.reduce((rt,wt)=>rt+(wt.word_count||0),0))}lt()}dt()}function Z(st,ot){try{if(!st){Bt(ae,"Event object is undefined in handleShowTooltip");return}const rt=ot.parent?ot.parent.data.name:ot.data.name,wt=ot.parent?ot.data.name:"All",Pt=ot.data.wordCount||0,Mt=ot.data.itemCount||0,Ft=Mt>0?Math.round(Pt/Mt):0,nt=N?N.data.wordCount:ot.parent?ot.parent.data.wordCount:0,yt=nt&&nt>0?(Pt/nt*100).toFixed(1)+"%":"N/A",Dt=k>0?(Pt/k*100).toFixed(1)+"%":"N/A",At=Re(`${rt} > ${wt}`,[{label:s,value:Pt.toLocaleString()},{label:c,value:Mt},{label:l,value:Ft},{label:a,value:yt},{label:o,value:Dt}]);X(st,At,250,150),Bt(ae,"Tooltip shown",{country:rt,itemSet:wt})}catch(rt){console.error("Error showing tooltip:",rt),Bt(ae,"Error showing tooltip",rt)}}function dt(){try{if(!T){console.error("Container element not found");return}if(N||(S=q()),!S.children||S.children.length===0){mt(T).select("svg").remove(),mt(T).append("div").attr("class","absolute inset-center text-secondary").text(i);return}qp.createTreemap(S,{container:T,height:500,colorMap:_,tooltipCallback:Z,hideTooltipCallback:A,zoomCallback:tt,currentZoomedNode:N,useBreadcrumbs:!0,rootName:U==="en"?"All":"Tous",labelOptions:{parentLabel:{fontSize:"var(--font-size-sm)",fontWeight:"bold",color:"white"},childLabel:{fontSize:"var(--font-size-xs)",color:"var(--color-text-primary)",minWidth:30,minHeight:20}}})}catch(st){console.error("Error in updateVisualization:",st)}}function pt(st){!p||!T||(Bt(ae,"Items store changed",{itemCount:(st==null?void 0:st.length)||0}),document.body.contains(T)&&dt())}xe(()=>{try{p=!0,Bt(ae,"Component mounted");const ot=(async()=>{if(await Pe(),!T)return console.error("Container element not found in onMount"),()=>{};C=En({container:T,onResize:()=>{if(p&&T){const{width:wt}=C.dimensions;M=wt,x=500,dt()}},debounce:!0,debounceDelay:300}),M=T.clientWidth,x=Math.min(T.clientHeight,500);const rt=ie.subscribe(wt=>{p&&(U=wt,N?F():lt(),T&&document.body.contains(T)&&dt())});return v=ee.subscribe(wt=>{pt(wt.items)}),r.items&&r.items.length>0?dt():ee.loadItems(),()=>{try{p=!1,Bt(ae,"Component cleanup started"),T&&(mt(T).selectAll("*").remove(),Bt(ae,"D3 selections removed")),C&&(C.cleanup(),Bt(ae,"Resize hook cleaned up")),v&&(v(),Bt(ae,"Unsubscribed from items store")),rt&&(rt(),Bt(ae,"Unsubscribed from language store")),Bt(ae,"Component cleanup completed")}catch(wt){console.error("Error during cleanup:",wt)}}})();return()=>{ot.then(rt=>rt())}}catch(st){return console.error("Error in onMount:",st),()=>{}}}),Ve(()=>{if(p){p=!1,Bt(ae,"Component destroyed (backup cleanup)");try{C&&(C.cleanup(),Bt(ae,"Resize hook cleaned up (backup)")),v&&(v(),Bt(ae,"Unsubscribed from items store (backup)"))}catch(st){console.error("Error during backup cleanup:",st)}}});function Et(st){le[st?"unshift":"push"](()=>{T=st,n(0,T)})}return[T,k,w,N,H,r,l,f,u,d,h,m,g,E,z,B,$,V,D,G,L,O,I,P,Y,it,Et]}class t0 extends pe{constructor(e){super(),ge(this,e,jp,Qp,ce,{},null,[-1,-1])}}function e0(t,e,n){const r=new URL(n||window.location.href);return r.searchParams.set("lang",t),r.searchParams.set("tab",e),r.toString()}function n0(){if(typeof window>"u")return{lang:null,tab:null};const t=new URLSearchParams(window.location.search),e=t.get("lang"),n=t.get("tab");return{lang:e==="en"||e==="fr"?e:null,tab:n}}function ka(t,e){if(typeof window>"u")return;const n=e0(t,e);window.history.pushState({},"",n)}function Ta(t,e,n){const r=t.slice();return r[24]=e[n],r}function Ca(t){let e,n=t[24].translatedLabel+"",r,i,o,a,l,c;function s(){return t[9](t[24])}function f(...u){return t[10](t[24],...u)}return{c(){e=R("li"),r=j(n),i=bt(),y(e,"class",o="py-sm px-md cursor-pointer transition tab-item tab-flexible tabs-mobile "+(t[1]===t[24].id?"active":"")+" svelte-1w47g2g"),y(e,"role","tab"),y(e,"tabindex","0"),y(e,"aria-selected",a=t[1]===t[24].id)},m(u,d){ut(u,e,d),b(e,r),b(e,i),l||(c=[Zt(e,"click",s),Zt(e,"keydown",f)],l=!0)},p(u,d){t=u,d&4&&n!==(n=t[24].translatedLabel+"")&&ht(r,n),d&6&&o!==(o="py-sm px-md cursor-pointer transition tab-item tab-flexible tabs-mobile "+(t[1]===t[24].id?"active":"")+" svelte-1w47g2g")&&y(e,"class",o),d&6&&a!==(a=t[1]===t[24].id)&&y(e,"aria-selected",a)},d(u){u&&ct(e),l=!1,me(c)}}}function r0(t){let e,n;return e=new Lp({}),{c(){te(e.$$.fragment)},m(r,i){Jt(e,r,i),n=!0},p:xt,i(r){n||($t(e.$$.fragment,r),n=!0)},o(r){Ht(e.$$.fragment,r),n=!1},d(r){Qt(e,r)}}}function i0(t){let e,n;return e=new _p({}),{c(){te(e.$$.fragment)},m(r,i){Jt(e,r,i),n=!0},p:xt,i(r){n||($t(e.$$.fragment,r),n=!0)},o(r){Ht(e.$$.fragment,r),n=!1},d(r){Qt(e,r)}}}function o0(t){let e,n;return e=new fp({}),{c(){te(e.$$.fragment)},m(r,i){Jt(e,r,i),n=!0},p:xt,i(r){n||($t(e.$$.fragment,r),n=!0)},o(r){Ht(e.$$.fragment,r),n=!1},d(r){Qt(e,r)}}}function a0(t){let e,n;return e=new t0({}),{c(){te(e.$$.fragment)},m(r,i){Jt(e,r,i),n=!0},p:xt,i(r){n||($t(e.$$.fragment,r),n=!0)},o(r){Ht(e.$$.fragment,r),n=!1},d(r){Qt(e,r)}}}function l0(t){let e,n;return e=new Yp({}),{c(){te(e.$$.fragment)},m(r,i){Jt(e,r,i),n=!0},p:xt,i(r){n||($t(e.$$.fragment,r),n=!0)},o(r){Ht(e.$$.fragment,r),n=!1},d(r){Qt(e,r)}}}function s0(t){let e,n;return e=new Wg({}),{c(){te(e.$$.fragment)},m(r,i){Jt(e,r,i),n=!0},p:xt,i(r){n||($t(e.$$.fragment,r),n=!0)},o(r){Ht(e.$$.fragment,r),n=!1},d(r){Qt(e,r)}}}function c0(t){let e,n=t[3].error+"",r;return{c(){e=R("div"),r=j(n),y(e,"class","flex justify-center items-center font-lg text-error loading-container svelte-1w47g2g")},m(i,o){ut(i,e,o),b(e,r)},p(i,o){o&8&&n!==(n=i[3].error+"")&&ht(r,n)},i:xt,o:xt,d(i){i&&ct(e)}}}function u0(t){let e;return{c(){e=R("div"),e.textContent=`${at("ui.loading")}`,y(e,"class","flex justify-center items-center font-lg loading-container svelte-1w47g2g")},m(n,r){ut(n,e,r)},p:xt,i:xt,o:xt,d(n){n&&ct(e)}}}function f0(t){let e,n,r,i,o,a,l,c,s,f,u,d,h,m,g,p,v,T,M,x,k,w,S,N,H;l=new Ns({}),s=new Cs({}),u=new vs({});let U=t[2],_=[];for(let z=0;z<U.length;z+=1)_[z]=Ca(Ta(t,U,z));const X=[u0,c0,s0,l0,a0,o0,i0,r0],A=[];function C(z,B){return z[3].loading?0:z[3].error?1:z[1]==="countries"?2:z[1]==="types"?3:z[1]==="words"?4:z[1]==="languages"?5:z[1]==="categories"?6:z[1]==="timeline"?7:-1}~(k=C(t))&&(w=A[k]=X[k](t));let E=Ip;return{c(){e=R("main"),n=R("header"),r=R("div"),i=R("h1"),o=bt(),a=R("div"),te(l.$$.fragment),c=bt(),te(s.$$.fragment),f=bt(),te(u.$$.fragment),d=bt(),h=R("nav"),m=R("ul"),g=R("div"),p=bt(),v=R("div"),T=bt();for(let z=0;z<_.length;z+=1)_[z].c();M=bt(),x=R("div"),w&&w.c(),S=bt(),N=Gl(),y(i,"class","m-0 text-xl text-primary"),y(a,"class","flex gap-md items-center"),y(r,"class","flex justify-between items-center mb-md"),y(g,"class","tab-scroll-left-indicator"),y(v,"class","tab-scroll-indicator"),y(m,"class","flex p-0 m-0 border-b list-style-none app-tabs tabs-container svelte-1w47g2g"),y(n,"class","mb-lg"),y(x,"class","bg-card rounded shadow p-md content-container svelte-1w47g2g"),y(e,"class","container mx-auto p-md")},m(z,B){ut(z,e,B),b(e,n),b(n,r),b(r,i),i.innerHTML=t[4],b(r,o),b(r,a),Jt(l,a,null),b(a,c),Jt(s,a,null),b(a,f),Jt(u,a,null),b(n,d),b(n,h),b(h,m),b(m,g),b(m,p),b(m,v),b(m,T);for(let $=0;$<_.length;$+=1)_[$]&&_[$].m(m,null);t[11](m),b(e,M),b(e,x),~k&&A[k].m(x,null),ut(z,S,B),ut(z,N,B),H=!0},p(z,B){if((!H||B&16)&&(i.innerHTML=z[4]),B&70){U=z[2];let V;for(V=0;V<U.length;V+=1){const D=Ta(z,U,V);_[V]?_[V].p(D,B):(_[V]=Ca(D),_[V].c(),_[V].m(m,null))}for(;V<_.length;V+=1)_[V].d(1);_.length=U.length}let $=k;k=C(z),k===$?~k&&A[k].p(z,B):(w&&(Pr(),Ht(A[$],1,1,()=>{A[$]=null}),Hr()),~k?(w=A[k],w?w.p(z,B):(w=A[k]=X[k](z),w.c()),$t(w,1),w.m(x,null)):w=null)},i(z){H||($t(l.$$.fragment,z),$t(s.$$.fragment,z),$t(u.$$.fragment,z),$t(w),$t(E),H=!0)},o(z){Ht(l.$$.fragment,z),Ht(s.$$.fragment,z),Ht(u.$$.fragment,z),Ht(w),Ht(E),H=!1},d(z){z&&ct(e),Qt(l),Qt(s),Qt(u),xn(_,z),t[11](null),~k&&A[k].d(),z&&ct(S),z&&ct(N)}}}function d0(t){let e,n;return e=new Ps({props:{$$slots:{default:[f0]},$$scope:{ctx:t}}}),{c(){te(e.$$.fragment)},m(r,i){Jt(e,r,i),n=!0},p(r,[i]){const o={};i&134217759&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){n||($t(e.$$.fragment,r),n=!0)},o(r){Ht(e.$$.fragment,r),n=!1},d(r){Qt(e,r)}}}const ue="App";function h0(t,e,n){let r,i,o,a;vt(t,ie,_=>n(8,i=_)),vt(t,ee,_=>n(3,o=_));let l=!1,c=0,s=()=>{},f=0,u;const d=ft("app.title");vt(t,d,_=>n(4,a=_));let h="countries";const m=[{id:"countries",label:"tab.countries"},{id:"types",label:"tab.types"},{id:"words",label:"tab.words"},{id:"languages",label:"tab.languages"},{id:"categories",label:"tab.categories"},{id:"timeline",label:"tab.timeline"}];let g="",p="";function v(){if(typeof window>"u")return;const{lang:_,tab:X}=n0();Bt(ue,`URL parameters: lang=${_}, tab=${X}`),_&&(ie.setLanguage(_),Bt(ue,`Setting language from URL: ${_}`)),X&&m.some(A=>A.id===X)&&(n(1,h=X),Bt(ue,`Setting tab from URL: ${X}`))}function T(){if(!u)return;u.scrollWidth>u.clientWidth?u.classList.add("tab-scroll-active"):u.classList.remove("tab-scroll-active")}function M(){if(!u)return;const _=u.querySelector(".tab-item.active");if(!_)return;const X=u.getBoundingClientRect(),A=_.getBoundingClientRect(),C=A.right<=X.right,E=A.left>=X.left;if(C){if(!E)try{_.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})}catch{n(0,u.scrollLeft+=A.left-X.left-16,u)}}else try{_.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})}catch{n(0,u.scrollLeft+=A.right-X.right+16,u)}}function x(_){n(1,h=_),g&&ka(g,_),setTimeout(()=>{M()},50)}function k(_){var X;if(!l){Bt(ue,`Language change ignored (not mounted): ${_}`);return}p=g,g=_,ka(_,h),n(2,r=m.map(A=>({...A,translatedLabel:at(A.label)}))),Bt(ue,`Language changed from ${p} to ${_}`,{isMounted:l,updateCount:c,subscriptionActive:!!s}),Bt(ue,"Current translations:",{title:at("app.title"),loading:at("ui.loading"),activeTab:at(((X=m.find(A=>A.id===h))==null?void 0:X.label)||"")}),setTimeout(()=>{T(),M()},100)}es(()=>{f++,Bt(ue,`Before update (render #${f})`,{isMounted:l,currentLanguage:g,activeTab:h})}),xe(()=>{try{n(7,l=!0),v(),Bt(ue,`Component mounted, initial language: ${i}`,{storeValue:i,activeTab:h}),g=i,n(2,r=m.map(_=>({..._,translatedLabel:at(_.label)})));try{s=ie.subscribe(X=>{k(X)}),Bt(ue,"Successfully subscribed to language store")}catch(_){Bt(ue,`Error subscribing to language store: ${_}`)}if((!o.items||o.items.length===0)&&ee.loadItems(),u){if(T(),navigator.userAgent.toLowerCase().indexOf("firefox")>-1){const _=document.createElement("style");_.textContent=".tabs-container { scrollbar-width: none; }",_.setAttribute("data-firefox-scrollbar","true"),document.head.appendChild(_)}u.addEventListener("scroll",w),u.dispatchEvent(new Event("scroll")),window.addEventListener("resize",S),setTimeout(()=>{M()},100)}}catch(_){console.error("[App] Error in onMount:",_)}}),Ve(()=>{try{if(s&&s(),n(7,l=!1),Bt(ue,"Component unmounted"),u){u.removeEventListener("scroll",w);const _=document.querySelector("style[data-firefox-scrollbar]");_&&_.remove()}window.removeEventListener("resize",S)}catch(_){console.error("[App] Error in onDestroy:",_)}}),ns(()=>{c++,Bt(ue,`Component updated (${c})`,{isMounted:l,currentLanguage:g,storeValue:i,activeTab:h}),setTimeout(()=>{T()},50)});function w(){if(!u)return;const _=u.scrollLeft+u.clientWidth>=u.scrollWidth-5,X=u.scrollLeft<=5;_?u.classList.remove("tab-scroll-active"):u.classList.add("tab-scroll-active"),X?u.classList.remove("tab-scroll-not-at-start"):u.classList.add("tab-scroll-not-at-start")}function S(){T(),M()}const N=_=>x(_.id),H=(_,X)=>X.key==="Enter"&&x(_.id);function U(_){le[_?"unshift":"push"](()=>{u=_,n(0,u)})}return t.$$.update=()=>{t.$$.dirty&384&&i&&l&&n(2,r=m.map(_=>({..._,translatedLabel:at(_.label)})))},n(2,r=m.map(_=>({..._,translatedLabel:at(_.label)}))),[u,h,r,o,a,d,x,l,i,N,H,U]}class m0 extends pe{constructor(e){super(),ge(this,e,h0,d0,ce,{})}}new m0({target:document.getElementById("app")});
